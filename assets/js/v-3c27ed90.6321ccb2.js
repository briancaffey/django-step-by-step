"use strict";(self.webpackChunkvuepress_docs=self.webpackChunkvuepress_docs||[]).push([[920],{201:(e,n,a)=>{a.r(n),a.d(n,{data:()=>s});const s={key:"v-3c27ed90",path:"/topics/docker-compose/",title:"Using docker-compose",lang:"en-US",frontmatter:{next:"/topics/jwt-authentication",prev:"/topics/docker-compose"},excerpt:"",headers:[{level:2,title:"Using docker-compose for local development",slug:"using-docker-compose-for-local-development",children:[{level:3,title:"1. Your local computer",slug:"_1-your-local-computer",children:[]},{level:3,title:"2. The Quasar project",slug:"_2-the-quasar-project",children:[]},{level:3,title:"3. localhost",slug:"_3-localhost",children:[]},{level:3,title:"4. docker",slug:"_4-docker",children:[]},{level:3,title:"5. main",slug:"_5-main",children:[]},{level:3,title:"6. nginx",slug:"_6-nginx",children:[]},{level:3,title:"7. nginx routing",slug:"_7-nginx-routing",children:[]},{level:3,title:"8. backend",slug:"_8-backend",children:[]},{level:3,title:"9. postgres",slug:"_9-postgres",children:[]},{level:3,title:"11. redis",slug:"_11-redis",children:[]},{level:3,title:"11. pgadmin",slug:"_11-pgadmin",children:[]},{level:3,title:"12. celery_default",slug:"_12-celery-default",children:[]},{level:3,title:"13. beat",slug:"_13-beat",children:[]},{level:3,title:"14. Apple",slug:"_14-apple",children:[]},{level:3,title:"15. Linux",slug:"_15-linux",children:[]},{level:3,title:"16. Windows",slug:"_16-windows",children:[]}]},{level:2,title:"How to start working on the project using docker-compose",slug:"how-to-start-working-on-the-project-using-docker-compose",children:[]}],filePathRelative:"topics/docker-compose/README.md",git:{updatedTime:1662859531e3,contributors:[]}}},6351:(e,n,a)=>{a.r(n),a.d(n,{default:()=>H});var s=a(6252);const o=(0,s.Wm)("h1",{id:"using-docker-compose",tabindex:"-1"},[(0,s.Wm)("a",{class:"header-anchor",href:"#using-docker-compose","aria-hidden":"true"},"#"),(0,s.Uk)(" Using docker-compose")],-1),t={class:"table-of-contents"},l=(0,s.Uk)("Using docker-compose for local development"),i=(0,s.Uk)("1. Your local computer"),c=(0,s.Uk)("2. The Quasar project"),r=(0,s.Uk)("3. localhost"),p=(0,s.Uk)("4. docker"),d=(0,s.Uk)("5. main"),u=(0,s.Uk)("6. nginx"),h=(0,s.Uk)("7. nginx routing"),m=(0,s.Uk)("8. backend"),k=(0,s.Uk)("9. postgres"),g=(0,s.Uk)("11. redis"),b=(0,s.Uk)("11. pgadmin"),f=(0,s.Uk)("12. celery_default"),w=(0,s.Uk)("13. beat"),_=(0,s.Uk)("14. Apple"),v=(0,s.Uk)("15. Linux"),y=(0,s.Uk)("16. Windows"),x=(0,s.Uk)("How to start working on the project using docker-compose"),W=(0,s.Wm)("h2",{id:"using-docker-compose-for-local-development",tabindex:"-1"},[(0,s.Wm)("a",{class:"header-anchor",href:"#using-docker-compose-for-local-development","aria-hidden":"true"},"#"),(0,s.Uk)(" Using docker-compose for local development")],-1),T=(0,s.Wm)("p",null,[(0,s.Uk)("The easiest way to start the project in a local development environment is to use "),(0,s.Wm)("code",null,"docker-compose"),(0,s.Uk)(". The following diagram is an overview of how the "),(0,s.Wm)("code",null,"docker-compose"),(0,s.Uk)(" local development environment works.")],-1),E=(0,s.uE)('<h3 id="_1-your-local-computer" tabindex="-1"><a class="header-anchor" href="#_1-your-local-computer" aria-hidden="true">#</a> 1. Your local computer</h3><p>This diagram shows how to run the project on you computer so that it can be changed in real-time using hot-reloading. Hot reloading means that when you save changes to files, application corresponding to the changed file automatically reloads. This allows you to develop quickly without needing to manually restart whenever you make changes. Running your application in a production mode will be different, but the local development environment tries to mimic the production environment as closely as possible.</p><h3 id="_2-the-quasar-project" tabindex="-1"><a class="header-anchor" href="#_2-the-quasar-project" aria-hidden="true">#</a> 2. The Quasar project</h3><p>This is the one part of the local development environment that is <em>not</em> controlled by docker. It can be, but I find it easier to work the Quasar frontend when it is not running in a container. The Quasar project runs on port 8080 and can be started by running <code>make quasar-dev</code>.</p><h3 id="_3-localhost" tabindex="-1"><a class="header-anchor" href="#_3-localhost" aria-hidden="true">#</a> 3. <code>localhost</code></h3><p><code>localhost</code> is an important concept to grasp when working with docker and docker-compose. Containers run processes on ports, but these ports cannot be access on <code>localhost</code> unless the container port is mapped to the port on <code>localhost</code>. For example, the <code>nginx</code> container has the following port mapping:</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>  <span class="token key atrule">nginx</span><span class="token punctuation">:</span>\n    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> nginx\n    <span class="token key atrule">build</span><span class="token punctuation">:</span>\n      <span class="token key atrule">context</span><span class="token punctuation">:</span> ./nginx\n      <span class="token key atrule">dockerfile</span><span class="token punctuation">:</span> dev/Dockerfile\n    <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;80:80&quot;</span> <span class="token comment"># port 80 in the container is mapped to port 80 on `localhost`</span>\n    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> backend\n    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> ./nginx/dev/dev.conf<span class="token punctuation">:</span>/etc/nginx/nginx.conf<span class="token punctuation">:</span>ro\n    <span class="token key atrule">networks</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> main\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_4-docker" tabindex="-1"><a class="header-anchor" href="#_4-docker" aria-hidden="true">#</a> 4. <code>docker</code></h3><p>The outer-most box in the diagram contains all of docker resources: containers, volumes and networks.</p><h3 id="_5-main" tabindex="-1"><a class="header-anchor" href="#_5-main" aria-hidden="true">#</a> 5. <code>main</code></h3><p><code>main</code> is the docker network that all development containers run in. Containers on the same network can communicate with each other by referencing the name of the service. All of the services can be found in the docker-compose file:</p><ul><li><code>nginx</code></li><li><code>postgres</code></li><li><code>pgadmin</code></li><li><code>redis</code></li><li><code>redis-commander</code></li><li><code>backend</code></li><li><code>celery_default</code></li><li><code>beat</code></li><li><code>mailhog</code></li></ul><h3 id="_6-nginx" tabindex="-1"><a class="header-anchor" href="#_6-nginx" aria-hidden="true">#</a> 6. <code>nginx</code></h3><p>The <code>nginx</code> container is like the front-door for our application.</p><h3 id="_7-nginx-routing" tabindex="-1"><a class="header-anchor" href="#_7-nginx-routing" aria-hidden="true">#</a> 7. <code>nginx</code> routing</h3><p>All requests to <code>localhost</code> (port <code>80</code> of <code>localhost</code>) are sent to the <code>nginx</code> container. The nginx configuration file (<code>nginx/dev/dev.conf</code>) is used to route applications to either the <code>backend</code> container if the request starts with one of the following:</p><ul><li><code>/api/</code></li><li><code>/admin/</code></li><li><code>/graphql/</code></li></ul><p>All other requests will be sent to port 8080 of <code>localhost</code> (where the Quasar application is running).</p><h3 id="_8-backend" tabindex="-1"><a class="header-anchor" href="#_8-backend" aria-hidden="true">#</a> 8. <code>backend</code></h3><p>This box represents the Django application server that serves requests for the REST and GraphQL APIs, as well as the Django Admin interface.</p><p>Here&#39;s how the <code>backend</code> container is configured:</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>  <span class="token key atrule">backend</span><span class="token punctuation">:</span> <span class="token important">&amp;backend</span>\n    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> backend\n    <span class="token key atrule">build</span><span class="token punctuation">:</span>\n      <span class="token key atrule">context</span><span class="token punctuation">:</span> ./backend\n      <span class="token key atrule">dockerfile</span><span class="token punctuation">:</span> Dockerfile.dev\n    <span class="token key atrule">command</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;python3&quot;</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;manage.py&quot;</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;runserver&quot;</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;0.0.0.0:8000&quot;</span>\n    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> ./backend<span class="token punctuation">:</span>/code\n    <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;8000:8000&quot;</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;8888:8888&quot;</span>\n    <span class="token key atrule">networks</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> main\n    <span class="token key atrule">environment</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> CELERY_TASK_ALWAYS_EAGER=$CELERY_TASK_ALWAYS_EAGER\n      <span class="token punctuation">-</span> DJANGO_EMAIL_HOST=mailhog\n      <span class="token punctuation">-</span> DEBUG=1\n      <span class="token punctuation">-</span> POSTGRES_SERVICE_HOST=postgres\n      <span class="token punctuation">-</span> REDIS_SERVICE_HOST=redis\n      <span class="token punctuation">-</span> DJANGO_SETTINGS_MODULE=backend.settings.development\n      <span class="token punctuation">-</span> AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID\n      <span class="token punctuation">-</span> AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY\n    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> postgres\n      <span class="token punctuation">-</span> redis\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>Note the volume mount in the backend service definition:</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> ./backend<span class="token punctuation">:</span>/code\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>This volume mount is what allows the Django application to reload whenever code changes are made. The <code>runserver</code> command running in the container will reload when we change files in an editor on our machine (outside of the container) because the directory that contains the files being edited are mapped to the container, so the files on our local computer appear to the <code>backend</code> as if they are they are files in the container.</p><h3 id="_9-postgres" tabindex="-1"><a class="header-anchor" href="#_9-postgres" aria-hidden="true">#</a> 9. <code>postgres</code></h3><p>The Postgres database that persists data for the Django application. This is a pretty standard way to run a database using docker.</p><h3 id="_11-redis" tabindex="-1"><a class="header-anchor" href="#_11-redis" aria-hidden="true">#</a> 11. <code>redis</code></h3><p>Redis is a key-value store that can be used by Django in few different ways:</p><ol><li>caching requests</li><li>queueing tasks</li></ol><h3 id="_11-pgadmin" tabindex="-1"><a class="header-anchor" href="#_11-pgadmin" aria-hidden="true">#</a> 11. <code>pgadmin</code></h3>',31),U=(0,s.Wm)("code",null,"pgadmin",-1),q=(0,s.Uk)(" is a utility container that allows you to interact with the Postgres database at a highly detailed level. To access the database, navigate to "),S={href:"http://localhost:5050",target:"_blank",rel:"noopener noreferrer"},A=(0,s.Wm)("code",null,"http://localhost:5050",-1),j=(0,s.Uk)(" and use the following credentials:"),C=(0,s.uE)('<ul><li>email: <code>pgadmin4@pgadmin.org</code></li><li>password: <code>admin</code></li></ul><h3 id="_12-celery-default" tabindex="-1"><a class="header-anchor" href="#_12-celery-default" aria-hidden="true">#</a> 12. <code>celery_default</code></h3><p>Celery is the processes that does work on tasks when new tasks are submitted to the queue. The <code>celery_default</code> container is configure to only process the <code>default</code> task queue. You can configure as many different queues as you want, and a single container can be configured to process tasks for any number of queues.</p><p>If there is not much task queuing happening in your application, you probably only need one task queue.</p><h3 id="_13-beat" tabindex="-1"><a class="header-anchor" href="#_13-beat" aria-hidden="true">#</a> 13. <code>beat</code></h3><p>Celery beat is a services that submits tasks to the task queue on a set schedule. The schedule is defined in the <code>base.py</code> Django settings file with the <code>CELERY_BEAT_SCHEDULE</code> settings value.</p><p>Note that both <code>celery_default</code> and <code>beat</code> both inherit the service settings from the <code>backend</code> container. This is done using <strong>YAML anchors</strong>.</p><h3 id="_14-apple" tabindex="-1"><a class="header-anchor" href="#_14-apple" aria-hidden="true">#</a> 14. Apple</h3><p>The following development environment can run on Apple computers with both Intel and Apple Silicon (M1) chips.</p><h3 id="_15-linux" tabindex="-1"><a class="header-anchor" href="#_15-linux" aria-hidden="true">#</a> 15. Linux</h3><p>The development environment and related tooling is fully supported by Linux-based operating systems such as Ubuntu 20.04.</p><h3 id="_16-windows" tabindex="-1"><a class="header-anchor" href="#_16-windows" aria-hidden="true">#</a> 16. Windows</h3><p>When working with Windows, it is recommended to use WSL2. This is a Linux-based environment that is designed to run on Windows, and it fully supports running docker-containers.</p><p>To get started with WSL on Windows 10, see the following resources:</p>',14),L={href:"https://docs.docker.com/desktop/windows/wsl/",target:"_blank",rel:"noopener noreferrer"},D=(0,s.Uk)("https://docs.docker.com/desktop/windows/wsl/"),R={href:"https://docs.microsoft.com/en-us/windows/wsl/tutorials/wsl-containers",target:"_blank",rel:"noopener noreferrer"},Y=(0,s.Uk)("https://docs.microsoft.com/en-us/windows/wsl/tutorials/wsl-containers"),I=(0,s.uE)('<h2 id="how-to-start-working-on-the-project-using-docker-compose" tabindex="-1"><a class="header-anchor" href="#how-to-start-working-on-the-project-using-docker-compose" aria-hidden="true">#</a> How to start working on the project using docker-compose</h2><p>To start working on the project with the docker-compose setup, you need to do the following:</p><ol><li>install docker</li><li>run <code>docker compose up --build</code></li><li>exec into the container to start running commands</li></ol><p>To exec into the backend container, you can run the following command:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker exec -it backend bash\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>From inside of the container, you can run the following commands:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>python3 manage.py shell\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>This command will setup the database tables in postgres so that our application can start reading and writing data from and to the Postgres database.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>python manage.py generate_posts\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>This command can be used to generate 20 random posts.</p>',10),H={render:function(e,n){const a=(0,s.up)("RouterLink"),H=(0,s.up)("OutboundLink");return(0,s.wg)(),(0,s.j4)(s.HY,null,[o,(0,s.Wm)("nav",t,[(0,s.Wm)("ul",null,[(0,s.Wm)("li",null,[(0,s.Wm)(a,{to:"#using-docker-compose-for-local-development"},{default:(0,s.w5)((()=>[l])),_:1}),(0,s.Wm)("ul",null,[(0,s.Wm)("li",null,[(0,s.Wm)(a,{to:"#_1-your-local-computer"},{default:(0,s.w5)((()=>[i])),_:1})]),(0,s.Wm)("li",null,[(0,s.Wm)(a,{to:"#_2-the-quasar-project"},{default:(0,s.w5)((()=>[c])),_:1})]),(0,s.Wm)("li",null,[(0,s.Wm)(a,{to:"#_3-localhost"},{default:(0,s.w5)((()=>[r])),_:1})]),(0,s.Wm)("li",null,[(0,s.Wm)(a,{to:"#_4-docker"},{default:(0,s.w5)((()=>[p])),_:1})]),(0,s.Wm)("li",null,[(0,s.Wm)(a,{to:"#_5-main"},{default:(0,s.w5)((()=>[d])),_:1})]),(0,s.Wm)("li",null,[(0,s.Wm)(a,{to:"#_6-nginx"},{default:(0,s.w5)((()=>[u])),_:1})]),(0,s.Wm)("li",null,[(0,s.Wm)(a,{to:"#_7-nginx-routing"},{default:(0,s.w5)((()=>[h])),_:1})]),(0,s.Wm)("li",null,[(0,s.Wm)(a,{to:"#_8-backend"},{default:(0,s.w5)((()=>[m])),_:1})]),(0,s.Wm)("li",null,[(0,s.Wm)(a,{to:"#_9-postgres"},{default:(0,s.w5)((()=>[k])),_:1})]),(0,s.Wm)("li",null,[(0,s.Wm)(a,{to:"#_11-redis"},{default:(0,s.w5)((()=>[g])),_:1})]),(0,s.Wm)("li",null,[(0,s.Wm)(a,{to:"#_11-pgadmin"},{default:(0,s.w5)((()=>[b])),_:1})]),(0,s.Wm)("li",null,[(0,s.Wm)(a,{to:"#_12-celery-default"},{default:(0,s.w5)((()=>[f])),_:1})]),(0,s.Wm)("li",null,[(0,s.Wm)(a,{to:"#_13-beat"},{default:(0,s.w5)((()=>[w])),_:1})]),(0,s.Wm)("li",null,[(0,s.Wm)(a,{to:"#_14-apple"},{default:(0,s.w5)((()=>[_])),_:1})]),(0,s.Wm)("li",null,[(0,s.Wm)(a,{to:"#_15-linux"},{default:(0,s.w5)((()=>[v])),_:1})]),(0,s.Wm)("li",null,[(0,s.Wm)(a,{to:"#_16-windows"},{default:(0,s.w5)((()=>[y])),_:1})])])]),(0,s.Wm)("li",null,[(0,s.Wm)(a,{to:"#how-to-start-working-on-the-project-using-docker-compose"},{default:(0,s.w5)((()=>[x])),_:1})])])]),W,T,(0,s.Wm)("img",{src:e.$withBase("/diagrams/docker-compose.png"),alt:"docker-compose"},null,8,["src"]),E,(0,s.Wm)("p",null,[U,q,(0,s.Wm)("a",S,[A,(0,s.Wm)(H)]),j]),C,(0,s.Wm)("ul",null,[(0,s.Wm)("li",null,[(0,s.Wm)("a",L,[D,(0,s.Wm)(H)])]),(0,s.Wm)("li",null,[(0,s.Wm)("a",R,[Y,(0,s.Wm)(H)])])]),I],64)}}}}]);