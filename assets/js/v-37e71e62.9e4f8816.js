"use strict";(self.webpackChunkvuepress_docs=self.webpackChunkvuepress_docs||[]).push([[457],{3477:(n,s,a)=>{a.r(s),a.d(s,{data:()=>e});const e={key:"v-37e71e62",path:"/guide/step-by-step/",title:"Step by Step Guide ðŸš€",lang:"en-US",frontmatter:{next:"/guide/ci-cd/github-actions",prev:"/topics/vuepress"},excerpt:"",headers:[{level:2,title:"What is a Django application?",slug:"what-is-a-django-application",children:[]},{level:2,title:"Start with a blank git repo and create two files: README.md and STEP_BY_STEP.md:",slug:"start-with-a-blank-git-repo-and-create-two-files-readme-md-and-step-by-step-md",children:[]},{level:2,title:"Create a virtual environment",slug:"create-a-virtual-environment",children:[]},{level:2,title:"Activate the virtual environment",slug:"activate-the-virtual-environment",children:[]},{level:2,title:"Make sure pip is upgraded to the latest version",slug:"make-sure-pip-is-upgraded-to-the-latest-version",children:[]},{level:2,title:"Install Django",slug:"install-django",children:[]},{level:2,title:"Start a new Django project",slug:"start-a-new-django-project",children:[]},{level:2,title:"Add a .gitignore file to the backend directory",slug:"add-a-gitignore-file-to-the-backend-directory",children:[]},{level:2,title:"Add a .gitignore file to the root of the project",slug:"add-a-gitignore-file-to-the-root-of-the-project",children:[]},{level:2,title:"migrate and runserver",slug:"migrate-and-runserver",children:[]},{level:2,title:"settings.py file change: SECRET_KEY",slug:"settings-py-file-change-secret-key",children:[]},{level:2,title:"settings.py file change: DEBUG",slug:"settings-py-file-change-debug",children:[]},{level:2,title:"Move backend/backend/settings.py to backend/backend/settings/base.py and add `backend/backend/settings/init.py",slug:"move-backend-backend-settings-py-to-backend-backend-settings-base-py-and-add-backend-backend-settings-init-py",children:[]},{level:2,title:"Change the value of BASE_DIR",slug:"change-the-value-of-base-dir",children:[]},{level:2,title:"Create backend/backend/settings/development.py",slug:"create-backend-backend-settings-development-py",children:[]},{level:2,title:"Change DJANGO_SETTINGS_MODULE in backend/manage.py again",slug:"change-django-settings-module-in-backend-manage-py-again",children:[]},{level:2,title:"Add a requirements folder with three files: base.txt, dev.txt and test.txt",slug:"add-a-requirements-folder-with-three-files-base-txt-dev-txt-and-test-txt",children:[]},{level:2,title:"Install Django Debug Toolbar",slug:"install-django-debug-toolbar",children:[]},{level:2,title:"Add debug_toolbar to INSTALLED_APPS",slug:"add-debug-toolbar-to-installed-apps",children:[]},{level:2,title:"Add URLconf for debug toolbar",slug:"add-urlconf-for-debug-toolbar",children:[]},{level:2,title:"Add debug toolbar to middleware",slug:"add-debug-toolbar-to-middleware",children:[]},{level:2,title:"Set INTERNAL_IPS for debug toolbar",slug:"set-internal-ips-for-debug-toolbar",children:[]},{level:2,title:"Create a superuser with createsuperuser",slug:"create-a-superuser-with-createsuperuser",children:[]},{level:2,title:"Rename the /admin URL (Optional)",slug:"rename-the-admin-url-optional",children:[]},{level:2,title:"Setup a Django app called core",slug:"setup-a-django-app-called-core",children:[]},{level:2,title:"Setup a Django app called accounts",slug:"setup-a-django-app-called-accounts",children:[]},{level:2,title:"Setup a Custom User Model",slug:"setup-a-custom-user-model",children:[]},{level:2,title:"Set AUTH_USER_MODEL = 'accounts.CustomUser' in base.py settings",slug:"set-auth-user-model-accounts-customuser-in-base-py-settings",children:[]},{level:2,title:"Add CustomUserManager for CustomUser model",slug:"add-customusermanager-for-customuser-model",children:[]},{level:2,title:"Add forms for CustomUser admin",slug:"add-forms-for-customuser-admin",children:[]},{level:2,title:"Add CustomUser admin",slug:"add-customuser-admin",children:[]},{level:2,title:"Add tests for the CustomUser model",slug:"add-tests-for-the-customuser-model",children:[]},{level:2,title:"Run makemigrations and migrate management command",slug:"run-makemigrations-and-migrate-management-command",children:[]},{level:2,title:"Run the tests",slug:"run-the-tests",children:[]},{level:2,title:"Install pytest",slug:"install-pytest",children:[]},{level:2,title:"Add pytest.ini to configure pytest",slug:"add-pytest-ini-to-configure-pytest",children:[]},{level:2,title:"Add pytest command to Makefile",slug:"add-pytest-command-to-makefile",children:[]},{level:2,title:"Setup code coverage reports",slug:"setup-code-coverage-reports",children:[]},{level:2,title:"Write browsable coverage to a directory and view with simple HTTP server",slug:"write-browsable-coverage-to-a-directory-and-view-with-simple-http-server",children:[]},{level:2,title:"Add .coveragerc to exclude files from coverage report",slug:"add-coveragerc-to-exclude-files-from-coverage-report",children:[]},{level:2,title:"Configure VSCode settings",slug:"configure-vscode-settings",children:[]},{level:2,title:"Python code linting with flake8",slug:"python-code-linting-with-flake8",children:[]},{level:2,title:"Format python code with black",slug:"format-python-code-with-black",children:[]},{level:2,title:"Add runserver_plus and Werkzeug",slug:"add-runserver-plus-and-werkzeug",children:[]},{level:2,title:"Add a base model for tracking created/modified timestamps",slug:"add-a-base-model-for-tracking-created-modified-timestamps",children:[]},{level:2,title:"Add settings for enabling use of Jupyter notebooks",slug:"add-settings-for-enabling-use-of-jupyter-notebooks",children:[]},{level:2,title:"Setup Postgres locally",slug:"setup-postgres-locally",children:[]},{level:2,title:"Configure our Django application to use our local postgres service",slug:"configure-our-django-application-to-use-our-local-postgres-service",children:[]},{level:2,title:"Another approach to running postgres on our machine and an introduction to docker: run postgres in a docker container",slug:"another-approach-to-running-postgres-on-our-machine-and-an-introduction-to-docker-run-postgres-in-a-docker-container",children:[]},{level:2,title:"Improve the readability of the command by using docker-compose",slug:"improve-the-readability-of-the-command-by-using-docker-compose",children:[]},{level:2,title:"Setup pgadmin4 locally",slug:"setup-pgadmin4-locally",children:[]},{level:2,title:"Setup pgadmin4 in docker-compose",slug:"setup-pgadmin4-in-docker-compose",children:[]},{level:2,title:"Add a Dockerfile for our Django application",slug:"add-a-dockerfile-for-our-django-application",children:[]},{level:2,title:"Setup redis locally",slug:"setup-redis-locally",children:[]},{level:2,title:"Add redis to docker-compose file for celery broker",slug:"add-redis-to-docker-compose-file-for-celery-broker",children:[]},{level:2,title:"Setup redis-commander locally",slug:"setup-redis-commander-locally",children:[]},{level:2,title:"Add a RequestLog model",slug:"add-a-requestlog-model",children:[]},{level:2,title:"Add a middleware to handle RequestLog creation",slug:"add-a-middleware-to-handle-requestlog-creation",children:[]},{level:2,title:"Add an admin view for the RequestLog",slug:"add-an-admin-view-for-the-requestlog",children:[]},{level:2,title:"Setup Celery app",slug:"setup-celery-app",children:[]},{level:2,title:"Add celery_app.py to backend/backend",slug:"add-celery-app-py-to-backend-backend",children:[]},{level:2,title:"Install celery in backend/backend/__init__.py",slug:"install-celery-in-backend-backend-init-py",children:[]},{level:2,title:"Add celery settings to Django settings",slug:"add-celery-settings-to-django-settings",children:[]},{level:2,title:"Add a debug celery task",slug:"add-a-debug-celery-task",children:[]},{level:2,title:"Run the celery command to start a worker",slug:"run-the-celery-command-to-start-a-worker",children:[]},{level:2,title:"Run the debug task",slug:"run-the-debug-task",children:[]},{level:2,title:"Setup watchdog command for celery",slug:"setup-watchdog-command-for-celery",children:[]},{level:2,title:"Setup flower for celery monitoring",slug:"setup-flower-for-celery-monitoring",children:[]},{level:2,title:"Decide if you need CELERY_TASKS_ALWAYS_EAGER to be set to True",slug:"decide-if-you-need-celery-tasks-always-eager-to-be-set-to-true",children:[]},{level:2,title:"Setup celery beat, settings, periodics tasks",slug:"setup-celery-beat-settings-periodics-tasks",children:[]},{level:2,title:"Run the celery beat process",slug:"run-the-celery-beat-process",children:[]},{level:2,title:"Setup mailhog for testing email locally",slug:"setup-mailhog-for-testing-email-locally",children:[]},{level:2,title:"Build a Model that we can use to demonstrate CRUD and other concepts",slug:"build-a-model-that-we-can-use-to-demonstrate-crud-and-other-concepts",children:[]},{level:2,title:"Create a new Django app for our microblogging demo application",slug:"create-a-new-django-app-for-our-microblogging-demo-application",children:[]},{level:2,title:"Add the model for our microblogs posts",slug:"add-the-model-for-our-microblogs-posts",children:[]},{level:2,title:"Run makemigrations",slug:"run-makemigrations",children:[]},{level:2,title:"Run the migrate command",slug:"run-the-migrate-command",children:[]},{level:2,title:"Register the Post model to the Django admin",slug:"register-the-post-model-to-the-django-admin",children:[]},{level:2,title:"Add a __str__ method to our model",slug:"add-a-str-method-to-our-model",children:[]},{level:2,title:"Add model factories for micro blog post",slug:"add-model-factories-for-micro-blog-post",children:[]},{level:2,title:"Setup a factory.py file in the blog app with a PostFactory",slug:"setup-a-factory-py-file-in-the-blog-app-with-a-postfactory",children:[]},{level:2,title:"Create a simple test using PostFactory",slug:"create-a-simple-test-using-postfactory",children:[]},{level:2,title:"Create a URL pattern that will list all of the blog posts",slug:"create-a-url-pattern-that-will-list-all-of-the-blog-posts",children:[]},{level:2,title:"Include the URLs you just created in the main URLs file",slug:"include-the-urls-you-just-created-in-the-main-urls-file",children:[]},{level:2,title:"Create a simple function-based view for viewing all posts",slug:"create-a-simple-function-based-view-for-viewing-all-posts",children:[]},{level:2,title:"Create a templates directory in the blog app and add posts.html",slug:"create-a-templates-directory-in-the-blog-app-and-add-posts-html",children:[]},{level:2,title:'Add "DIRS": [BASE_DIR / "templates"], to settings/base.py',slug:"add-dirs-base-dir-templates-to-settings-base-py",children:[]},{level:2,title:"Add a new folder in the backend directory called templates and add base.html",slug:"add-a-new-folder-in-the-backend-directory-called-templates-and-add-base-html",children:[]},{level:2,title:"Add Bootstrap to our base template",slug:"add-bootstrap-to-our-base-template",children:[]},{level:2,title:"Write a management command that generates fake data",slug:"write-a-management-command-that-generates-fake-data",children:[]},{level:2,title:"Add pagination to posts view",slug:"add-pagination-to-posts-view",children:[]},{level:2,title:"Create a post detail view",slug:"create-a-post-detail-view",children:[]},{level:2,title:"Add URL for post detail view",slug:"add-url-for-post-detail-view",children:[]},{level:2,title:"Create a template called post.html in templates",slug:"create-a-template-called-post-html-in-templates",children:[]},{level:2,title:"Link to detail views from the list view",slug:"link-to-detail-views-from-the-list-view",children:[]},{level:2,title:"Set up head for Post detail page for SEO",slug:"set-up-head-for-post-detail-page-for-seo",children:[]},{level:2,title:"Add Post Create Form",slug:"add-post-create-form",children:[]},{level:2,title:"Add a URL for a creating a new post",slug:"add-a-url-for-a-creating-a-new-post",children:[]},{level:2,title:"Add new_post.html template",slug:"add-new-post-html-template",children:[]},{level:2,title:"Change the ordering of posts in the Post model",slug:"change-the-ordering-of-posts-in-the-post-model",children:[]},{level:2,title:"Add wildcard to ALLOWED_HOSTS in development settings module",slug:"add-wildcard-to-allowed-hosts-in-development-settings-module",children:[]},{level:2,title:"Use Django messaging framework to update user on post creation success",slug:"use-django-messaging-framework-to-update-user-on-post-creation-success",children:[]},{level:2,title:"Create urls.py in the accounts app with a login path",slug:"create-urls-py-in-the-accounts-app-with-a-login-path",children:[]},{level:2,title:"Create the login view in apps/accounts/views",slug:"create-the-login-view-in-apps-accounts-views",children:[]},{level:2,title:"Override the Default Login form",slug:"override-the-default-login-form",children:[]},{level:2,title:"Set LOGIN_REDIRECT_URL and LOGIN_REDIRECT_URL in base settings module",slug:"set-login-redirect-url-and-login-redirect-url-in-base-settings-module",children:[]},{level:2,title:"Create Login page",slug:"create-login-page",children:[]},{level:2,title:"Enable logout",slug:"enable-logout",children:[]},{level:2,title:"Create update view for post",slug:"create-update-view-for-post",children:[]},{level:2,title:"Create update URL for post",slug:"create-update-url-for-post",children:[]},{level:2,title:"Add delete URL path for posts",slug:"add-delete-url-path-for-posts",children:[]},{level:2,title:"Create delete view for post",slug:"create-delete-view-for-post",children:[]},{level:2,title:"Enable searching posts",slug:"enable-searching-posts",children:[]},{level:2,title:"Fix pagination with search term",slug:"fix-pagination-with-search-term",children:[]},{level:2,title:"Add registration URL",slug:"add-registration-url",children:[]},{level:2,title:"Add registration view",slug:"add-registration-view",children:[]},{level:2,title:"Add registration form",slug:"add-registration-form",children:[]},{level:2,title:"Add email confirmation url and view",slug:"add-email-confirmation-url-and-view",children:[]},{level:2,title:"Add request Password reset form",slug:"add-request-password-reset-form",children:[]},{level:2,title:"Add password reset email with link",slug:"add-password-reset-email-with-link",children:[]},{level:2,title:"Add password reset URL",slug:"add-password-reset-url",children:[]},{level:2,title:"Add password reset form",slug:"add-password-reset-form",children:[]},{level:2,title:"Add password reset view",slug:"add-password-reset-view",children:[]},{level:2,title:"Add Vue via CDN in base.html",slug:"add-vue-via-cdn-in-base-html",children:[]},{level:2,title:"Add an example of how to setup a Vue component in Django template",slug:"add-an-example-of-how-to-setup-a-vue-component-in-django-template",children:[]},{level:2,title:"Create a template called post_likes.html",slug:"create-a-template-called-post-likes-html",children:[]},{level:2,title:"Add Vue component definition and template",slug:"add-vue-component-definition-and-template",children:[]},{level:2,title:"Add axios Via CDN",slug:"add-axios-via-cdn",children:[]},{level:2,title:"Configure Axios CDN",slug:"configure-axios-cdn",children:[]},{level:2,title:"Add a method to the PostLike component that will make an API call using axios",slug:"add-a-method-to-the-postlike-component-that-will-make-an-api-call-using-axios",children:[]},{level:2,title:"Setup an endpoint that will handle our axios call",slug:"setup-an-endpoint-that-will-handle-our-axios-call",children:[]},{level:2,title:"Setup a view to handle the like-post endpoint that returns a JsonResponse",slug:"setup-a-view-to-handle-the-like-post-endpoint-that-returns-a-jsonresponse",children:[]},{level:2,title:"Implement through Model for ManyToMany field for Post likes",slug:"implement-through-model-for-manytomany-field-for-post-likes",children:[]},{level:2,title:"Add through model to Django admin",slug:"add-through-model-to-django-admin",children:[]},{level:2,title:"Run makemigrations and migrate for PostLike",slug:"run-makemigrations-and-migrate-for-postlike",children:[]},{level:2,title:'Add prefetch_related("created_by") to post list query to reduce DB queries',slug:"add-prefetch-related-created-by-to-post-list-query-to-reduce-db-queries",children:[]},{level:2,title:"Add a favicon in static",slug:"add-a-favicon-in-static",children:[]},{level:2,title:"Add .github/workflows/lint.yml for GitHub Action that lints Python code",slug:"add-github-workflows-lint-yml-for-github-action-that-lints-python-code",children:[]},{level:2,title:"Add bitbucket-pipelines.yml for BitBucket pipelines",slug:"add-bitbucket-pipelines-yml-for-bitbucket-pipelines",children:[]},{level:2,title:"Generic Class Based Views",slug:"generic-class-based-views",children:[]},{level:2,title:"Create a file in the blog app called class_based_views.py",slug:"create-a-file-in-the-blog-app-called-class-based-views-py",children:[]},{level:2,title:"Add a generic ListView to the class_based_views file",slug:"add-a-generic-listview-to-the-class-based-views-file",children:[]},{level:2,title:"Setup a new URLs file",slug:"setup-a-new-urls-file",children:[]},{level:2,title:"Add a urlpatterns with a path that uses the PostList CBV",slug:"add-a-urlpatterns-with-a-path-that-uses-the-postlist-cbv",children:[]},{level:2,title:"Include cbv_urls.py in backend/urls.py",slug:"include-cbv-urls-py-in-backend-urls-py",children:[]},{level:2,title:"Fix the template for the PostList CBV",slug:"fix-the-template-for-the-postlist-cbv",children:[]},{level:2,title:"Add CBV DetailView for viewing a single post",slug:"add-cbv-detailview-for-viewing-a-single-post",children:[]},{level:2,title:"Add URL path for DetailView",slug:"add-url-path-for-detailview",children:[]},{level:2,title:"Add a template for the PostDetailView in blog/post_detail in the blog app templates directory",slug:"add-a-template-for-the-postdetailview-in-blog-post-detail-in-the-blog-app-templates-directory",children:[]},{level:2,title:"Add a PostCreateView for creating posts using CBV",slug:"add-a-postcreateview-for-creating-posts-using-cbv",children:[]},{level:2,title:"Add a PostUpdateView for editing posts",slug:"add-a-postupdateview-for-editing-posts",children:[]},{level:2,title:"Add a DeletePostView for deleting posts",slug:"add-a-deletepostview-for-deleting-posts",children:[]},{level:2,title:"Add tests for CBVs",slug:"add-tests-for-cbvs",children:[]},{level:2,title:"Account Management",slug:"account-management",children:[]},{level:2,title:"Add profile view",slug:"add-profile-view",children:[]},{level:2,title:"Add account settings view",slug:"add-account-settings-view",children:[]},{level:2,title:"Refactor QuerySet and Manager for Post model",slug:"refactor-queryset-and-manager-for-post-model",children:[]},{level:2,title:"Account settings",slug:"account-settings",children:[]},{level:2,title:"Django REST Framework",slug:"django-rest-framework",children:[]},{level:2,title:"Add Django REST Framework to base.txt dependencies",slug:"add-django-rest-framework-to-base-txt-dependencies",children:[]},{level:2,title:"Add restframework to INSTALLED_APPS in base settings module",slug:"add-restframework-to-installed-apps-in-base-settings-module",children:[]},{level:2,title:"Add REST Framework URLs under the if settings.DEBUG block in backend/urls.py",slug:"add-rest-framework-urls-under-the-if-settings-debug-block-in-backend-urls-py",children:[]},{level:2,title:"Add OpenAPI/SwaggerUI URL path in backend/urls.py",slug:"add-openapi-swaggerui-url-path-in-backend-urls-py",children:[]},{level:2,title:"Add the following file to the top-level templates directory",slug:"add-the-following-file-to-the-top-level-templates-directory",children:[]},{level:2,title:"Add dependencies for OpenAPI to base.txt",slug:"add-dependencies-for-openapi-to-base-txt",children:[]},{level:2,title:"Create a directory for the OpenAPI Schema",slug:"create-a-directory-for-the-openapi-schema",children:[]},{level:2,title:"Generate the OpenAPI schema",slug:"generate-the-openapi-schema",children:[]},{level:2,title:"Add PostSerializer in serializers.py",slug:"add-postserializer-in-serializers-py",children:[]},{level:2,title:"Add CRUD DRF FBVs for blog app",slug:"add-crud-drf-fbvs-for-blog-app",children:[]},{level:2,title:"Add CRUD DRF CBVs for blog app",slug:"add-crud-drf-cbvs-for-blog-app",children:[]},{level:2,title:"Add CRUD GCBVs for blog app??",slug:"add-crud-gcbvs-for-blog-app",children:[]},{level:2,title:"GraphQL Setup Tasks",slug:"graphql-setup-tasks",children:[]},{level:2,title:"TODO: replace Exceptions with GraphqlExceptions",slug:"todo-replace-exceptions-with-graphqlexceptions",children:[]},{level:2,title:"GraphQL Resources",slug:"graphql-resources",children:[]},{level:2,title:"Add GraphQL dependencies",slug:"add-graphql-dependencies",children:[]},{level:2,title:"Add graphene_django to INSTALLED_APPS",slug:"add-graphene-django-to-installed-apps",children:[]},{level:2,title:"Add GRAPHENE settings to base.py",slug:"add-graphene-settings-to-base-py",children:[]},{level:2,title:"Add schema.py in the blog app directory",slug:"add-schema-py-in-the-blog-app-directory",children:[]},{level:2,title:"Add a schema.py to the backend/backend directory",slug:"add-a-schema-py-to-the-backend-backend-directory",children:[]},{level:2,title:"Add a GraphQL endpoint to backend/urls.py",slug:"add-a-graphql-endpoint-to-backend-urls-py",children:[]},{level:2,title:"Add Cypress Dependencies",slug:"add-cypress-dependencies",children:[]},{level:2,title:"Start Cypress",slug:"start-cypress",children:[]},{level:2,title:"Use npm to open Cypress",slug:"use-npm-to-open-cypress",children:[]},{level:2,title:"Using on WSL 2",slug:"using-on-wsl-2",children:[]},{level:2,title:"Frontend clients",slug:"frontend-clients",children:[]},{level:2,title:"Add Vue as standalone SPA (show how API calls will not work without CORS)",slug:"add-vue-as-standalone-spa-show-how-api-calls-will-not-work-without-cors",children:[]},{level:2,title:"Add CORS",slug:"add-cors",children:[]},{level:2,title:"Add NGINX and remove CORS",slug:"add-nginx-and-remove-cors",children:[]},{level:2,title:"Add NGINX Dockerfile for local development",slug:"add-nginx-dockerfile-for-local-development",children:[]},{level:2,title:"Setup Django Channels (settings, routers, consumers, async tests)",slug:"setup-django-channels-settings-routers-consumers-async-tests",children:[]},{level:2,title:"Setup git hooks in docker-compose",slug:"setup-git-hooks-in-docker-compose",children:[]},{level:2,title:"Setup Vue in NGINX (web-sockets for hot reloading, index.html, etc)",slug:"setup-vue-in-nginx-web-sockets-for-hot-reloading-index-html-etc",children:[]},{level:2,title:"Add Session Authentication for Vue SPA",slug:"add-session-authentication-for-vue-spa",children:[]},{level:2,title:"Show how to setup e2e tests with Cypress",slug:"show-how-to-setup-e2e-tests-with-cypress",children:[]},{level:2,title:"Draw a project diagram using diagrams.net",slug:"draw-a-project-diagram-using-diagrams-net",children:[]},{level:2,title:"Generate model visualizations with graphviz",slug:"generate-model-visualizations-with-graphviz",children:[]},{level:2,title:"VSCode remote container",slug:"vscode-remote-container",children:[]},{level:2,title:"Add a privacy policy",slug:"add-a-privacy-policy",children:[]},{level:2,title:"Cookie consent form",slug:"cookie-consent-form",children:[]},{level:2,title:"Add a constants file",slug:"add-a-constants-file",children:[]},{level:2,title:"Install poetry",slug:"install-poetry",children:[]},{level:2,title:"Run poetry init to setup pyproject.toml",slug:"run-poetry-init-to-setup-pyproject-toml",children:[]},{level:2,title:"Add project dependencies using SemVer notation",slug:"add-project-dependencies-using-semver-notation",children:[]},{level:2,title:"Add make command to export requirements.txt and requirements_dev.txt from poetry",slug:"add-make-command-to-export-requirements-txt-and-requirements-dev-txt-from-poetry",children:[]},{level:2,title:"Add new python dependencies with poetry add",slug:"add-new-python-dependencies-with-poetry-add",children:[]},{level:2,title:"Configure VSCode to use Poetry environment",slug:"configure-vscode-to-use-poetry-environment",children:[]},{level:2,title:"microk8s setup",slug:"microk8s-setup",children:[]},{level:2,title:"Install cdk8s-cli",slug:"install-cdk8s-cli",children:[]},{level:2,title:"Start a cdk8s project in the k8s directory",slug:"start-a-cdk8s-project-in-the-k8s-directory",children:[]},{level:2,title:"WSL",slug:"wsl",children:[]},{level:2,title:"Update kubectl",slug:"update-kubectl",children:[]},{level:2,title:"doctl",slug:"doctl",children:[]},{level:2,title:"CDK",slug:"cdk",children:[{level:3,title:"About CDK",slug:"about-cdk",children:[]},{level:3,title:"Install CDK",slug:"install-cdk",children:[]},{level:3,title:"Start the CDK project",slug:"start-the-cdk-project",children:[]},{level:3,title:"Install django-cdk",slug:"install-django-cdk",children:[]},{level:3,title:"npm run watch",slug:"npm-run-watch",children:[]},{level:3,title:"Synthesize the stack",slug:"synthesize-the-stack",children:[]}]},{level:2,title:"Add image to blog post",slug:"add-image-to-blog-post",children:[{level:3,title:"Install dependencies",slug:"install-dependencies",children:[]},{level:3,title:"Add image field to Post model",slug:"add-image-field-to-post-model",children:[]},{level:3,title:"Make and run migrations",slug:"make-and-run-migrations",children:[]},{level:3,title:"Create backend media directory",slug:"create-backend-media-directory",children:[]},{level:3,title:"Add .gitignore to media directory",slug:"add-gitignore-to-media-directory",children:[]},{level:3,title:"Add URL patterns for serving media locally",slug:"add-url-patterns-for-serving-media-locally",children:[]},{level:3,title:"Add image to Django template",slug:"add-image-to-django-template",children:[]},{level:3,title:"Add styling to the image",slug:"add-styling-to-the-image",children:[]},{level:3,title:"Add image upload button for HTML form",slug:"add-image-upload-button-for-html-form",children:[]},{level:3,title:"Update PostForm",slug:"update-postform",children:[]},{level:3,title:"Add image URL to PostSerializer",slug:"add-image-url-to-postserializer",children:[]},{level:3,title:"Add images for test",slug:"add-images-for-test",children:[]},{level:3,title:"Add a field to the Post Model Factory",slug:"add-a-field-to-the-post-model-factory",children:[]},{level:3,title:"Add cypress-file-upload",slug:"add-cypress-file-upload",children:[]},{level:3,title:"Install Graphene extension for image support in GraphQL",slug:"install-graphene-extension-for-image-support-in-graphql",children:[]},{level:3,title:"Add images to test case logic",slug:"add-images-to-test-case-logic",children:[]}]},{level:2,title:"GraphQL (together with or replacing DRF/REST)",slug:"graphql-together-with-or-replacing-drf-rest",children:[]},{level:2,title:"Spatial and Geographic Databases (PostGIS)",slug:"spatial-and-geographic-databases-postgis",children:[]},{level:2,title:"Portainer UI for viewing containers and logs",slug:"portainer-ui-for-viewing-containers-and-logs",children:[]},{level:2,title:"Wagtail for managing blog content",slug:"wagtail-for-managing-blog-content",children:[]}],filePathRelative:"guide/step-by-step/README.md",git:{updatedTime:1745500356e3,contributors:[]}}},2190:(n,s,a)=>{a.r(s),a.d(s,{default:()=>ds});var e=a(6252);const t=(0,e.uE)('<h1 id="step-by-step-guide" tabindex="-1"><a class="header-anchor" href="#step-by-step-guide" aria-hidden="true">#</a> Step by Step Guide ðŸš€</h1><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>This section is mostly outdated and needs to be removed or re-written. Some of the content might be helpful for someone setting up a new Django project, but it doesn&#39;t reflect the most recent changes in the <code>django-step-by-step</code> repo.</p></div><p>This document covers Django project setup step by step at a high level of detail. Starting from a blank directory, this guide will progressively build an application in a local development environment that uses Django as the core service. In addition to Django, there is a demonstration on how to use Vue.js along with Django in a &quot;progressive&quot; fashion. Vue is a personal choice, but it can be easily exchanged with any other frontend library or framework.</p><h2 id="what-is-a-django-application" tabindex="-1"><a class="header-anchor" href="#what-is-a-django-application" aria-hidden="true">#</a> What is a Django application?</h2><p>Django application is an ambiguous term. There are three possible meanings that come to mind when someone says &quot;Django application&quot;:</p><ol><li>A web application built using the Django Web framework. Examples include YouTube, Pinterest, reddit, etc.</li><li>A reusable &quot;plugin&quot; that can installed in another Django application that a developer is creating.</li><li>A logical grouping of code in a Django application (these are typically called <code>apps</code>, and are created with the management command <code>startapp</code>)</li></ol><p>This guide will focus on the first definition of &quot;Django application&quot;. The application logic and data model will be very simple so that the guide can focus on showing how to build a productive Django development environment.</p>',7),p=(0,e.Uk)("There are tools that generate Django projects with complete development environments, "),o={href:"https://github.com/pydanny/cookiecutter-django",target:"_blank",rel:"noopener noreferrer"},l=(0,e.Uk)("cookiecutter-django"),r=(0,e.Uk)(' is a popular example. This guide is focusing on the order of each step and explaining how and why certain architectural decisions are made. This project will not provide a "production ready" template, but it will be developed in a way that will support multiple deployment scenarios such as containers and functions (such as AWS Lambda). This guide will cover continuous integration (automated acceptance testing)'),c=(0,e.uE)('<p>Again, the goal of this project is to walk the reader through each step of setting up a Django project from scratch. Some of the topics include:</p><ul><li>How to setup your development environment on Windows (WSL 2) and Linux environment</li><li>Popular tools used to help build Django applications (testing, debugging, etc.)</li><li>Authentication and social authentication</li><li>Different ways to incorporate Vue.js and which one you should choose for your next project if you intend on using Vue.</li><li>How docker can be used in a Django application development workflow and reasons you might want to use docker</li></ul><p>Writing this is not easy. There are lots of decisions to make regarding what to explain and selecting which combination of competing technologies to use.</p><h2 id="start-with-a-blank-git-repo-and-create-two-files-readme-md-and-step-by-step-md" tabindex="-1"><a class="header-anchor" href="#start-with-a-blank-git-repo-and-create-two-files-readme-md-and-step-by-step-md" aria-hidden="true">#</a> Start with a blank git repo and create two files: <code>README.md</code> and <code>STEP_BY_STEP.md</code>:</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>touch README.md STEP_BY_STEP.md\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><code>README.md</code> will be a brief introduction to the project followed by simple instructions for setting up the project locally. <code>STEP_BY_STEP.md</code> will include our step-by-step instructions for building this project.</p><p>This file will document our project setup, step by step.</p><h2 id="create-a-virtual-environment" tabindex="-1"><a class="header-anchor" href="#create-a-virtual-environment" aria-hidden="true">#</a> Create a virtual environment</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>python3 -m venv .local-env\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="activate-the-virtual-environment" tabindex="-1"><a class="header-anchor" href="#activate-the-virtual-environment" aria-hidden="true">#</a> Activate the virtual environment</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>source .local-env/bin/activate\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="make-sure-pip-is-upgraded-to-the-latest-version" tabindex="-1"><a class="header-anchor" href="#make-sure-pip-is-upgraded-to-the-latest-version" aria-hidden="true">#</a> Make sure pip is upgraded to the latest version</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>python3 -m pip install --upgrade pip\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="install-django" tabindex="-1"><a class="header-anchor" href="#install-django" aria-hidden="true">#</a> Install Django</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>pip install Django==3.1.5\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Install the latest version of Django. You may also want to install the LTS version. See https://www.djangoproject.com/download/ for more information about Django&#39;s long term support releases.</p><h2 id="start-a-new-django-project" tabindex="-1"><a class="header-anchor" href="#start-a-new-django-project" aria-hidden="true">#</a> Start a new Django project</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>django-admin startproject backend\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>This creates a project with the following structure:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ tree -L 2 backend\n\nbackend\nâ”œâ”€â”€ backend\nâ”‚   â”œâ”€â”€ asgi.py\nâ”‚   â”œâ”€â”€ __init__.py\nâ”‚   â”œâ”€â”€ __pycache__\nâ”‚   â”œâ”€â”€ settings.py\nâ”‚   â”œâ”€â”€ urls.py\nâ”‚   â””â”€â”€ wsgi.py\nâ”œâ”€â”€ db.sqlite3\nâ””â”€â”€ manage.py\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Note that there are two &quot;backend&quot; folders. I&#39;ll refer to these as either <code>backend/</code> or <code>backend/backend/</code> for the nested <code>backend</code> folder that contains <code>settings.py</code></p><h2 id="add-a-gitignore-file-to-the-backend-directory" tabindex="-1"><a class="header-anchor" href="#add-a-gitignore-file-to-the-backend-directory" aria-hidden="true">#</a> Add a <code>.gitignore</code> file to the <code>backend</code> directory</h2><p>Here&#39;s a good <code>.gitignore</code> file for Python/Django applications:</p>',23),i={href:"https://www.toptal.com/developers/gitignore/api/python,django",target:"_blank",rel:"noopener noreferrer"},u=(0,e.Uk)("https://www.toptal.com/developers/gitignore/api/python,django"),d=(0,e.uE)('<div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>wget -O backend/.gitignore https://www.toptal.com/developers/gitignore/api/python,django\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="add-a-gitignore-file-to-the-root-of-the-project" tabindex="-1"><a class="header-anchor" href="#add-a-gitignore-file-to-the-root-of-the-project" aria-hidden="true">#</a> Add a <code>.gitignore</code> file to the root of the project</h2><p>Add another `.gitignore file, but this time to the root of the project:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>echo &quot;.env&quot; &gt; .gitignore\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="migrate-and-runserver" tabindex="-1"><a class="header-anchor" href="#migrate-and-runserver" aria-hidden="true">#</a> migrate and runserver</h2><p>Let&#39;s start our Django project to make sure that everything is working properly:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>./backend/manage.py migrate &amp;&amp; ./backend/manage.py runserver\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>./backend/manage.py migrate &amp;&amp; ./backend/manage.py runserver\nOperations to perform:\n  Apply all migrations: admin, auth, contenttypes, sessions\nRunning migrations:\n  Applying contenttypes.0001_initial... OK\n  Applying auth.0001_initial... OK\n  Applying admin.0001_initial... OK\n  Applying admin.0002_logentry_remove_auto_add... OK\n  Applying admin.0003_logentry_add_action_flag_choices... OK\n  Applying contenttypes.0002_remove_content_type_name... OK\n  Applying auth.0002_alter_permission_name_max_length... OK\n  Applying auth.0003_alter_user_email_max_length... OK\n  Applying auth.0004_alter_user_username_opts... OK\n  Applying auth.0005_alter_user_last_login_null... OK\n  Applying auth.0006_require_contenttypes_0002... OK\n  Applying auth.0007_alter_validators_add_error_messages... OK\n  Applying auth.0008_alter_user_username_max_length... OK\n  Applying auth.0009_alter_user_last_name_max_length... OK\n  Applying auth.0010_alter_group_name_max_length... OK\n  Applying auth.0011_update_proxy_permissions... OK\n  Applying auth.0012_alter_user_first_name_max_length... OK\n  Applying sessions.0001_initial... OK\nWatching for file changes with StatReloader\nPerforming system checks...\n\nSystem check identified no issues (0 silenced).\nFebruary 01, 2021 - 00:00:00\nDjango version 3.1.5, using settings &#39;backend.settings&#39;\nStarting development server at http://127.0.0.1:8000/\nQuit the server with CONTROL-C.\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>You should see the rocket ship animation with the message:</p><blockquote><p>The install worked successfully! Congratulations!</p></blockquote><p>Note that a file called <code>db.sqlite3</code> was created in <code>backend/</code>. Django uses a default SQLite file-based database for simplicity. We will use Postgres instead of sqlite3, but we will make this change later. For our purposes, SQLite and Postgres function similarly in our local development environment.</p><h2 id="settings-py-file-change-secret-key" tabindex="-1"><a class="header-anchor" href="#settings-py-file-change-secret-key" aria-hidden="true">#</a> <code>settings.py</code> file change: <code>SECRET_KEY</code></h2><p>By default, Django includes an automatically-generated, hard-coded sensitive value in our settings file called <code>SECRET_KEY</code>.</p><p>Open <code>backend/backend/settings.py</code> and change <code>SECRET_KEY</code> to the following:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>SECRET_KEY <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;SECRET_KEY&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;my-secret-key&quot;</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>also, add the following line to the top of the same file:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> os\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>This tells our settings file to use the environment variable called <code>SECRET_KEY</code> as the value for the Django settings called <code>SECRET_KEY</code>. If there is no environment variable called <code>SECRET_KEY</code>, the value of <code>my-secret-key</code> will be used as a fallback. At this point we haven&#39;t set any environment variables yet, so the value of <code>my-secret-key</code> will be used in our local development environment. Using a fallback value for the <code>SECRET_KEY</code> setting is probably not a good idea. If we forget to set a secure <code>SECRET_KEY</code> value in our production environment, we don&#39;t want to use a non-secure <code>SECRET_KEY</code> value like <code>my-secret-key</code>, so we will remove the default setting and set the <code>SECRET_KEY</code> value explicitly in both the local and production environments.</p><h2 id="settings-py-file-change-debug" tabindex="-1"><a class="header-anchor" href="#settings-py-file-change-debug" aria-hidden="true">#</a> <code>settings.py</code> file change: <code>DEBUG</code></h2><p>We also don&#39;t want to hard-code the <code>DEBUG</code> setting, so this setting value can be changed to:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>DEBUG <span class="token operator">=</span> <span class="token builtin">bool</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;DEBUG&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>This uses a <code>True</code> default value for <code>DEBUG</code> if the <code>DEBUG</code> environment variable is not set.</p><h2 id="move-backend-backend-settings-py-to-backend-backend-settings-base-py-and-add-backend-backend-settings-init-py" tabindex="-1"><a class="header-anchor" href="#move-backend-backend-settings-py-to-backend-backend-settings-base-py-and-add-backend-backend-settings-init-py" aria-hidden="true">#</a> Move <code>backend/backend/settings.py</code> to <code>backend/backend/settings/base.py</code> and add `backend/backend/settings/<strong>init</strong>.py</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir backend/backend/settings &amp;&amp; touch backend/backend/settings/__init__.py &amp;&amp; mv backend/backend/settings.py backend/backend/settings/base.py\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>If we try to restart the server, we will see that it doesn&#39;t work:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>django.core.exceptions.ImproperlyConfigured: The SECRET_KEY setting must not be empty.\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="change-the-value-of-base-dir" tabindex="-1"><a class="header-anchor" href="#change-the-value-of-base-dir" aria-hidden="true">#</a> Change the value of <code>BASE_DIR</code></h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>BASE_DIR <span class="token operator">=</span> Path<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">.</span>resolve<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>parent<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>parent\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>We need to add another <code>.parent</code> since the settings module used is now one layer deeper</p><h2 id="create-backend-backend-settings-development-py" tabindex="-1"><a class="header-anchor" href="#create-backend-backend-settings-development-py" aria-hidden="true">#</a> Create <code>backend/backend/settings/development.py</code></h2><p>The <code>base.py</code> settings module will be used for defining settings that are common to both the development and production environment. We will define development-specific settings in another file that will inherit values from <code>base.py</code>. Create this file:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>echo &quot;from .base import *  # noqa&quot; &gt;&gt; backend/backend/settings/development.py\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="change-django-settings-module-in-backend-manage-py-again" tabindex="-1"><a class="header-anchor" href="#change-django-settings-module-in-backend-manage-py-again" aria-hidden="true">#</a> Change <code>DJANGO_SETTINGS_MODULE</code> in <code>backend/manage.py</code> again</h2><p>Now change the default <code>DJANGO_SETTINGS_MODULE</code> value to <code>backend.settings.development</code>:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">&#39;DJANGO_SETTINGS_MODULE&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;backend.settings.development&#39;</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="add-a-requirements-folder-with-three-files-base-txt-dev-txt-and-test-txt" tabindex="-1"><a class="header-anchor" href="#add-a-requirements-folder-with-three-files-base-txt-dev-txt-and-test-txt" aria-hidden="true">#</a> Add a requirements folder with three files: <code>base.txt</code>, <code>dev.txt</code> and <code>test.txt</code></h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir backend/requirements &amp;&amp; touch backend/requirements/{base,dev,test}.txt\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>In <code>base.txt</code>, add the only dependency that we have so far, which is Django:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>echo &quot;Django==3.1.5&quot; &gt;&gt; backend/requirements/base.txt\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><code>base.txt</code>:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Django==3.1.5\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>We will add new requirements to these three development files as we build out our project.</p><p>The new project directory structure looks like this:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ tree -L 3 backend/\nbackend/\nâ”œâ”€â”€ backend\nâ”‚   â”œâ”€â”€ asgi.py\nâ”‚   â”œâ”€â”€ __init__.py\nâ”‚   â”œâ”€â”€ __pycache__\nâ”‚   â”‚   â”œâ”€â”€ __init__.cpython-38.pyc\nâ”‚   â”‚   â”œâ”€â”€ settings.cpython-38.pyc\nâ”‚   â”‚   â”œâ”€â”€ urls.cpython-38.pyc\nâ”‚   â”‚   â””â”€â”€ wsgi.cpython-38.pyc\nâ”‚   â”œâ”€â”€ settings\nâ”‚   â”‚   â”œâ”€â”€ base.py\nâ”‚   â”‚   â”œâ”€â”€ development.py\nâ”‚   â”‚   â”œâ”€â”€ __init__.py\nâ”‚   â”‚   â””â”€â”€ __pycache__\nâ”‚   â”œâ”€â”€ urls.py\nâ”‚   â””â”€â”€ wsgi.py\nâ”œâ”€â”€ db.sqlite3\nâ”œâ”€â”€ manage.py\nâ””â”€â”€ requirements\n    â”œâ”€â”€ base.txt\n    â”œâ”€â”€ dev.txt\n    â””â”€â”€ test.txt\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="install-django-debug-toolbar" tabindex="-1"><a class="header-anchor" href="#install-django-debug-toolbar" aria-hidden="true">#</a> Install Django Debug Toolbar</h2><p>Django Debug Toolbar is a great tool for debugging several different aspects of Django, including ORM optimizations, caching, etc.</p>',46),b=(0,e.Uk)("The installation instructions from "),m={href:"https://django-debug-toolbar.readthedocs.io/en/latest/installation.html",target:"_blank",rel:"noopener noreferrer"},k=(0,e.Uk)("here"),h=(0,e.Uk)(" are pretty straightforward. Instead of running "),g=(0,e.Wm)("code",null,"python -m pip install django-debug-toolbar",-1),v=(0,e.Uk)(", we can add that dependency directly to our project's "),y=(0,e.Wm)("code",null,"requirements/dev.txt",-1),f=(0,e.Uk)(" file since the Django Debug Toolbar should only be used in local development."),w=(0,e.uE)('<div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>echo &quot;django-debug-toolbar==3.2&quot; &gt;&gt; backend/requirements/dev.txt\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Next, install the dependencies:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>pip install -r backend/requirements/dev.txt\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Next there are some Django settings to change. Similar to how we only want the Debug Toolbar installed in our project dependencies for our local development environment, the settings to enable the debug toolbar should only be used in the development environment. This is exactly what the <code>backend/backend/settings/development.py</code> file is for. We will make the following changes in the <code>development.py</code> settings file:</p><ul><li>Add <code>&#39;debug_toolbar&#39;,</code> to <code>INSTALLED_APPS</code></li><li>Add Debug Toolbar to URLconf</li><li>Add Debug Toolbar to middleware</li></ul><p>Here&#39;s the documentation for Django Debug Toolbar:</p>',6),x={href:"https://django-debug-toolbar.readthedocs.io/en/1.0/configuration.html",target:"_blank",rel:"noopener noreferrer"},_=(0,e.Uk)("https://django-debug-toolbar.readthedocs.io/en/1.0/configuration.html"),q=(0,e.uE)('<p>Consider adding some options for the debug toolbar in the <code>development</code> settings module:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>DEBUG_TOOLBAR_CONFIG = {\n    &quot;SHOW_COLLAPSED&quot;: True,\n}\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="add-debug-toolbar-to-installed-apps" tabindex="-1"><a class="header-anchor" href="#add-debug-toolbar-to-installed-apps" aria-hidden="true">#</a> Add <code>debug_toolbar</code> to <code>INSTALLED_APPS</code></h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># backend/backend/settings/development.py</span>\nINSTALLED_APPS <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token string">&#39;debug_toolbar&#39;</span><span class="token punctuation">]</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="add-urlconf-for-debug-toolbar" tabindex="-1"><a class="header-anchor" href="#add-urlconf-for-debug-toolbar" aria-hidden="true">#</a> Add URLconf for debug toolbar</h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> debug_toolbar\n<span class="token keyword">from</span> django<span class="token punctuation">.</span>conf <span class="token keyword">import</span> settings\n<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin\n<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> include<span class="token punctuation">,</span> path\n\nurlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>\n    path<span class="token punctuation">(</span><span class="token string">&#39;admin/&#39;</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span>\n\n<span class="token keyword">if</span> settings<span class="token punctuation">.</span>DEBUG<span class="token punctuation">:</span>\n    urlpatterns <span class="token operator">+=</span> <span class="token punctuation">[</span>\n        path<span class="token punctuation">(</span><span class="token string">&#39;__debug__/&#39;</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span>debug_toolbar<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">]</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="add-debug-toolbar-to-middleware" tabindex="-1"><a class="header-anchor" href="#add-debug-toolbar-to-middleware" aria-hidden="true">#</a> Add debug toolbar to middleware</h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># backend/backend/settings/development.py</span>\nMIDDLEWARE <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token string">&#39;debug_toolbar.middleware.DebugToolbarMiddleware&#39;</span><span class="token punctuation">]</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="set-internal-ips-for-debug-toolbar" tabindex="-1"><a class="header-anchor" href="#set-internal-ips-for-debug-toolbar" aria-hidden="true">#</a> Set <code>INTERNAL_IPS</code> for debug toolbar</h2><p>From the Django Debug Toolbar docs:</p><blockquote><p>The Debug Toolbar is shown only if your IP address is listed in the <code>INTERNAL_IPS</code> setting.</p></blockquote><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># backend/backend/settings/development.py</span>\nINTERNAL_IPS <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;127.0.0.1&#39;</span><span class="token punctuation">]</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="create-a-superuser-with-createsuperuser" tabindex="-1"><a class="header-anchor" href="#create-a-superuser-with-createsuperuser" aria-hidden="true">#</a> Create a superuser with <code>createsuperuser</code></h2><p>At this point we have a very basic Django application. Django projects are created with a fully-featured admin. The admin is an interface where you can easily create, read, update and delete items from your database. We can view the admin by visiting <code>http://127.0.0.1:8000/admin</code>. This should prompt us for a username and password. We have to create this with the <code>createsuperuser</code> management command:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>DJANGO_SUPERUSER_PASSWORD=Qazwsx1! DJANGO_SUPERUSER_USERNAME=brian DJANGO_SUPERUSER_EMAIL=brian@email.com backend/manage.py createsuperuser --no-input\nSuperuser created successfully.\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>This command will create the necessary environment variables for the username, email and password for the superuser and create that user without prompting you to type these in the terminal. Try logging in with these credentials to make sure that everything works.</p><h2 id="rename-the-admin-url-optional" tabindex="-1"><a class="header-anchor" href="#rename-the-admin-url-optional" aria-hidden="true">#</a> Rename the <code>/admin</code> URL (Optional)</h2><p>To prevent bots from trying to login to our admin, it is a good idea change the default URL path that Django sets for the Django admin. Let&#39;s change <code>admin/</code> to <code>my-admin-portal/</code>:</p><p><code>backend/backend/urls.py</code> should now look like this</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>\n    path<span class="token punctuation">(</span><span class="token string">&#39;my-admin-portal/&#39;</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="setup-a-django-app-called-core" tabindex="-1"><a class="header-anchor" href="#setup-a-django-app-called-core" aria-hidden="true">#</a> Setup a Django app called <code>core</code></h2><p>Next we will add the first app to this Django project. Apps are Django&#39;s way of encapsulating logic. My Django projects typically have three apps: <code>core</code>, <code>accounts</code> and some other app that contains the majority of my project&#39;s logic.</p><p>I use the <code>core</code> app for models, views, middleware and other logic that isn&#39;t directly related to our application&#39;s logic. For example, a view that is used for application health checks, a model that is used for logging all requests, and a middleware used to save a record in our database for each request. We will implement these later, but for now let&#39;s just add the <code>core</code> app:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir -p backend/apps/core &amp;&amp; django-admin startapp core ./backend/apps/core\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>The <code>core</code> app is created in a folder called <code>apps</code> in the top-level <code>backend/</code> directory.</p><p>When we add this app to <code>INSTALLED_APPS</code> in our <code>base.py</code> settings file, we need to add it like this:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token string">&#39;django.contrib.admin&#39;</span><span class="token punctuation">,</span>\n    <span class="token string">&#39;django.contrib.auth&#39;</span><span class="token punctuation">,</span>\n    <span class="token string">&#39;django.contrib.contenttypes&#39;</span><span class="token punctuation">,</span>\n    <span class="token string">&#39;django.contrib.sessions&#39;</span><span class="token punctuation">,</span>\n    <span class="token string">&#39;django.contrib.messages&#39;</span><span class="token punctuation">,</span>\n    <span class="token string">&#39;django.contrib.staticfiles&#39;</span><span class="token punctuation">,</span>\n\n    <span class="token string">&#39;apps.core&#39;</span>\n<span class="token punctuation">]</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="setup-a-django-app-called-accounts" tabindex="-1"><a class="header-anchor" href="#setup-a-django-app-called-accounts" aria-hidden="true">#</a> Setup a Django app called <code>accounts</code></h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir -p backend/apps/accounts &amp;&amp; django-admin startapp accounts ./backend/apps/accounts\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Add <code>&#39;apps.accounts&#39;</code> to <code>INSTALLED_APPS</code> in <code>base.py</code></p><h2 id="setup-a-custom-user-model" tabindex="-1"><a class="header-anchor" href="#setup-a-custom-user-model" aria-hidden="true">#</a> Setup a Custom User Model</h2>',31),A=(0,e.Uk)("Reference: "),j={href:"https://testdriven.io/blog/django-custom-user-model/",target:"_blank",rel:"noopener noreferrer"},S=(0,e.Uk)("https://testdriven.io/blog/django-custom-user-model/"),E=(0,e.uE)('<p>I have been using the steps described in this article in my recent Django projects for setting up a custom user model. This is a comprehensive guide that covers:</p><ul><li>Tests</li><li>ModelManager</li><li>Model</li><li>Forms</li><li>Admin</li><li>Settings</li></ul><p>Setting a custom user model is important to do early in the development of your project (if it is something your project requires)</p><p>We can start by creating the custom user model:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># accounts/models.py</span>\n<span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models\n<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> AbstractUser\n<span class="token keyword">from</span> django<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>translation <span class="token keyword">import</span> gettext_lazy <span class="token keyword">as</span> _\n\n<span class="token keyword">from</span> <span class="token punctuation">.</span>managers <span class="token keyword">import</span> CustomUserManager\n\n\n<span class="token keyword">class</span> <span class="token class-name">CustomUser</span><span class="token punctuation">(</span>AbstractUser<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    username <span class="token operator">=</span> <span class="token boolean">None</span>\n    email <span class="token operator">=</span> models<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span>_<span class="token punctuation">(</span><span class="token string">&#39;email address&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n\n    USERNAME_FIELD <span class="token operator">=</span> <span class="token string">&#39;email&#39;</span>\n    REQUIRED_FIELDS <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n\n    objects <span class="token operator">=</span> CustomUserManager<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>email\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="set-auth-user-model-accounts-customuser-in-base-py-settings" tabindex="-1"><a class="header-anchor" href="#set-auth-user-model-accounts-customuser-in-base-py-settings" aria-hidden="true">#</a> Set <code>AUTH_USER_MODEL = &#39;accounts.CustomUser&#39;</code> in <code>base.py</code> settings</h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>AUTH_USER_MODEL <span class="token operator">=</span> <span class="token string">&#39;accounts.CustomUser&#39;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><strong>Note</strong>: we don&#39;t set <code>AUTH_USER_MODEL</code> to <code>apps.accounts.CustomUser</code></p><p>We can&#39;t run <code>makemigrations</code> just yet, we need to add the <code>CustomUserManager</code> for the <code>CustomUser</code> model.</p><h2 id="add-customusermanager-for-customuser-model" tabindex="-1"><a class="header-anchor" href="#add-customusermanager-for-customuser-model" aria-hidden="true">#</a> Add <code>CustomUserManager</code> for <code>CustomUser</code> model</h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># apps/accounts/managers.py</span>\n<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>base_user <span class="token keyword">import</span> BaseUserManager\n<span class="token keyword">from</span> django<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>translation <span class="token keyword">import</span> gettext_lazy <span class="token keyword">as</span> _\n\n\n<span class="token keyword">class</span> <span class="token class-name">CustomUserManager</span><span class="token punctuation">(</span>BaseUserManager<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token triple-quoted-string string">&quot;&quot;&quot;\n    Custom user model manager where email is the unique identifiers\n    for authentication instead of usernames.\n    &quot;&quot;&quot;</span>\n    <span class="token keyword">def</span> <span class="token function">create_user</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> email<span class="token punctuation">,</span> password<span class="token punctuation">,</span> <span class="token operator">**</span>extra_fields<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token triple-quoted-string string">&quot;&quot;&quot;\n        Create and save a User with the given email and password.\n        &quot;&quot;&quot;</span>\n        <span class="token keyword">if</span> <span class="token keyword">not</span> email<span class="token punctuation">:</span>\n            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span>_<span class="token punctuation">(</span><span class="token string">&#39;The Email must be set&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        email <span class="token operator">=</span> self<span class="token punctuation">.</span>normalize_email<span class="token punctuation">(</span>email<span class="token punctuation">)</span>\n        user <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">(</span>email<span class="token operator">=</span>email<span class="token punctuation">,</span> <span class="token operator">**</span>extra_fields<span class="token punctuation">)</span>\n        user<span class="token punctuation">.</span>set_password<span class="token punctuation">(</span>password<span class="token punctuation">)</span>\n        user<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token keyword">return</span> user\n\n    <span class="token keyword">def</span> <span class="token function">create_superuser</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> email<span class="token punctuation">,</span> password<span class="token punctuation">,</span> <span class="token operator">**</span>extra_fields<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token triple-quoted-string string">&quot;&quot;&quot;\n        Create and save a SuperUser with the given email and password.\n        &quot;&quot;&quot;</span>\n        extra_fields<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">&#39;is_staff&#39;</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>\n        extra_fields<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">&#39;is_superuser&#39;</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>\n        extra_fields<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">&#39;is_active&#39;</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>\n\n        <span class="token keyword">if</span> extra_fields<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;is_staff&#39;</span><span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">True</span><span class="token punctuation">:</span>\n            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span>_<span class="token punctuation">(</span><span class="token string">&#39;Superuser must have is_staff=True.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token keyword">if</span> extra_fields<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;is_superuser&#39;</span><span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">True</span><span class="token punctuation">:</span>\n            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span>_<span class="token punctuation">(</span><span class="token string">&#39;Superuser must have is_superuser=True.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>create_user<span class="token punctuation">(</span>email<span class="token punctuation">,</span> password<span class="token punctuation">,</span> <span class="token operator">**</span>extra_fields<span class="token punctuation">)</span>\n\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h2 id="add-forms-for-customuser-admin" tabindex="-1"><a class="header-anchor" href="#add-forms-for-customuser-admin" aria-hidden="true">#</a> Add forms for CustomUser admin</h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>forms <span class="token keyword">import</span> UserCreationForm<span class="token punctuation">,</span> UserChangeForm\n\n<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> CustomUser\n\n\n<span class="token keyword">class</span> <span class="token class-name">CustomUserCreationForm</span><span class="token punctuation">(</span>UserCreationForm<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">(</span>UserCreationForm<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        model <span class="token operator">=</span> CustomUser\n        fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span><span class="token punctuation">)</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">CustomUserChangeForm</span><span class="token punctuation">(</span>UserChangeForm<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>\n        model <span class="token operator">=</span> CustomUser\n        fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="add-customuser-admin" tabindex="-1"><a class="header-anchor" href="#add-customuser-admin" aria-hidden="true">#</a> Add CustomUser admin</h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin\n<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>admin <span class="token keyword">import</span> UserAdmin\n\n<span class="token keyword">from</span> <span class="token punctuation">.</span>forms <span class="token keyword">import</span> CustomUserCreationForm<span class="token punctuation">,</span> CustomUserChangeForm\n<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> CustomUser\n\n\n<span class="token keyword">class</span> <span class="token class-name">CustomUserAdmin</span><span class="token punctuation">(</span>UserAdmin<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    add_form <span class="token operator">=</span> CustomUserCreationForm\n    form <span class="token operator">=</span> CustomUserChangeForm\n    model <span class="token operator">=</span> CustomUser\n    list_display <span class="token operator">=</span> <span class="token punctuation">(</span>\n        <span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;is_staff&quot;</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;is_active&quot;</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span>\n    list_filter <span class="token operator">=</span> <span class="token punctuation">(</span>\n        <span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;is_staff&quot;</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;is_active&quot;</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span>\n    fieldsets <span class="token operator">=</span> <span class="token punctuation">(</span>\n        <span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;fields&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token punctuation">(</span><span class="token string">&quot;Permissions&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;fields&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">&quot;is_staff&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;is_active&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span>\n    add_fieldsets <span class="token operator">=</span> <span class="token punctuation">(</span>\n        <span class="token punctuation">(</span>\n            <span class="token boolean">None</span><span class="token punctuation">,</span>\n            <span class="token punctuation">{</span>\n                <span class="token string">&quot;classes&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">&quot;wide&quot;</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token string">&quot;fields&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>\n                    <span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span>\n                    <span class="token string">&quot;password1&quot;</span><span class="token punctuation">,</span>\n                    <span class="token string">&quot;password2&quot;</span><span class="token punctuation">,</span>\n                    <span class="token string">&quot;is_staff&quot;</span><span class="token punctuation">,</span>\n                    <span class="token string">&quot;is_active&quot;</span><span class="token punctuation">,</span>\n                <span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span>\n    search_fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span><span class="token punctuation">)</span>\n    ordering <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span><span class="token punctuation">)</span>\n\n\nadmin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>CustomUser<span class="token punctuation">,</span> CustomUserAdmin<span class="token punctuation">)</span>\n\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h2 id="add-tests-for-the-customuser-model" tabindex="-1"><a class="header-anchor" href="#add-tests-for-the-customuser-model" aria-hidden="true">#</a> Add tests for the <code>CustomUser</code> model</h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># apps/accounts/tests.py</span>\n<span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> TestCase\n<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth <span class="token keyword">import</span> get_user_model\n\n\n<span class="token keyword">class</span> <span class="token class-name">UsersManagersTests</span><span class="token punctuation">(</span>TestCase<span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token keyword">def</span> <span class="token function">test_create_user</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        User <span class="token operator">=</span> get_user_model<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        user <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create_user<span class="token punctuation">(</span>email<span class="token operator">=</span><span class="token string">&#39;normal@user.com&#39;</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">&#39;foo&#39;</span><span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>user<span class="token punctuation">.</span>email<span class="token punctuation">,</span> <span class="token string">&#39;normal@user.com&#39;</span><span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>assertTrue<span class="token punctuation">(</span>user<span class="token punctuation">.</span>is_active<span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>assertFalse<span class="token punctuation">(</span>user<span class="token punctuation">.</span>is_staff<span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>assertFalse<span class="token punctuation">(</span>user<span class="token punctuation">.</span>is_superuser<span class="token punctuation">)</span>\n        <span class="token keyword">try</span><span class="token punctuation">:</span>\n            <span class="token comment"># username is None for the AbstractUser option</span>\n            <span class="token comment"># username does not exist for the AbstractBaseUser option</span>\n            self<span class="token punctuation">.</span>assertIsNone<span class="token punctuation">(</span>user<span class="token punctuation">.</span>username<span class="token punctuation">)</span>\n        <span class="token keyword">except</span> AttributeError<span class="token punctuation">:</span>\n            <span class="token keyword">pass</span>\n        <span class="token keyword">with</span> self<span class="token punctuation">.</span>assertRaises<span class="token punctuation">(</span>TypeError<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create_user<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token keyword">with</span> self<span class="token punctuation">.</span>assertRaises<span class="token punctuation">(</span>TypeError<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create_user<span class="token punctuation">(</span>email<span class="token operator">=</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>\n        <span class="token keyword">with</span> self<span class="token punctuation">.</span>assertRaises<span class="token punctuation">(</span>ValueError<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create_user<span class="token punctuation">(</span>email<span class="token operator">=</span><span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">test_create_superuser</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        User <span class="token operator">=</span> get_user_model<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        admin_user <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create_superuser<span class="token punctuation">(</span><span class="token string">&#39;super@user.com&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;foo&#39;</span><span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>admin_user<span class="token punctuation">.</span>email<span class="token punctuation">,</span> <span class="token string">&#39;super@user.com&#39;</span><span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>assertTrue<span class="token punctuation">(</span>admin_user<span class="token punctuation">.</span>is_active<span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>assertTrue<span class="token punctuation">(</span>admin_user<span class="token punctuation">.</span>is_staff<span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>assertTrue<span class="token punctuation">(</span>admin_user<span class="token punctuation">.</span>is_superuser<span class="token punctuation">)</span>\n        <span class="token keyword">try</span><span class="token punctuation">:</span>\n            <span class="token comment"># username is None for the AbstractUser option</span>\n            <span class="token comment"># username does not exist for the AbstractBaseUser option</span>\n            self<span class="token punctuation">.</span>assertIsNone<span class="token punctuation">(</span>admin_user<span class="token punctuation">.</span>username<span class="token punctuation">)</span>\n        <span class="token keyword">except</span> AttributeError<span class="token punctuation">:</span>\n            <span class="token keyword">pass</span>\n        <span class="token keyword">with</span> self<span class="token punctuation">.</span>assertRaises<span class="token punctuation">(</span>ValueError<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create_superuser<span class="token punctuation">(</span>\n                email<span class="token operator">=</span><span class="token string">&#39;super@user.com&#39;</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">&#39;foo&#39;</span><span class="token punctuation">,</span> is_superuser<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h2 id="run-makemigrations-and-migrate-management-command" tabindex="-1"><a class="header-anchor" href="#run-makemigrations-and-migrate-management-command" aria-hidden="true">#</a> Run <code>makemigrations</code> and <code>migrate</code> management command</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>./backend/manage.py makemigrations\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ ./backend/manage.py makemigrations\nMigrations for &#39;accounts&#39;:\n  backend/apps/accounts/migrations/0001_initial.py\n    - Create model CustomUser\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>When we try to run <code>migrate</code>, there will be an error:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>django.db.migrations.exceptions.InconsistentMigrationHistory: Migration admin.0001_initial is applied before its dependency accounts.0001_initial on database &#39;default&#39;.\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>At this point, we can remove the <code>db.sqlite3</code> file and rerun the migrate command.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>rm backend/db.sqlite3 &amp;&amp; ./backend/manage.py migrate\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="run-the-tests" tabindex="-1"><a class="header-anchor" href="#run-the-tests" aria-hidden="true">#</a> Run the tests</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ ./backend/manage.py test backend/apps/accounts\nCreating test database for alias &#39;default&#39;...\nSystem check identified no issues (0 silenced).\n..\n----------------------------------------------------------------------\nRan 2 tests in 0.246s\n\nOK\nDestroying test database for alias &#39;default&#39;...\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Running <code>./manage.py test</code> from the root of the project won&#39;t work, so you need to either cd to the directory or run the command specifying the app or apps you want to test. We can add this to an alias or a <code>make</code> command like this:</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># Makefile</span>\n<span class="token key atrule">.PHONY</span><span class="token punctuation">:</span> pytest\n<span class="token key atrule">pytest</span><span class="token punctuation">:</span>\n\t<span class="token comment"># Running Django test suite</span>\n\tbackend/manage.py test backend/apps\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="install-pytest" tabindex="-1"><a class="header-anchor" href="#install-pytest" aria-hidden="true">#</a> Install pytest</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>echo &quot;pytest==6.2.2&quot; &gt;&gt; backend/backend/settings/test.txt\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Since this dependency will be used only in testing, we can add it to the <code>test.txt</code> file. Next, install the requirements listed in this file (pytest) so we can use the <code>pytest</code> command at the command line.</p><p>We will also use the <code>pytest-django</code> plugin:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>echo &quot;pytest-django 4.1.0&quot; &gt;&gt; backend/backend/settings/test.txt\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Now install these dependencies with:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>pip install -r backend/requirements/test.txt\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Running pytest from our project root will make it impossible for <code>pytest</code> to find any tests. Additional configuration for pytest needs to be added so that pytest can find and run tests.</p><h2 id="add-pytest-ini-to-configure-pytest" tabindex="-1"><a class="header-anchor" href="#add-pytest-ini-to-configure-pytest" aria-hidden="true">#</a> Add <code>pytest.ini</code> to configure <code>pytest</code></h2><p>Add the following file called <code>pytest.ini</code> to the root of the top-level <code>backend</code> directory:</p><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">pytest</span><span class="token punctuation">]</span></span>\n<span class="token key attr-name">DJANGO_SETTINGS_MODULE</span> <span class="token punctuation">=</span> <span class="token value attr-value">backend.settings.development</span>\n<span class="token key attr-name">python_files</span> <span class="token punctuation">=</span> <span class="token value attr-value">tests.py test_*.py *_tests.py</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>With setting we can invoke <code>pytest</code> by running:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>pytest backend\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>in the root of our project directory. If running from the backend folder, you can simply invoke <code>pytest</code> with:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>pytest\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="add-pytest-command-to-makefile" tabindex="-1"><a class="header-anchor" href="#add-pytest-command-to-makefile" aria-hidden="true">#</a> Add pytest command to Makefile</h2><p>Let&#39;s add this as a <code>make</code> command by adding the following to our <code>Makefile</code>:</p><div class="language-Makefile ext-Makefile line-numbers-mode"><pre class="language-Makefile"><code>.PHONY: pytest\npytest:\n\t# Running pytest tests\n\tpytest backend\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="setup-code-coverage-reports" tabindex="-1"><a class="header-anchor" href="#setup-code-coverage-reports" aria-hidden="true">#</a> Setup code coverage reports</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># backend/requirements/test.txt\n\npytest-cov==2.11.1\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Reinstall this file with <code>pip install -r backend/requirements/test.txt</code> and run:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>pytest backend --cov=backend\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>This will give a coverage report:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>----------- coverage: platform linux, python 3.8.7-final-0 -----------\nName                                               Stmts   Miss  Cover\n----------------------------------------------------------------------\nbackend/__init__.py                                    0      0   100%\nbackend/apps/accounts/__init__.py                      0      0   100%\nbackend/apps/accounts/admin.py                         1      0   100%\nbackend/apps/accounts/managers.py                     20      1    95%\nbackend/apps/accounts/migrations/0001_initial.py       6      0   100%\nbackend/apps/accounts/migrations/__init__.py           0      0   100%\nbackend/apps/accounts/models.py                       12      1    92%\nbackend/apps/accounts/tests.py                        33      4    88%\nbackend/apps/core/__init__.py                          0      0   100%\nbackend/apps/core/admin.py                             1      0   100%\nbackend/apps/core/migrations/__init__.py               0      0   100%\nbackend/apps/core/models.py                            1      0   100%\nbackend/apps/core/tests.py                             1      0   100%\nbackend/backend/__init__.py                            0      0   100%\nbackend/backend/asgi.py                                4      4     0%\nbackend/backend/settings/__init__.py                   0      0   100%\nbackend/backend/settings/base.py                      20      0   100%\nbackend/backend/settings/development.py                4      0   100%\nbackend/backend/urls.py                                7      7     0%\nbackend/backend/wsgi.py                                4      4     0%\nbackend/manage.py                                     12     12     0%\n----------------------------------------------------------------------\nTOTAL                                                126     33    74%\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="write-browsable-coverage-to-a-directory-and-view-with-simple-http-server" tabindex="-1"><a class="header-anchor" href="#write-browsable-coverage-to-a-directory-and-view-with-simple-http-server" aria-hidden="true">#</a> Write browsable coverage to a directory and view with simple HTTP server</h2><p>Run pytest with the following options:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>pytest backend --cov=backend --cov-report html:backend/.coverage\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Then run a simple local file server</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>python -m http.server 8002 --directory backend/.coverage\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div>',57),T={href:"http://localhost:8002",target:"_blank",rel:"noopener noreferrer"},D=(0,e.Uk)("http://localhost:8002"),R=(0,e.Uk)(" will open the code coverage report."),C=(0,e.Wm)("p",null,[(0,e.Wm)("code",null,".coverage"),(0,e.Uk)(" is already included in the "),(0,e.Wm)("code",null,".gitignore"),(0,e.Uk)(" file that was included originally, so generating the coverage report at this location will not add anything to git.")],-1),U=(0,e.Uk)("More options for pytest-cov can be found here: "),P={href:"https://pytest-cov.readthedocs.io/en/latest/reporting.html",target:"_blank",rel:"noopener noreferrer"},I=(0,e.Uk)("https://pytest-cov.readthedocs.io/en/latest/reporting.html"),L=(0,e.uE)('<h2 id="add-coveragerc-to-exclude-files-from-coverage-report" tabindex="-1"><a class="header-anchor" href="#add-coveragerc-to-exclude-files-from-coverage-report" aria-hidden="true">#</a> Add <code>.coveragerc</code> to exclude files from coverage report</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># .coveragerc\n[run]\nomit = manage.py\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="configure-vscode-settings" tabindex="-1"><a class="header-anchor" href="#configure-vscode-settings" aria-hidden="true">#</a> Configure VSCode settings</h2><p>In order to do linting with <code>flake8</code> and formatting with <code>black</code>, VSCode needs some special settings:</p><p>Here&#39;s my VSCode configuration:</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>\n  <span class="token property">&quot;python.pythonPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;.local-env/bin/python&quot;</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;python.linting.flake8Enabled&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;python.linting.pylintEnabled&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;python.linting.enabled&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;editor.formatOnSave&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;python.formatting.provider&quot;</span><span class="token operator">:</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;python.formatting.blackPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;.local-env/bin/black&quot;</span><span class="token punctuation">,</span>\n  <span class="token comment">// flake8 has a default line-length of 79, so we use that for black as well</span>\n  <span class="token property">&quot;python.formatting.blackArgs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;--line-length&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;79&quot;</span><span class="token punctuation">]</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>These settings will automatically format Python code and do code linting to indicate errors that need fixing. <code>black</code> has a default line-length of 88 columns. Thi is the one setting to change in the <code>black</code> command line arguments in the VSCode project settings.</p><h2 id="python-code-linting-with-flake8" tabindex="-1"><a class="header-anchor" href="#python-code-linting-with-flake8" aria-hidden="true">#</a> Python code linting with flake8</h2><p>We will use flake8 in our python code tests together with <code>pytest</code>. Add the flake8 dependency to the <code>test.txt</code> requirements file:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>flake8==3.8.4\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>flake8 backend\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>This shows lots of errors:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ flake8 backend\nbackend/manage.py:9:80: E501 line too long (83 &gt; 79 characters)\nbackend/apps/accounts/views.py:1:1: F401 &#39;django.shortcuts.render&#39; imported but unused\nbackend/apps/accounts/admin.py:1:1: F401 &#39;django.contrib.admin&#39; imported but unused\nbackend/apps/accounts/tests.py:9:80: E501 line too long (80 &gt; 79 characters)\n\n...\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Instead of manually going over each of these files and making the required formatting changes, we can install <code>black</code> as a way to automatically format all of the python code at once. <code>black</code> should be able to format most of the <code>E501 line too long</code> errors.</p><h2 id="format-python-code-with-black" tabindex="-1"><a class="header-anchor" href="#format-python-code-with-black" aria-hidden="true">#</a> Format python code with black</h2><p>First, install black by adding it to test dependencies (<code>test.txt</code>):</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>black==20.8b1\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Then run:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>black backend\nreformatted /home/brian/gitlab/django-step-by-step/backend/apps/accounts/apps.py\nreformatted /home/brian/gitlab/django-step-by-step/backend/apps/core/apps.py\nreformatted /home/brian/gitlab/django-step-by-step/backend/backend/settings/development.py\nreformatted /home/brian/gitlab/django-step-by-step/backend/backend/asgi.py\nreformatted /home/brian/gitlab/django-step-by-step/backend/backend/wsgi.py\nreformatted /home/brian/gitlab/django-step-by-step/backend/apps/accounts/models.py\nreformatted /home/brian/gitlab/django-step-by-step/backend/backend/urls.py\nreformatted /home/brian/gitlab/django-step-by-step/backend/manage.py\nreformatted /home/brian/gitlab/django-step-by-step/backend/apps/accounts/managers.py\nreformatted /home/brian/gitlab/django-step-by-step/backend/apps/accounts/tests.py\nreformatted /home/brian/gitlab/django-step-by-step/backend/backend/settings/base.py\nreformatted /home/brian/gitlab/django-step-by-step/backend/apps/accounts/migrations/0001_initial.py\nAll done! âœ¨ ðŸ° âœ¨\n12 files reformatted, 13 files left unchanged.\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>Now run <code>flake8 backend</code> to see how many errors there are:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="add-runserver-plus-and-werkzeug" tabindex="-1"><a class="header-anchor" href="#add-runserver-plus-and-werkzeug" aria-hidden="true">#</a> Add runserver_plus and Werkzeug</h2><p>Install dependencies for <code>runserver_plus</code> and <code>Werkzeug</code>:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>django-extensions==3.1.0\nWerkzeug==1.0.1 # used for runserver_plus exception console\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Add the <code>django-extensions</code> app to <code>INSTALLED_APPS</code>:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>    <span class="token string">&#39;django_extensions&#39;</span><span class="token punctuation">,</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><code>runserver_plus</code></p><h2 id="add-a-base-model-for-tracking-created-modified-timestamps" tabindex="-1"><a class="header-anchor" href="#add-a-base-model-for-tracking-created-modified-timestamps" aria-hidden="true">#</a> Add a base model for tracking created/modified timestamps</h2><p>Adding a base model can be useful for adding fields to models that will be included on most of the other models in our project.</p><p>Here&#39;s an example of a base model we can use in our project. This model will be added to our <code>core</code> Django app and is a typical example of why it helps to have a <code>core</code> or <code>common</code> app that can help to organize things that aren&#39;t specific to one app.</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>conf <span class="token keyword">import</span> settings\n<span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models\n\n\n<span class="token keyword">class</span> <span class="token class-name">BaseModel</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    created_on <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> editable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>\n    modified_on <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>auto_now<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> editable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>\n    created_by <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>\n        settings<span class="token punctuation">.</span>AUTH_USER_MODEL<span class="token punctuation">,</span>\n        null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>\n        default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>\n        blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>\n        editable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n        on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>SET_NULL<span class="token punctuation">,</span>\n        related_name<span class="token operator">=</span><span class="token string">&#39;%(app_label)s_%(class)s_created_by&#39;</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span>\n    modified_by <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>\n        settings<span class="token punctuation">.</span>AUTH_USER_MODEL<span class="token punctuation">,</span>\n        null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>\n        default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>\n        blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>\n        editable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n        on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>SET_NULL<span class="token punctuation">,</span>\n        related_name<span class="token operator">=</span><span class="token string">&#39;%(app_label)s_%(class)s_modified_by&#39;</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span>\n\n    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>\n        abstract <span class="token operator">=</span> <span class="token boolean">True</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>There&#39;s no need to run migrations since the model is <code>abstract</code>. This model can now be subclassed when making new models. This will be used shortly.</p><h2 id="add-settings-for-enabling-use-of-jupyter-notebooks" tabindex="-1"><a class="header-anchor" href="#add-settings-for-enabling-use-of-jupyter-notebooks" aria-hidden="true">#</a> Add settings for enabling use of Jupyter notebooks</h2><p>Add the following dependencies that will allow us to use Jupyter notebooks to work with our Django application in its own environment.</p><p><code>dev.txt</code></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># for Jupyter notebooks\nipython==7.20.0\njupyter==1.0.0\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Add the following make command:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>PHONY: notebook\nnotebook:\n\tbackend/manage.py shell_plus --notebook\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Running <code>make notebook</code> (or <code>backend/manage.py shell_plus --notebook</code>) will open up a Jupyter notebook in the browser. Click on <code>New</code> &gt; <code>Django Shell-Plus</code> and you can run <code>!pip freeze</code> to view the dependencies installed to confirm that the environment is correct.</p><p>In order to make ORM queries, the following must be ran in the notebook:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token operator">%</span>env DJANGO_ALLOW_ASYNC_UNSAFE<span class="token operator">=</span>true\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>This will set the environment variable <code>DJANGO_ALLOW_ASYNC_UNSAFE</code> which we will allow for the execution database queries through the ORM, for example:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token operator">%</span>env DJANGO_ALLOW_ASYNC_UNSAFE<span class="token operator">=</span>true\n<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth <span class="token keyword">import</span> get_user_model\nUser <span class="token operator">=</span> get_user_model<span class="token punctuation">(</span><span class="token punctuation">)</span>\nusers <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\nusers<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>The <code>DJANGO_ALLOW_ASYNC_UNSAFE</code> environment variable can also be set in your shell before launching Jupyter notebook.</p><h2 id="setup-postgres-locally" tabindex="-1"><a class="header-anchor" href="#setup-postgres-locally" aria-hidden="true">#</a> Setup Postgres locally</h2><p>Run the following command to ensure that Postgres is install and running:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sudo service postgresql status\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>â— postgresql.service - PostgreSQL RDBMS\n   Loaded: loaded (/lib/systemd/system/postgresql.service; disabled; vendor preset: enabled)\n   Active: active (exited) since Mon 2021-02-01 19:41:34 EST; 2min 49s ago\n  Process: 5543 ExecStart=/bin/true (code=exited, status=0/SUCCESS)\n Main PID: 5543 (code=exited, status=0/SUCCESS)\n\nFeb 01 19:41:34 x1 systemd[1]: Starting PostgreSQL RDBMS...\nFeb 01 19:41:34 x1 systemd[1]: Started PostgreSQL RDBMS.\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Ubuntu 20.04 shows the following:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sudo service postgresql start\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sudo service postgresql status\n12/main (port 5432): online\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="configure-our-django-application-to-use-our-local-postgres-service" tabindex="-1"><a class="header-anchor" href="#configure-our-django-application-to-use-our-local-postgres-service" aria-hidden="true">#</a> Configure our Django application to use our local postgres service</h2><p>The Postgres service is available at <code>localhost:5432</code>.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sudo -u postgres psql postgres\nALTER USER postgres WITH PASSWORD &#39;postgres&#39;;\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Add <code>psycopg2</code> to our project dependencies (in <code>base.txt</code>):</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>psycopg2-binary==2.8.6\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Add the following settings to <code>base.py</code>:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># Database</span>\n<span class="token comment"># https://docs.djangoproject.com/en/3.1/ref/settings/#databases</span>\n\nDATABASES <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">&quot;default&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        <span class="token string">&quot;ENGINE&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;django.db.backends.postgresql_psycopg2&quot;</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;NAME&quot;</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;POSTGRES_NAME&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;postgres&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;USER&quot;</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;POSTGRES_USERNAME&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;postgres&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;PASSWORD&quot;</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;POSTGRES_PASSWORD&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;postgres&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;HOST&quot;</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;POSTGRES_SERVICE_HOST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;PORT&quot;</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;POSTGRES_SERVICE_PORT&quot;</span><span class="token punctuation">,</span> <span class="token number">5432</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Now run the <code>migrate</code> management command and then <code>runserver</code> (or just run <code>make</code> to run the migrate command and start the development server).</p><h2 id="another-approach-to-running-postgres-on-our-machine-and-an-introduction-to-docker-run-postgres-in-a-docker-container" tabindex="-1"><a class="header-anchor" href="#another-approach-to-running-postgres-on-our-machine-and-an-introduction-to-docker-run-postgres-in-a-docker-container" aria-hidden="true">#</a> Another approach to running postgres on our machine and an introduction to docker: run postgres in a docker container</h2>',60),O=(0,e.Uk)("Reference: "),W={href:"https://hub.docker.com/_/postgres",target:"_blank",rel:"noopener noreferrer"},N=(0,e.Uk)("https://hub.docker.com/_/postgres"),M=(0,e.uE)('<div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker run -d \\\n    --name some-postgres \\\n    -p 5434:5432\n    -e POSTGRES_PASSWORD=mysecretpassword \\\n    -v /tmp/pgdata:/var/lib/postgresql/data \\\n    postgres\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>You can access the psql shell with the following command:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker exec -it some-postgres sh\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># psql -U postgres\npsql (12.1 (Debian 12.1-1.pgdg100+1))\nType &quot;help&quot; for help.\n\npostgres=#\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="improve-the-readability-of-the-command-by-using-docker-compose" tabindex="-1"><a class="header-anchor" href="#improve-the-readability-of-the-command-by-using-docker-compose" aria-hidden="true">#</a> Improve the readability of the command by using docker-compose</h2><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;2.4&quot;</span>\n\n<span class="token key atrule">services</span><span class="token punctuation">:</span>\n  <span class="token key atrule">postgres</span><span class="token punctuation">:</span>\n    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> postgres\n    <span class="token key atrule">image</span><span class="token punctuation">:</span> postgres\n    <span class="token key atrule">networks</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> main\n    <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">&quot;5434:5432&quot;</span>\n    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> pg<span class="token punctuation">-</span>data<span class="token punctuation">:</span>/var/lib/postgresql/data\n    <span class="token key atrule">environment</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> POSTGRES_PASSWORD=postgres\n\n<span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n  <span class="token key atrule">pg-data</span><span class="token punctuation">:</span>\n\n<span class="token key atrule">networks</span><span class="token punctuation">:</span>\n  <span class="token key atrule">main</span><span class="token punctuation">:</span>\n    <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>We can use docker and docker-compose for &quot;dockerizing&quot; our application as much or as little as we want. Eventually I&#39;ll show how to fully dockerize all components of our application. This will simplify the process of starting the entire project locally and will also ensure that developers don&#39;t have any issues with running the application properly.</p><h2 id="setup-pgadmin4-locally" tabindex="-1"><a class="header-anchor" href="#setup-pgadmin4-locally" aria-hidden="true">#</a> Setup pgadmin4 locally</h2><p>Add <code>pgadmin4</code> to <code>dev.txt</code> and install the local dependencies (<strong><code>make pip-local</code></strong>).</p><p>If you see errors about log file permissions, run the following:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sudo mkdir /var/log/pgadmin\nsudo chown -R $USER:$USER /var/log/pgadmin\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Run <code>pgadmin4</code> in a terminal with the virtual environment activated, then enter an email and password that you will use to login for the first time. Login to the program when it opens in the browser, enter your email and password and create a new server. User <code>postgres</code> for the name, user and password.</p><p>You can find the email that used to sign up here:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>/var/lib/pgadmin/storage/\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="setup-pgadmin4-in-docker-compose" tabindex="-1"><a class="header-anchor" href="#setup-pgadmin4-in-docker-compose" aria-hidden="true">#</a> Setup pgadmin4 in docker-compose</h2><h2 id="add-a-dockerfile-for-our-django-application" tabindex="-1"><a class="header-anchor" href="#add-a-dockerfile-for-our-django-application" aria-hidden="true">#</a> Add a Dockerfile for our Django application</h2><p>Now that the main dependency for our project (postgres) is running in docker, it is important to decide if the Django application itself should run as a containerized process in our local development environment. For most Django projects, either way is probably fine. If we don&#39;t use docker for running the Django application, then there is no problem with running it directly on the virtual environment as it has been running in up until now.</p><p>The main reasons why I choose to run project locally in docker are:</p><ul><li>it is easy to start everything at once with one command</li><li>it is a standard format and makes it easy for people to start a complex project quickly without setting anything up</li><li>it makes me more confident that something working correctly on my local docker environment will work on a remote server&#39;s docker environment as well.</li><li>it will make deployment easier and more predictable</li></ul><p>We need to do 2 things in order to start running our Django app in a container: write a Dockerfile and also provide some options for how to run the container.</p><p>First, we can start with this Dockerfile:</p><p><code>backend/Dockerfile.dev</code>:</p><div class="language-Dockerfile ext-Dockerfile line-numbers-mode"><pre class="language-Dockerfile"><code>FROM python:3.8-slim\nENV PYTHONUNBUFFERED 1\nENV PYTHONDONTWRITEBYTECODE 1\nRUN mkdir /code\nWORKDIR /code\nADD requirements/base.txt \\\n    requirements/dev.txt \\\n    requirements/test.txt \\\n    /code/requirements/\nRUN pip3 install -r requirements/base.txt\nRUN pip3 install -r requirements/dev.txt\nRUN pip3 install -r requirements/test.txt\nADD . /code/\nRUN useradd -m app\nUSER app\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>Next, we need to think about how the container will run. Because there is no <code>EXEC</code> keyword in Dockerfile.dev, this Dockerfile doesn&#39;t tell the container what to do. Similar to how it was shown that postgres can be launched from the command line with command line arguments or from the <code>docker-compose</code> command that references a <code>docker-compose.yml</code> file, our containerized Django app can also be launched in these two ways.</p><p>Before we run the container, we need to build it. We can start with the <code>docker build</code> command:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker build -t my-backend -f backend/Dockerfile.dev backend\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>You should see:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Successfully built 6aaa6b60ad17\nSuccessfully tagged my-backend:latest\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>To run the container, use the following command:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker run -p 8000:8000 my-backend\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>What about postgres? If we run:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker run -p 8000:8000 my-backend python3 manage.py runserver\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>We will see the following error:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>        Is the server running on host &quot;localhost&quot; (::1) and accepting\n        TCP/IP connections on port 5432?\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>This is because the <code>localhost</code> on our browser is not the same as the <code>localhost</code> on our container.</p><p>To fix this, we need to run the docker container</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker run --network=host -p 8000:8000 my-backend python3 manage.py runserver_plus\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="setup-redis-locally" tabindex="-1"><a class="header-anchor" href="#setup-redis-locally" aria-hidden="true">#</a> Setup redis locally</h2>',38),F={href:"https://redis.io/topics/quickstart",target:"_blank",rel:"noopener noreferrer"},G=(0,e.Uk)("https://redis.io/topics/quickstart"),V={href:"https://www.digitalocean.com/community/tutorials/how-to-install-and-secure-redis-on-ubuntu-18-04",target:"_blank",rel:"noopener noreferrer"},B=(0,e.Uk)("https://www.digitalocean.com/community/tutorials/how-to-install-and-secure-redis-on-ubuntu-18-04"),K=(0,e.uE)('<p>Install redis:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sudo apt install redis-server\nsudo apt install redis-tools\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Edit the configuration file so that redis uses <code>systemd</code>:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sudo nano /etc/redis/redis.conf\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Change the following line in <code>redis.conf</code>:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>supervised systemd\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Check on the status of the <code>redis-server</code> service:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sudo service redis-server status\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>We can verify that redis works, but first install the py-redis client:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># base.txt\n\nredis==3.5.3\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Run <strong><code>make pip-local</code></strong> to install the dependency to your local environment.</p><p>Redis stands for <code>remote dictionary service</code>. Using a Jupyter notebook or IPython, you can test the redis connection with:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> os\n<span class="token keyword">import</span> redis\n\nREDIS_SERVICE_HOST <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;REDIS_SERVICE_HOST&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;localhost&#39;</span><span class="token punctuation">)</span>\n\nREDIS <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span>\n    host<span class="token operator">=</span>REDIS_SERVICE_HOST<span class="token punctuation">,</span>\n    port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span>\n    db<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>\n    charset<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">,</span>\n    decode_responses<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>\n<span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Redis will allow us to do several different things with our Django application:</p><ul><li><strong>caching</strong>: this refers to storing responses in redis so that database queries can be avoided. This is useful for expensive queries that will likely not change frequently and it will also result in a faster request/response cycle.</li><li><strong>async processing</strong>: redis will help us do long-running tasks on &quot;another computer&quot;, such as processing large files, sending emails, etc. Redis will keep track of the tasks that need to be processed. You can think about redis as a way to store python lists, dictionaries, sets, strings and numbers on a remote database. Redis offers some additional data types, as well. I&#39;ll use redis with <code>celery</code> later on.</li><li><strong>web sockets</strong>: redis will allow us to work with web sockets. This allows for real-time communication between the server and connected clients using web sockets.</li><li>more: there are likely other use cases that use redis. The examples listed here can usually use a number of different services such as <code>memcached</code> or <code>RabbitMQ</code>. A redis server can use dedicated numbered databases so that there is no possibility of key collision.</li></ul><p>Check the redis connection using the CLI command:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># we can ping the local redis server with the following:\n# redis-cli -h localhost -p 6379 ping\n# the `-h` and `-p` arguments are the default host and port for redis-cli, so this is equivalent to:\n\nredis-cli ping\nPONG\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="add-redis-to-docker-compose-file-for-celery-broker" tabindex="-1"><a class="header-anchor" href="#add-redis-to-docker-compose-file-for-celery-broker" aria-hidden="true">#</a> Add redis to docker-compose file for celery broker</h2><h2 id="setup-redis-commander-locally" tabindex="-1"><a class="header-anchor" href="#setup-redis-commander-locally" aria-hidden="true">#</a> Setup redis-commander locally</h2><p>Similar to how we installed <code>pgadmin4</code> to give us a GUI for our Postgres database, we can also install a GUI for our redis database that will provide a similar functionality and will also give us visibility into how our Django application interacts with redis.</p><p>First, install redis-commander with <code>npm</code>. Check you node and npm versions with:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>node -v\nv15.0.1\nnpm -v\n7.0.3\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Install the program in our global npm modules:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>npm install -g redis-commander\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>We can now see this installed in our global dependencies with:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>npm list -g --depth=0\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Here are my globally installed npm packages:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>npm list -g --depth=0\n/home/brian/.nvm/versions/node/v15.0.1/lib\nâ”œâ”€â”€ @quasar/cli@1.1.2\nâ”œâ”€â”€ aws-cdk@1.70.0\nâ”œâ”€â”€ generator-code@1.3.9\nâ”œâ”€â”€ npm@7.0.3\nâ”œâ”€â”€ redis-commander@0.7.0 &lt;-- this is what we just installed\nâ””â”€â”€ yo@3.1.1\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Now start the redis-commander program with <code>redis-commander</code> and visit <code>http://127.0.0.1:8081</code>:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>redis-commander\nUsing scan instead of keys\nNo Save: false\nlistening on 0.0.0.0:8081\naccess with browser at http://127.0.0.1:8081\nRedis Connection localhost:6379 using Redis DB #0\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>You may need to add a new server in order to inspect a different redis database. Click on <code>More</code> &gt; <code>Add Server</code>, add a <code>Display-Name</code> and a <code>Database Index</code>.</p><h2 id="add-a-requestlog-model" tabindex="-1"><a class="header-anchor" href="#add-a-requestlog-model" aria-hidden="true">#</a> Add a RequestLog model</h2><p>Next let&#39;s add a model that will keep track of each request that is made to our application. On this model we will have the following fields:</p><ul><li><code>user</code> (Foreign key to user model, store on <code>created_by</code> field from base model)</li><li><code>date</code> (use <code>created_on</code> field from base model)</li><li><code>path</code> (<code>/api/resource/1/</code>)</li><li><code>full_path</code> (<code>/api/resource/1/?query=something</code>)</li><li><code>execution_time</code> (in milliseconds)</li><li><code>response_code</code> (<code>200</code>, <code>301</code>, <code>404</code>, <code>500</code>, etc.)</li><li><code>method</code> (<code>GET</code>, <code>POST</code>, etc.)</li><li><code>remote_address</code> (IP address of connecting client)</li></ul><p>Here&#39;s the model we can use:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># apps/core/models.py</span>\n<span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models\n<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth <span class="token keyword">import</span> get_user_model\n\n\nUser <span class="token operator">=</span> get_user_model<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">RequestLog</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token triple-quoted-string string">&quot;&quot;&quot;\n    Request Log\n    &quot;&quot;&quot;</span>\n\n    user <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>\n        User<span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>SET_NULL<span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span>\n    <span class="token punctuation">)</span>\n    date <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n    path <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">3000</span><span class="token punctuation">)</span>\n    full_path <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">3000</span><span class="token punctuation">)</span>\n    execution_time <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n    response_code <span class="token operator">=</span> models<span class="token punctuation">.</span>PositiveIntegerField<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    method <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n    remote_address <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>Add this code and then run the <code>makemigrations</code> management command to add the migration file.</p><h2 id="add-a-middleware-to-handle-requestlog-creation" tabindex="-1"><a class="header-anchor" href="#add-a-middleware-to-handle-requestlog-creation" aria-hidden="true">#</a> Add a middleware to handle RequestLog creation</h2><p>Next we need to add a middleware that will create and save a <code>RequestLog</code> object on each request. We can use the following middleware:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># apps/core/middleware.py</span>\n<span class="token keyword">import</span> logging\n<span class="token keyword">import</span> time\n\n<span class="token keyword">from</span> core<span class="token punctuation">.</span>models <span class="token keyword">import</span> RequestLog\n\nlogger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">RequestLogMiddleware</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> get_response<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>get_response <span class="token operator">=</span> get_response\n\n    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        response <span class="token operator">=</span> self<span class="token punctuation">.</span>get_response<span class="token punctuation">(</span>request<span class="token punctuation">)</span>\n        duration <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start_time\n        response_ms <span class="token operator">=</span> duration <span class="token operator">*</span> <span class="token number">1000</span>\n\n        user <span class="token operator">=</span> <span class="token boolean">None</span>\n        <span class="token keyword">if</span> request<span class="token punctuation">.</span>user<span class="token punctuation">.</span>is_authenticated<span class="token punctuation">:</span>\n            user <span class="token operator">=</span> request<span class="token punctuation">.</span>user\n        path <span class="token operator">=</span> request<span class="token punctuation">.</span>path\n        full_path <span class="token operator">=</span> request<span class="token punctuation">.</span>get_full_path<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        method <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">getattr</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&quot;method&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        remote_address <span class="token operator">=</span> self<span class="token punctuation">.</span>get_client_ip<span class="token punctuation">(</span>request<span class="token punctuation">)</span>\n        response_code <span class="token operator">=</span> response<span class="token punctuation">.</span>status_code\n\n        request_log <span class="token operator">=</span> RequestLog<span class="token punctuation">(</span>\n            user<span class="token operator">=</span>user<span class="token punctuation">,</span>\n            path<span class="token operator">=</span>path<span class="token punctuation">,</span>\n            full_path<span class="token operator">=</span>full_path<span class="token punctuation">,</span>\n            execution_time<span class="token operator">=</span>response_ms<span class="token punctuation">,</span>\n            response_code<span class="token operator">=</span>response_code<span class="token punctuation">,</span>\n            method<span class="token operator">=</span>method<span class="token punctuation">,</span>\n            remote_address<span class="token operator">=</span>remote_address<span class="token punctuation">,</span>\n        <span class="token punctuation">)</span>\n\n        request_log<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n        <span class="token keyword">return</span> response\n\n    <span class="token keyword">def</span> <span class="token function">get_client_ip</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        x_forwarded_for <span class="token operator">=</span> request<span class="token punctuation">.</span>META<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;HTTP_X_FORWARDED_FOR&quot;</span><span class="token punctuation">)</span>\n        <span class="token keyword">if</span> x_forwarded_for<span class="token punctuation">:</span>\n            ip <span class="token operator">=</span> x_forwarded_for<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>\n        <span class="token keyword">else</span><span class="token punctuation">:</span>\n            ip <span class="token operator">=</span> request<span class="token punctuation">.</span>META<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;REMOTE_ADDR&quot;</span><span class="token punctuation">)</span>\n        <span class="token keyword">return</span> ip\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><p>Add this middleware to Django&#39;s <code>MIDDLEWARE</code> settings value at the end of the list:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>MIDDLEWARE <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n    <span class="token string">&quot;apps.core.middleware.RequestLogMiddleware&quot;</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="add-an-admin-view-for-the-requestlog" tabindex="-1"><a class="header-anchor" href="#add-an-admin-view-for-the-requestlog" aria-hidden="true">#</a> Add an admin view for the RequestLog</h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin\n\n<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> RequestLog\n\n\n<span class="token keyword">class</span> <span class="token class-name">RequestLogAdmin</span><span class="token punctuation">(</span>admin<span class="token punctuation">.</span>ModelAdmin<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>\n        model <span class="token operator">=</span> RequestLog\n\n    <span class="token keyword">def</span> <span class="token function">get_queryset</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        qs <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span>RequestLogAdmin<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>get_queryset<span class="token punctuation">(</span>request<span class="token punctuation">)</span>\n        qs <span class="token operator">=</span> qs<span class="token punctuation">.</span>exclude<span class="token punctuation">(</span>full_path__startswith<span class="token operator">=</span><span class="token string">&quot;/admin/&quot;</span><span class="token punctuation">)</span>\n        <span class="token keyword">return</span> qs\n\n    search_fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&quot;full_path&quot;</span><span class="token punctuation">,</span><span class="token punctuation">)</span>\n\n    list_select_related <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span><span class="token punctuation">)</span>\n\n    list_filter <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&quot;method&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;response_code&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>\n\n    readonly_fields <span class="token operator">=</span> <span class="token punctuation">(</span>\n        <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;date&quot;</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;path&quot;</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;full_path&quot;</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;execution_time&quot;</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;response_code&quot;</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;method&quot;</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;remote_address&quot;</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span>\n    list_display <span class="token operator">=</span> <span class="token punctuation">(</span>\n        <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;date&quot;</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;path&quot;</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;full_path&quot;</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;execution_time&quot;</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;response_code&quot;</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;method&quot;</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;remote_address&quot;</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span>\n\n\nadmin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>RequestLog<span class="token punctuation">,</span> RequestLogAdmin<span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h2 id="setup-celery-app" tabindex="-1"><a class="header-anchor" href="#setup-celery-app" aria-hidden="true">#</a> Setup Celery app</h2><p>To setup celery, we need to do a few things:</p><ol><li>Add <code>celery</code> to our installed packages</li><li>Add a <code>celery_app.py</code> file to configure celery</li><li>Import celery in <code>backend/backend/__init__.py</code></li><li>Add settings to Django settings for celery</li><li>Define a celery task in our project code</li><li>Start a celery worker</li><li>Run the test task to confirm that it is working</li></ol>',47),Y=(0,e.Uk)("You can read more about celery here: "),z={href:"https://docs.celeryproject.org/en/stable/getting-started/introduction.html",target:"_blank",rel:"noopener noreferrer"},H=(0,e.Uk)("https://docs.celeryproject.org/en/stable/getting-started/introduction.html"),J=(0,e.Uk)("Also, the celery documentation has some helpful Django-specific settings that will be used here: "),Q={href:"https://docs.celeryproject.org/en/stable/getting-started/introduction.html",target:"_blank",rel:"noopener noreferrer"},$=(0,e.Uk)("https://docs.celeryproject.org/en/stable/getting-started/introduction.html"),X=(0,e.uE)('<p>First, add celery to <code>requirements/base.txt</code>:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>celery==5.0.5\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Now reinstall pip requirements.</p><h2 id="add-celery-app-py-to-backend-backend" tabindex="-1"><a class="header-anchor" href="#add-celery-app-py-to-backend-backend" aria-hidden="true">#</a> Add <code>celery_app.py</code> to <code>backend/backend</code></h2><p>Here&#39;s the contents for the <code>celery_app.py</code> file:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> celery <span class="token keyword">import</span> Celery\n<span class="token keyword">from</span> django<span class="token punctuation">.</span>conf <span class="token keyword">import</span> settings\n\napp <span class="token operator">=</span> Celery<span class="token punctuation">(</span><span class="token string">&quot;backend&quot;</span><span class="token punctuation">)</span>\n\napp<span class="token punctuation">.</span>config_from_object<span class="token punctuation">(</span><span class="token string">&quot;django.conf:settings&quot;</span><span class="token punctuation">,</span> namespace<span class="token operator">=</span><span class="token string">&quot;CELERY&quot;</span><span class="token punctuation">)</span>\n\napp<span class="token punctuation">.</span>autodiscover_tasks<span class="token punctuation">(</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> settings<span class="token punctuation">.</span>INSTALLED_APPS<span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="install-celery-in-backend-backend-init-py" tabindex="-1"><a class="header-anchor" href="#install-celery-in-backend-backend-init-py" aria-hidden="true">#</a> Install celery in <code>backend/backend/__init__.py</code></h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># This will make sure the app is always imported when</span>\n<span class="token comment"># Django starts so that shared_task will use this app.</span>\n<span class="token keyword">from</span> <span class="token punctuation">.</span>celery <span class="token keyword">import</span> app <span class="token keyword">as</span> celery_app\n\n__all__ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&#39;celery_app&#39;</span><span class="token punctuation">,</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="add-celery-settings-to-django-settings" tabindex="-1"><a class="header-anchor" href="#add-celery-settings-to-django-settings" aria-hidden="true">#</a> Add celery settings to Django settings</h2><p>Next the celery application can be configured in Django settings.</p><p>We need to tell celery about the redis server since this will be used as the broker.</p><p>You can think about the role that redis plays in the context of celery as a bulletin board.</p><p>In our Django application, we will post messages on the bulletin board. The contents of the bulletin board messages are all pretty simple. At a basic level, the messages will specify the name of a function defined in our Django project along with any arguments that should be passed to the function. Celery workers will constantly be checking the bulletin board for work and will take messages off of the board and start doing the work specified by the messages. That&#39;s celery in a nutshell. It can get a lot more complicated, but the bulletin board / worker analogy can be stretched to explain some of the more complex parts of celery&#39;s advanced features.</p><p>Here are the settings to add:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># use `localhost` as the Redis server hostname unless `REDIS_SERVICE_HOST` is provided</span>\nREDIS_SERVICE_HOST <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;REDIS_SERVICE_HOST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span>\nREDIS_PORT <span class="token operator">=</span> <span class="token number">6379</span>\nBROKER_PORT <span class="token operator">=</span> <span class="token number">1</span>\nRESULTS_PORT <span class="token operator">=</span> <span class="token number">2</span>\n\nCELERY_BROKER_URL <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;redis://</span><span class="token interpolation"><span class="token punctuation">{</span>REDIS_SERVICE_HOST<span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span>REDIS_PORT<span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span>BROKER_PORT<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>\nCELERY_RESULT_BACKEND <span class="token operator">=</span> <span class="token punctuation">(</span>\n    <span class="token string-interpolation"><span class="token string">f&quot;redis://</span><span class="token interpolation"><span class="token punctuation">{</span>REDIS_SERVICE_HOST<span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span>REDIS_PORT<span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span>RESULTS_PORT<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>\n<span class="token punctuation">)</span>\nCELERY_ACCEPT_CONTENT <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;application/json&quot;</span><span class="token punctuation">]</span>\nCELERY_TASK_SERIALIZER <span class="token operator">=</span> <span class="token string">&quot;json&quot;</span>\nCELERY_RESULT_SERIALIZER <span class="token operator">=</span> <span class="token string">&quot;json&quot;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="add-a-debug-celery-task" tabindex="-1"><a class="header-anchor" href="#add-a-debug-celery-task" aria-hidden="true">#</a> Add a debug celery task</h2><p>The simplest celery task we can write simply sleeps for 1 second and then returns a success message.</p><p>We can write a simple task that sleeps for 1 second in the <code>core</code> app.</p><p>Create a new file <code>apps/core/tasks.py</code> with the following celery task:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> time\n\n<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>task</span><span class="token punctuation">(</span>queue<span class="token operator">=</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">)</span>\n<span class="token keyword">def</span> <span class="token function">process_filing_list</span><span class="token punctuation">(</span>filing_list_id<span class="token punctuation">)</span><span class="token punctuation">:</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="run-the-celery-command-to-start-a-worker" tabindex="-1"><a class="header-anchor" href="#run-the-celery-command-to-start-a-worker" aria-hidden="true">#</a> Run the celery command to start a worker</h2><p>In a new terminal window, activate the virtual environment and run the following from the root directory of the project:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd backend\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Then run</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>DJANGO_SETTINGS_MODULE=backend.settings.development celery -A backend.celery_app:app worker -l INFO\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code> -------------- celery@DESKTOP-VF05L4R v5.0.5 (singularity)\n--- ***** -----\n-- ******* ---- Linux-4.19.128-microsoft-standard-x86_64-with-glibc2.29 2021-03-06 21:59:44\n- *** --- * ---\n- ** ---------- [config]\n- ** ---------- .&gt; app:         backend:0x7f9e8d48f880\n- ** ---------- .&gt; transport:   redis://localhost:6379/1\n- ** ---------- .&gt; results:     redis://localhost:6379/2\n- *** --- * --- .&gt; concurrency: 8 (prefork)\n-- ******* ---- .&gt; task events: OFF (enable -E to monitor tasks in this worker)\n--- ***** -----\n -------------- [queues]\n                .&gt; celery           exchange=celery(direct) key=celery\n\n\n[tasks]\n  . apps.core.tasks.debug_task\n\n[2021-03-06 21:59:44,833: INFO/MainProcess] Connected to redis://localhost:6379/1\n[2021-03-06 21:59:44,842: INFO/MainProcess] mingle: searching for neighbors\n[2021-03-06 21:59:45,878: INFO/MainProcess] mingle: all alone\n[2021-03-06 21:59:45,884: WARNING/MainProcess] /home/brian/gitlab/django-step-by-step/.local-env/lib/python3.8/site-packages/celery/fixups/django.py:203: UserWarning: Using settings.DEBUG leads to a memory\n            leak, never use this setting in production environments!\n  warnings.warn(&#39;&#39;&#39;Using settings.DEBUG leads to a memory\n\n[2021-03-06 21:59:45,884: INFO/MainProcess] celery@DESKTOP-VF05L4R ready.\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="run-the-debug-task" tabindex="-1"><a class="header-anchor" href="#run-the-debug-task" aria-hidden="true">#</a> Run the debug task</h2><p>Now that we have a celery worker running, we are ready to post messages to our bulletin board. Let&#39;s open a Jupyter notebook and see how message are sent to redis (the bulletin). First, open a Jupyter notebook <code>Django Shell-Plus</code> session with:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>make notebook\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>In a new notebook, run the following command:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> time\n<span class="token keyword">from</span> apps<span class="token punctuation">.</span>core<span class="token punctuation">.</span>tasks <span class="token keyword">import</span> debug_task\n\n<span class="token comment"># calling `.delay` is what &quot;posts&quot; the message to redis (the bulletin board)</span>\ntask <span class="token operator">=</span> debug_task<span class="token punctuation">.</span>delay<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Task ID is: </span><span class="token interpolation"><span class="token punctuation">{</span>task<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Task status is: </span><span class="token interpolation"><span class="token punctuation">{</span>task<span class="token punctuation">.</span>status<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Task successful? </span><span class="token interpolation"><span class="token punctuation">{</span>task<span class="token punctuation">.</span>successful<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Type: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">type</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>\n\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;waiting 2 seconds (the task should have been completed by now)&quot;</span><span class="token punctuation">)</span>\ntime<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>\n\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Task status: </span><span class="token interpolation"><span class="token punctuation">{</span>task<span class="token punctuation">.</span>status<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Task successful? </span><span class="token interpolation"><span class="token punctuation">{</span>task<span class="token punctuation">.</span>successful<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Task ID is: 21846505-1473-4ba4-9544-dc969b6aa02c\nTask status is: PENDING\nTask successful? False\nType: &lt;class &#39;celery.result.AsyncResult&#39;&gt;\nwaiting 2 seconds (the task should have been completed by now)\nTask status: SUCCESS\nTask successful? True\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Notice that the terminal window in which we started the celery worker now has some output in the logs:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[2021-03-06 22:22:51,686: INFO/MainProcess] Received task: apps.core.tasks.debug_task[21846505-1473-4ba4-9544-dc969b6aa02c]\n[2021-03-06 22:22:52,692: INFO/ForkPoolWorker-7] Task apps.core.tasks.debug_task[21846505-1473-4ba4-9544-dc969b6aa02c] succeeded in 1.0044008000113536s: &#39;Debug task slept for 1 second.&#39;\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>We see that the task was received, and that it took about 1 second to complete (the length of time for which the task called <code>sleep</code>) and we see the task&#39;s result, which is the string <code>Debug task slept for 1 second.</code></p><h2 id="setup-watchdog-command-for-celery" tabindex="-1"><a class="header-anchor" href="#setup-watchdog-command-for-celery" aria-hidden="true">#</a> Setup watchdog command for celery</h2><p>If we want to change the length of time that the debug task sleeps for, then we will need to stop the celery worker and restart. As you develop tasks, stopping and restarting the celery worker can be tedious. We can have the celery worker restart automatically on code changes similar to how the Django development server (<code>runserver</code>, also <code>runserver_plus</code> that we are using) restarts automatically on code changes. To do this, we can use a package in our local development environment called <code>watchdog</code>.</p><p>Add the following to <code>requirements/dev.txt</code>:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>watchdog==0.10.3\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>And then reinstall pip requirements with <code>make pip-local</code>.</p><p>Stop the current celery worker by pressing <code>Ctrl+C</code> in the terminal window, and then run the celery command again with watchdog (make sure you are running this from the <code>backend</code> directory):</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>DJANGO_SETTINGS_MODULE=backend.settings.development watchmedo auto-restart --directory=./ --pattern=*.py --recursive -- celery -A backend.celery_app:app worker -l INFO\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>To make this easier to read, we can also write this command as:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">DJANGO_SETTINGS_MODULE</span><span class="token operator">=</span>backend.settings.development <span class="token punctuation">\\</span>\nwatchmedo <span class="token punctuation">\\</span>\n    auto-restart <span class="token punctuation">\\</span>\n    --directory<span class="token operator">=</span>./ <span class="token punctuation">\\</span>\n    --pattern<span class="token operator">=</span>*.py <span class="token punctuation">\\</span>\n    --recursive <span class="token punctuation">\\</span>\n    -- <span class="token punctuation">\\</span>\n    celery <span class="token punctuation">\\</span>\n    -A <span class="token punctuation">\\</span>\n    backend.celery_app:app <span class="token punctuation">\\</span>\n    worker <span class="token punctuation">\\</span>\n    -l <span class="token punctuation">\\</span>\n    INFO\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Since this is a little bit verbose, we can add this command as a <code>make</code> command in our <code>Makefile</code>:</p><div class="language-Makefile ext-Makefile line-numbers-mode"><pre class="language-Makefile"><code>start-celery-default-worker:\n\tDJANGO_SETTINGS_MODULE=backend.settings.development watchmedo auto-restart --directory=./ --pattern=*.py --recursive -- celery -A backend.celery_app:app worker -l INFO\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Now the celery worker will be restarted whenever we make code changes to the Django project. We do have to remember to run the command from the correct directory and to set the <code>DJANGO_SETTINGS_MODULE</code> environment variable</p><h2 id="setup-flower-for-celery-monitoring" tabindex="-1"><a class="header-anchor" href="#setup-flower-for-celery-monitoring" aria-hidden="true">#</a> Setup flower for celery monitoring</h2><p>Now that we have our celery worker running and processing tasks successfully, it would be good to add a tool to our project called <code>flower</code>. <code>flower</code> is a celery monitoring utility that provides a web interface for viewing task and worker status.</p><p>We can use flower in local development, but we can also use flower in production to monitor our tasks in a live environment. We can add the flower dependency to <code>dev.txt</code>:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>flower==0.9.7\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>After re-installing dependencies, run the following command:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>DJANGO_SETTINGS_MODULE=backend.settings.development celery flower -A backend.celery_app:app --address=127.0.0.1 --port=5555\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[I 210306 23:17:22 command:135] Visit me at http://127.0.0.1:5555\n[I 210306 23:17:22 command:142] Broker: redis://localhost:6379/1\n[I 210306 23:17:22 command:143] Registered tasks:\n    [&#39;apps.core.tasks.debug_task&#39;,\n     &#39;celery.accumulate&#39;,\n     &#39;celery.backend_cleanup&#39;,\n     &#39;celery.chain&#39;,\n     &#39;celery.chord&#39;,\n     &#39;celery.chord_unlock&#39;,\n     &#39;celery.chunks&#39;,\n     &#39;celery.group&#39;,\n     &#39;celery.map&#39;,\n     &#39;celery.starmap&#39;]\n[I 210306 23:17:22 mixins:229] Connected to redis://localhost:6379/1\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>Visiting <code>http://127.0.0.1:5555</code> should show that there is a celery worker online. Try stopping and restarting the celery worker and you can see that the worker <code>STATUS</code> changes from <code>Online</code> to <code>Offline</code> and then back to <code>Online</code>. Try running the celery task again from the Jupyter notebook and you should see 1 task in <code>Active</code> and <code>Processed</code> and then once the task finished we should see 1 task in the <code>Succeeded</code> column.</p><p>Celery can also be started with the following command:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>flower -A backend.celery_app:app --broker=redis://localhost:6379/1\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="decide-if-you-need-celery-tasks-always-eager-to-be-set-to-true" tabindex="-1"><a class="header-anchor" href="#decide-if-you-need-celery-tasks-always-eager-to-be-set-to-true" aria-hidden="true">#</a> Decide if you need <code>CELERY_TASKS_ALWAYS_EAGER</code> to be set to <code>True</code></h2><p>Depending on the type of celery tasks your app uses, you may or may not want to use a special Django setting that will run the task directly on the webserver and not on the worker. It can also be said that this setting runs the celery tasks synchronously when <code>CELERY_TASKS_ALWAYS_EAGER = True</code>. If your tasks involve simple steps like sending email or doing relatively fast processing, this might be fine.</p><p>If you want to simulate celery workers running in your local environment in a way similar that they would be running in production, you can also start different celery processes that can run one or more queues.</p><p>First it will be shown using the <code>CELERY_TASKS_ALWAYS_EAGER = True</code> setting, and second it will be shown how to use separate celery worker processes to simulate a production environment on a local development machine.</p><h2 id="setup-celery-beat-settings-periodics-tasks" tabindex="-1"><a class="header-anchor" href="#setup-celery-beat-settings-periodics-tasks" aria-hidden="true">#</a> Setup celery beat, settings, periodics tasks</h2><p>One nice feature of celery is that it allows us to easily schedule tasks that should be performed on regular intervals, similar to how cron jobs schedule tasks.</p><p>This is provided through a part of celery called <code>beat</code>.</p><p>To use celery, we need to define a <code>CELERY_BEAT_SCHEDULE</code> in Django settings and then start another process to start celery beat. This process will send messages to Redis (the bulletin board) at regular intervals that will be processed by celery workers.</p><p>We can use another &quot;debug&quot; task for celery beat:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@app.task\ndef celery_beat_debug_task():\n    return &quot;Celery debug task complete.&quot;\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="run-the-celery-beat-process" tabindex="-1"><a class="header-anchor" href="#run-the-celery-beat-process" aria-hidden="true">#</a> Run the celery beat process</h2><p>Run the following command to start celery beat:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">DJANGO_SETTINGS_MODULE</span><span class="token operator">=</span>backend.settings.development <span class="token punctuation">\\</span>\n    celery <span class="token punctuation">\\</span>\n    --app<span class="token operator">=</span>backend.celery_app:app <span class="token punctuation">\\</span>\n    beat <span class="token punctuation">\\</span>\n    --loglevel<span class="token operator">=</span>INFO\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>celery beat v4.4.7 (cliffs) is starting.\n__    -    ... __   -        _\nLocalTime -&gt; 2021-03-06 23:53:35\nConfiguration -&gt;\n    . broker -&gt; redis://localhost:6379/1\n    . loader -&gt; celery.loaders.app.AppLoader\n    . scheduler -&gt; celery.beat.PersistentScheduler\n    . db -&gt; celerybeat-schedule\n    . logfile -&gt; [stderr]@%INFO\n    . maxinterval -&gt; 5.00 minutes (300s)\n[2021-03-06 23:53:35,922: INFO/MainProcess] beat: Starting...\n[2021-03-06 23:53:45,934: INFO/MainProcess] Scheduler: Sending due task celery-beat-debug-task (apps.core.tasks.celery_beat_debug_task)\n[2021-03-06 23:53:55,930: INFO/MainProcess] Scheduler: Sending due task celery-beat-debug-task (apps.core.tasks.celery_beat_debug_task)\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>Now we should be able to see <code>celery_beat_debug_task</code> tasks processed by the celery worker.</p><p>The only issue is that our celery beat configuration will not be reloaded automatically like celery and the Django development server do. To fix this, we can use <code>watchdog</code>:</p><p>Stop the celery beat process and run the following command from the backend directory:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>DJANGO_SETTINGS_MODULE=backend.settings.development \\\n    watchmedo \\\n    auto-restart \\\n    --directory=./ \\\n    --pattern=*.py \\\n    --recursive \\\n    -- \\\n    celery \\\n    --app=backend.celery_app:app \\\n    beat \\\n    --loglevel=INFO\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Now try changing the celery beat task to be fired every 2 seconds or some other value.</p><h2 id="setup-mailhog-for-testing-email-locally" tabindex="-1"><a class="header-anchor" href="#setup-mailhog-for-testing-email-locally" aria-hidden="true">#</a> Setup mailhog for testing email locally</h2><p>Mailhog is a simple tool that I use when working with email. If your Django application involves sending email from the application, I recommend using Mailhog to preview emails that will be sent from Django.</p><p>Mailhog is written in go, so you will need to do the following to use it locally:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sudo apt-get -y install golang-go\ngo get github.com/mailhog/MailHog\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Once it has finished installing, run the following command to start Mailhog:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>~/go/bin/MailHog\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Then you can see Mailhog in the browser by going to <code>http://localhost:8025/</code>.</p><p>We can write a simple task that will send an email, but we first need to tell Django what to use to send email, so we can add the following lines to <code>base.py</code></p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># Email</span>\nEMAIL_HOST <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;DJANGO_EMAIL_HOST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span>\nEMAIL_PORT <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;DJANGO_EMAIL_PORT&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1025&quot;</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>It is generally a good idea to send email from celery, so let&#39;s create an <code>email_debug_task</code> task in <code>apps/core/tasks.py</code>:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>task</span>\n<span class="token keyword">def</span> <span class="token function">send_email_debug_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    email <span class="token operator">=</span> EmailMessage<span class="token punctuation">(</span>\n        <span class="token string">&quot;Django Step-by-step&quot;</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;This email was sent from Celery.&quot;</span><span class="token punctuation">,</span>\n        settings<span class="token punctuation">.</span>DEFAULT_FROM_EMAIL<span class="token punctuation">,</span>\n        <span class="token punctuation">[</span>settings<span class="token punctuation">.</span>ADMIN_EMAIL<span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span>\n\n    email<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Now we can call this task from Jupyter notebook:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> time\n<span class="token keyword">from</span> apps<span class="token punctuation">.</span>core<span class="token punctuation">.</span>tasks <span class="token keyword">import</span> send_email_debug_task\n\nsend_email_debug_task<span class="token punctuation">.</span>delay<span class="token punctuation">(</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>We should now see the email in Mailhog.</p><h2 id="build-a-model-that-we-can-use-to-demonstrate-crud-and-other-concepts" tabindex="-1"><a class="header-anchor" href="#build-a-model-that-we-can-use-to-demonstrate-crud-and-other-concepts" aria-hidden="true">#</a> Build a Model that we can use to demonstrate CRUD and other concepts</h2><p>Now we can turn to our Django application and setup a model that we can use for demonstration purposes. We will use this model to demonstrate some of the following patterns that are often used in Django projects.</p><ul><li>More complex data relationships</li><li>Templates</li><li>Views</li><li>Forms</li><li>Media files</li><li>DRF, Serializers</li><li>Web sockets</li><li>Testing patterns with pytest and factory</li></ul><p>Let&#39;s suppose we are developing a microblogging application and we want to allow users to create posts. Our post model will contain a text field with a limited number of characters and will optionally allow users to upload media files such as images and gifs.</p><p>Before we build the model, we should build a new Django app that will contain the majority of the logic for our application.</p><h2 id="create-a-new-django-app-for-our-microblogging-demo-application" tabindex="-1"><a class="header-anchor" href="#create-a-new-django-app-for-our-microblogging-demo-application" aria-hidden="true">#</a> Create a new Django app for our microblogging demo application</h2><p>Again, the typical way to add an app to a Django application would be the following command:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>django-admin startapp blog\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>We want to create the app in the <code>apps</code> directory that we have created in the root of our Django project (the <code>apps</code> directory is located in the same directory as <code>manage.py</code>)</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir -p backend/apps/blog &amp;&amp; django-admin startapp blog ./backend/apps/blog\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Make sure to add <code>apps.blog</code> to the <code>INSTALLED_APPS</code> in <code>base.py</code>.</p><h2 id="add-the-model-for-our-microblogs-posts" tabindex="-1"><a class="header-anchor" href="#add-the-model-for-our-microblogs-posts" aria-hidden="true">#</a> Add the model for our microblogs posts</h2><p>Next we can add a post model to the <code>blog</code> app that was created.</p><p>Let&#39;s consider both a simple version of our post model, and a more complex model.</p><p>For a simple model, we can do something like this:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># simple Post model</span>\n<span class="token keyword">from</span> apps<span class="token punctuation">.</span>core<span class="token punctuation">.</span>models <span class="token keyword">import</span> BaseModel\n\n\n<span class="token keyword">class</span> <span class="token class-name">Post</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    body <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>A more complicated model might include some of the features you would see on a site like Twitter:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># a more complex Post model</span>\n<span class="token keyword">from</span> apps<span class="token punctuation">.</span>core<span class="token punctuation">.</span>models <span class="token keyword">import</span> BaseModel\n\n\nVISIBILITY_OPTIONS <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;Public&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;Private&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;Visible to Friends&quot;</span><span class="token punctuation">)</span>\n<span class="token punctuation">]</span>\n\n<span class="token keyword">class</span> <span class="token class-name">Post</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    user <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    text <span class="token operator">=</span> models<span class="token punctuation">.</span>TextField<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    visibility <span class="token operator">=</span> models<span class="token punctuation">.</span>SmallIntegerField<span class="token punctuation">(</span>options<span class="token operator">=</span>VISIBILITY_OPTIONS<span class="token punctuation">)</span>\n    likes <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span>through<span class="token operator">=</span>PostLike<span class="token punctuation">)</span>\n    hashtags <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span>Hashtag<span class="token punctuation">)</span>\n    mentions <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    repost <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span><span class="token string">&#39;self&#39;</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>We can start wit a simple model for now, and then explore adding additional features of a more complex model later.</p><p>The simple model will have the <code>body</code> field and the four fields from the <code>BaseModel</code> that it inherits from: <code>created_on</code>, <code>modified_on</code>, <code>created_by</code> and <code>modified_by</code>. It doesn&#39;t really make sense to have the <code>modified_by</code> attribute on the <code>Post</code> model since only the creator of a post will be able to edit that post. We could either include it, or we can set the <code>modified_by</code> attribute to <code>None</code> on our <code>Post</code> model.</p><h2 id="run-makemigrations" tabindex="-1"><a class="header-anchor" href="#run-makemigrations" aria-hidden="true">#</a> Run <code>makemigrations</code></h2><p>Next run the <code>makemigrations</code> command:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ python3 backend/manage.py makemigrations\nMigrations for &#39;blog&#39;:\n  apps/blog/migrations/0001_initial.py\n    - Create model Post\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Check out the <code>0001_initial.py</code> file that was generated and we can see the fields that will be created for our <code>Post</code> model (when we run the <code>migrate</code> command):</p><ul><li><code>id</code></li><li><code>created_on</code></li><li><code>modified_on</code></li><li><code>body</code></li><li><code>created_by</code></li></ul><h2 id="run-the-migrate-command" tabindex="-1"><a class="header-anchor" href="#run-the-migrate-command" aria-hidden="true">#</a> Run the <code>migrate</code> command</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ python3 backend/manage.py migrate\nOperations to perform:\n  Apply all migrations: accounts, admin, auth, blog, contenttypes, core, sessions\nRunning migrations:\n  Applying blog.0001_initial... OK\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="register-the-post-model-to-the-django-admin" tabindex="-1"><a class="header-anchor" href="#register-the-post-model-to-the-django-admin" aria-hidden="true">#</a> Register the <code>Post</code> model to the Django admin</h2><p>The first thing I usually do after creating or changing a model is to register that model to the Django admin. To do this, we can add a few lines of code to the <code>admin.py</code> file in our <code>blog</code> app:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># apps/blog/admin.py</span>\n<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin\n\n<span class="token comment"># Register your models here.</span>\n<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Post\n\nadmin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>Post<span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>This gives us an interface that we can use to start doing CRUD with our new model. This is one of the big selling points of Django! It is possible to make changes to the behavior of the admin, but you are generally supposed to use this for only admin purposes, not for anything that is face non-technical end users of your application.</p><p>Click on the <code>Posts</code> model, and add a Post with the <code>Add Post</code> button. You will then see our post:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Post object (1)\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="add-a-str-method-to-our-model" tabindex="-1"><a class="header-anchor" href="#add-a-str-method-to-our-model" aria-hidden="true">#</a> Add a __str__ method to our model</h2><p>It would be better if we could see a preview of the post text. We can implement this by adding a <code>__str__</code> method to our <code>Post</code> model:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>    def __str__(self):\n        return self.body\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="add-model-factories-for-micro-blog-post" tabindex="-1"><a class="header-anchor" href="#add-model-factories-for-micro-blog-post" aria-hidden="true">#</a> Add model factories for micro blog post</h2><p>Now that we have a basic working model, we can start adding some tools that will help us test our application&#39;s logic. I have had good experiences using <code>factory</code>.</p><p>Add factory to the <code>test.txt</code> dependencies file:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>factory-boy==3.2.0\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Install the dependencies again with:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>pip3 install -r backend/requirements/test.txt\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="setup-a-factory-py-file-in-the-blog-app-with-a-postfactory" tabindex="-1"><a class="header-anchor" href="#setup-a-factory-py-file-in-the-blog-app-with-a-postfactory" aria-hidden="true">#</a> Setup a <code>factory.py</code> file in the blog app with a <code>PostFactory</code></h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth <span class="token keyword">import</span> get_user_model\n<span class="token keyword">from</span> factory<span class="token punctuation">.</span>django <span class="token keyword">import</span> DjangoModelFactory\n\n<span class="token keyword">from</span> apps<span class="token punctuation">.</span>blog<span class="token punctuation">.</span>models <span class="token keyword">import</span> Post\n\nUser <span class="token operator">=</span> get_user_model<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n\n<span class="token keyword">class</span> <span class="token class-name">UserFactory</span><span class="token punctuation">(</span>DjangoModelFactory<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>\n        model <span class="token operator">=</span> User\n\n\n<span class="token comment"># Another, different, factory for the same object</span>\n<span class="token keyword">class</span> <span class="token class-name">PostFactory</span><span class="token punctuation">(</span>DjangoModelFactory<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>\n        model <span class="token operator">=</span> Post\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="create-a-simple-test-using-postfactory" tabindex="-1"><a class="header-anchor" href="#create-a-simple-test-using-postfactory" aria-hidden="true">#</a> Create a simple test using <code>PostFactory</code></h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> pytest\n\n<span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> TestCase\n<span class="token keyword">from</span> apps<span class="token punctuation">.</span>blog<span class="token punctuation">.</span>factory <span class="token keyword">import</span> PostFactory\n<span class="token keyword">from</span> apps<span class="token punctuation">.</span>blog<span class="token punctuation">.</span>models <span class="token keyword">import</span> Post\n\n\n<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>django_db</span><span class="token punctuation">(</span>transaction<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n<span class="token keyword">def</span> <span class="token function">test_post</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    POST_TEXT <span class="token operator">=</span> <span class="token string">&quot;This is a test post.&quot;</span>\n\n    <span class="token comment"># this saves the post in the database</span>\n    post <span class="token operator">=</span> PostFactory<span class="token punctuation">(</span>body<span class="token operator">=</span>POST_TEXT<span class="token punctuation">)</span>\n\n    <span class="token comment"># this queries the database for the number of posts</span>\n    post_count <span class="token operator">=</span> Post<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n    <span class="token comment"># checks to see if the number of posts queried is 1</span>\n    <span class="token keyword">assert</span> post_count <span class="token operator">==</span> <span class="token number">1</span>\n\n    <span class="token comment"># checks that the post has the body that we assigned to it in the test</span>\n    <span class="token keyword">assert</span> post<span class="token punctuation">.</span>body <span class="token operator">==</span> POST_TEXT\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>This is typically not the type of test we want to write, but this does help to make sure that everything is setup correctly. The problem with this test is that it doesn&#39;t test any of the logic in our application. Later on we will write some tests that do test specific parts of our application logic.</p><h2 id="create-a-url-pattern-that-will-list-all-of-the-blog-posts" tabindex="-1"><a class="header-anchor" href="#create-a-url-pattern-that-will-list-all-of-the-blog-posts" aria-hidden="true">#</a> Create a URL pattern that will list all of the blog posts</h2><p>Create <code>apps/blog/urls.py</code> with the following code:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path\n\n<span class="token keyword">from</span> apps<span class="token punctuation">.</span>blog <span class="token keyword">import</span> views\n\nurlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>\n    path<span class="token punctuation">(</span><span class="token string">&quot;posts/&quot;</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>posts<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="include-the-urls-you-just-created-in-the-main-urls-file" tabindex="-1"><a class="header-anchor" href="#include-the-urls-you-just-created-in-the-main-urls-file" aria-hidden="true">#</a> Include the URLs you just created in the main URLs file</h2><p>Django uses the <code>backend/urls.py</code> to find URLs in our application. Even though we defined a <code>urls.py</code> file in our <code>blog</code> app, Django doesn&#39;t know about it. In order to let Django know about these URLs, add the following line of code to <code>backend/urls.py</code>:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>\n    path<span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">&quot;apps.blog.urls&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># &lt;-- add this line</span>\n    path<span class="token punctuation">(</span><span class="token string">&quot;my-admin-portal/&quot;</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="create-a-simple-function-based-view-for-viewing-all-posts" tabindex="-1"><a class="header-anchor" href="#create-a-simple-function-based-view-for-viewing-all-posts" aria-hidden="true">#</a> Create a simple function-based view for viewing all posts</h2><p>In <code>apps/blog/views.py</code> add a <code>posts</code> function:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render\n\n<span class="token keyword">from</span> apps<span class="token punctuation">.</span>blog<span class="token punctuation">.</span>models <span class="token keyword">import</span> Post\n\n\n<span class="token keyword">def</span> <span class="token function">posts</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    context <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;posts&quot;</span><span class="token punctuation">:</span> Post<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>\n    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> template_name<span class="token operator">=</span><span class="token string">&quot;posts.html&quot;</span><span class="token punctuation">,</span> context<span class="token operator">=</span>context<span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="create-a-templates-directory-in-the-blog-app-and-add-posts-html" tabindex="-1"><a class="header-anchor" href="#create-a-templates-directory-in-the-blog-app-and-add-posts-html" aria-hidden="true">#</a> Create a <code>templates</code> directory in the <code>blog</code> app and add <code>posts.html</code></h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{% extends &quot;base.html&quot; %}\n\nThis is the post template\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="add-dirs-base-dir-templates-to-settings-base-py" tabindex="-1"><a class="header-anchor" href="#add-dirs-base-dir-templates-to-settings-base-py" aria-hidden="true">#</a> Add <code>&quot;DIRS&quot;: [BASE_DIR / &quot;templates&quot;],</code> to <code>settings/base.py</code></h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>TEMPLATES <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">{</span>\n        <span class="token string">&quot;BACKEND&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;django.template.backends.django.DjangoTemplates&quot;</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;DIRS&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>BASE_DIR <span class="token operator">/</span> <span class="token string">&quot;templates&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment"># &lt;-- this line</span>\n        <span class="token string">&quot;APP_DIRS&quot;</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>\n        <span class="token string">&quot;OPTIONS&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n            <span class="token string">&quot;context_processors&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>\n                <span class="token string">&quot;django.template.context_processors.debug&quot;</span><span class="token punctuation">,</span>\n                <span class="token string">&quot;django.template.context_processors.request&quot;</span><span class="token punctuation">,</span>\n                <span class="token string">&quot;django.contrib.auth.context_processors.auth&quot;</span><span class="token punctuation">,</span>\n                <span class="token string">&quot;django.contrib.messages.context_processors.messages&quot;</span><span class="token punctuation">,</span>\n            <span class="token punctuation">]</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="add-a-new-folder-in-the-backend-directory-called-templates-and-add-base-html" tabindex="-1"><a class="header-anchor" href="#add-a-new-folder-in-the-backend-directory-called-templates-and-add-base-html" aria-hidden="true">#</a> Add a new folder in the <code>backend</code> directory called <code>templates</code> and add <code>base.html</code></h2>',151),Z=(0,e.Uk)("We are now going to implement template inheritance ("),nn={href:"https://docs.djangoproject.com/en/3.1/ref/templates/language/#template-inheritance",target:"_blank",rel:"noopener noreferrer"},sn=(0,e.Uk)("https://docs.djangoproject.com/en/3.1/ref/templates/language/#template-inheritance"),an=(0,e.Uk)(")"),en=(0,e.uE)('<div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>This is the base template\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="add-bootstrap-to-our-base-template" tabindex="-1"><a class="header-anchor" href="#add-bootstrap-to-our-base-template" aria-hidden="true">#</a> Add Bootstrap to our base template</h2><h2 id="write-a-management-command-that-generates-fake-data" tabindex="-1"><a class="header-anchor" href="#write-a-management-command-that-generates-fake-data" aria-hidden="true">#</a> Write a management command that generates fake data</h2><p>To test out our template logic, we can generate some posts. We can use the <code>faker</code> library to do this along with a Django management command.</p><p>Create the following file in <code>apps/blog/management/commands/generate_posts.py</code>:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>management<span class="token punctuation">.</span>base <span class="token keyword">import</span> BaseCommand\n\n<span class="token keyword">from</span> apps<span class="token punctuation">.</span>blog<span class="token punctuation">.</span>factory <span class="token keyword">import</span> PostFactory\n\n\n<span class="token keyword">class</span> <span class="token class-name">Command</span><span class="token punctuation">(</span>BaseCommand<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token builtin">help</span> <span class="token operator">=</span> <span class="token string">&quot;Generate some posts&quot;</span>\n\n    <span class="token keyword">def</span> <span class="token function">handle</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>options<span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;generating posts&quot;</span><span class="token punctuation">)</span>\n        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            PostFactory<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;finished generating posts&quot;</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="add-pagination-to-posts-view" tabindex="-1"><a class="header-anchor" href="#add-pagination-to-posts-view" aria-hidden="true">#</a> Add pagination to posts view</h2><p>We should add pagination so we can limit the number of posts that are shown.</p>',8),tn={href:"https://docs.djangoproject.com/en/3.1/topics/pagination/#using-paginator-in-a-view-function",target:"_blank",rel:"noopener noreferrer"},pn=(0,e.Uk)("https://docs.djangoproject.com/en/3.1/topics/pagination/#using-paginator-in-a-view-function"),on=(0,e.uE)('<div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>paginator <span class="token keyword">import</span> Paginator\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="create-a-post-detail-view" tabindex="-1"><a class="header-anchor" href="#create-a-post-detail-view" aria-hidden="true">#</a> Create a post detail view</h2><h2 id="add-url-for-post-detail-view" tabindex="-1"><a class="header-anchor" href="#add-url-for-post-detail-view" aria-hidden="true">#</a> Add URL for post detail view</h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>    <span class="token comment"># read (detail)</span>\n    path<span class="token punctuation">(</span><span class="token string">&quot;posts/&lt;str:id&gt;&quot;</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>post<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&quot;post&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="create-a-template-called-post-html-in-templates" tabindex="-1"><a class="header-anchor" href="#create-a-template-called-post-html-in-templates" aria-hidden="true">#</a> Create a template called <code>post.html</code> in templates</h2><h2 id="link-to-detail-views-from-the-list-view" tabindex="-1"><a class="header-anchor" href="#link-to-detail-views-from-the-list-view" aria-hidden="true">#</a> Link to detail views from the list view</h2><h2 id="set-up-head-for-post-detail-page-for-seo" tabindex="-1"><a class="header-anchor" href="#set-up-head-for-post-detail-page-for-seo" aria-hidden="true">#</a> Set up <code>head</code> for Post detail page for SEO</h2><h2 id="add-post-create-form" tabindex="-1"><a class="header-anchor" href="#add-post-create-form" aria-hidden="true">#</a> Add Post Create Form</h2><p>We can generate posts through the admin and through our management command. Now let&#39;s add a way for users to add posts.</p><h2 id="add-a-url-for-a-creating-a-new-post" tabindex="-1"><a class="header-anchor" href="#add-a-url-for-a-creating-a-new-post" aria-hidden="true">#</a> Add a URL for a creating a new post</h2><h2 id="add-new-post-html-template" tabindex="-1"><a class="header-anchor" href="#add-new-post-html-template" aria-hidden="true">#</a> Add <code>new_post.html</code> template</h2><h2 id="change-the-ordering-of-posts-in-the-post-model" tabindex="-1"><a class="header-anchor" href="#change-the-ordering-of-posts-in-the-post-model" aria-hidden="true">#</a> Change the ordering of posts in the Post model</h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Post</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token comment"># meta class</span>\n    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>\n        ordering <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&quot;-created_on&quot;</span><span class="token punctuation">,</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="add-wildcard-to-allowed-hosts-in-development-settings-module" tabindex="-1"><a class="header-anchor" href="#add-wildcard-to-allowed-hosts-in-development-settings-module" aria-hidden="true">#</a> Add wildcard to <code>ALLOWED_HOSTS</code> in <code>development</code> settings module</h2><p>This will allow you to view the application from a mobile device on your local network</p><h2 id="use-django-messaging-framework-to-update-user-on-post-creation-success" tabindex="-1"><a class="header-anchor" href="#use-django-messaging-framework-to-update-user-on-post-creation-success" aria-hidden="true">#</a> Use Django messaging framework to update user on post creation success</h2><h2 id="create-urls-py-in-the-accounts-app-with-a-login-path" tabindex="-1"><a class="header-anchor" href="#create-urls-py-in-the-accounts-app-with-a-login-path" aria-hidden="true">#</a> Create <code>urls.py</code> in the accounts app with a login path</h2><h2 id="create-the-login-view-in-apps-accounts-views" tabindex="-1"><a class="header-anchor" href="#create-the-login-view-in-apps-accounts-views" aria-hidden="true">#</a> Create the login view in <code>apps/accounts/views</code></h2><h2 id="override-the-default-login-form" tabindex="-1"><a class="header-anchor" href="#override-the-default-login-form" aria-hidden="true">#</a> Override the Default Login form</h2>',19),ln={href:"https://stackoverflow.com/questions/55369645/how-to-customize-default-auth-login-form-in-django/55369791",target:"_blank",rel:"noopener noreferrer"},rn=(0,e.Uk)("https://stackoverflow.com/questions/55369645/how-to-customize-default-auth-login-form-in-django/55369791"),cn=(0,e.uE)('<h2 id="set-login-redirect-url-and-login-redirect-url-in-base-settings-module" tabindex="-1"><a class="header-anchor" href="#set-login-redirect-url-and-login-redirect-url-in-base-settings-module" aria-hidden="true">#</a> Set <code>LOGIN_REDIRECT_URL</code> and <code>LOGIN_REDIRECT_URL</code> in <code>base</code> settings module</h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>LOGIN_REDIRECT_URL <span class="token operator">=</span> <span class="token string">&quot;/posts&quot;</span>\nLOGOUT_REDIRECT_URL <span class="token operator">=</span> <span class="token string">&quot;/posts&quot;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="create-login-page" tabindex="-1"><a class="header-anchor" href="#create-login-page" aria-hidden="true">#</a> Create Login page</h2><h2 id="enable-logout" tabindex="-1"><a class="header-anchor" href="#enable-logout" aria-hidden="true">#</a> Enable logout</h2><h2 id="create-update-view-for-post" tabindex="-1"><a class="header-anchor" href="#create-update-view-for-post" aria-hidden="true">#</a> Create update view for post</h2><h2 id="create-update-url-for-post" tabindex="-1"><a class="header-anchor" href="#create-update-url-for-post" aria-hidden="true">#</a> Create update URL for post</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="add-delete-url-path-for-posts" tabindex="-1"><a class="header-anchor" href="#add-delete-url-path-for-posts" aria-hidden="true">#</a> Add delete URL path for posts</h2><h2 id="create-delete-view-for-post" tabindex="-1"><a class="header-anchor" href="#create-delete-view-for-post" aria-hidden="true">#</a> Create delete view for post</h2><h2 id="enable-searching-posts" tabindex="-1"><a class="header-anchor" href="#enable-searching-posts" aria-hidden="true">#</a> Enable searching posts</h2><h2 id="fix-pagination-with-search-term" tabindex="-1"><a class="header-anchor" href="#fix-pagination-with-search-term" aria-hidden="true">#</a> Fix pagination with search term</h2><p>Add the following do each of the links in the pagination section of the post list. This will ensure that the search term query parameter and pagination can be used together.</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span>\n  <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&amp;q={{ request.GET.q }}{% endif %}<span class="token punctuation">&quot;</span></span>\n  <span class="token punctuation">&gt;</span></span>previous<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span>\n<span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div>',13),un=(0,e.Uk)("If there are lots of other parameters to add, use the following solution: "),dn={href:"https://stackoverflow.com/questions/2047622/how-to-paginate-django-with-other-get-variables",target:"_blank",rel:"noopener noreferrer"},bn=(0,e.Uk)("https://stackoverflow.com/questions/2047622/how-to-paginate-django-with-other-get-variables"),mn=(0,e.uE)('<h2 id="add-registration-url" tabindex="-1"><a class="header-anchor" href="#add-registration-url" aria-hidden="true">#</a> Add registration URL</h2><h2 id="add-registration-view" tabindex="-1"><a class="header-anchor" href="#add-registration-view" aria-hidden="true">#</a> Add registration view</h2><p>There are a lot of ways to do registration, and lots of packages that can help with this process.</p><p>We can start with a simple implementation that allows us to signup with an email address with a confirmation email. Since we have already setup MailHog, this should be easy.</p><h2 id="add-registration-form" tabindex="-1"><a class="header-anchor" href="#add-registration-form" aria-hidden="true">#</a> Add registration form</h2><h2 id="add-email-confirmation-url-and-view" tabindex="-1"><a class="header-anchor" href="#add-email-confirmation-url-and-view" aria-hidden="true">#</a> Add email confirmation url and view</h2><h2 id="add-request-password-reset-form" tabindex="-1"><a class="header-anchor" href="#add-request-password-reset-form" aria-hidden="true">#</a> Add request Password reset form</h2><h2 id="add-password-reset-email-with-link" tabindex="-1"><a class="header-anchor" href="#add-password-reset-email-with-link" aria-hidden="true">#</a> Add password reset email with link</h2><h2 id="add-password-reset-url" tabindex="-1"><a class="header-anchor" href="#add-password-reset-url" aria-hidden="true">#</a> Add password reset URL</h2><h2 id="add-password-reset-form" tabindex="-1"><a class="header-anchor" href="#add-password-reset-form" aria-hidden="true">#</a> Add password reset form</h2><h2 id="add-password-reset-view" tabindex="-1"><a class="header-anchor" href="#add-password-reset-view" aria-hidden="true">#</a> Add password reset view</h2><h2 id="add-vue-via-cdn-in-base-html" tabindex="-1"><a class="header-anchor" href="#add-vue-via-cdn-in-base-html" aria-hidden="true">#</a> Add Vue via CDN in <code>base.html</code></h2>',12),kn={href:"https://v3.vuejs.org/guide/installation.html#cdn",target:"_blank",rel:"noopener noreferrer"},hn=(0,e.Uk)("https://v3.vuejs.org/guide/installation.html#cdn"),gn=(0,e.uE)('<div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://unpkg.com/vue@next<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="add-an-example-of-how-to-setup-a-vue-component-in-django-template" tabindex="-1"><a class="header-anchor" href="#add-an-example-of-how-to-setup-a-vue-component-in-django-template" aria-hidden="true">#</a> Add an example of how to setup a Vue component in Django template</h2><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code>{% for post in page_obj %}\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/posts/{{ post.id }}<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">text-decoration</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span> <span class="token property">color</span><span class="token punctuation">:</span> #000</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>card p-4 mb-2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ post.body }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ post.created_on }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>\n    {% if post.created_by %}\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ post.created_by }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>\n    {% endif %} {% include &quot;post_likes.html&quot; with post_id=post.id\n    like_count=post.like_count liked=post.liked %}\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>\n{% endfor %}\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Notice the <code>{% include &quot;post_likes.html&quot; ... %}</code>, will add a nested template with different parameters to our page that will contain a clickable heart button that will make an API call to the backend.</p><h2 id="create-a-template-called-post-likes-html" tabindex="-1"><a class="header-anchor" href="#create-a-template-called-post-likes-html" aria-hidden="true">#</a> Create a template called <code>post_likes.html</code></h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>backend/apps/blog/templates/post_likes.html\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="add-vue-component-definition-and-template" tabindex="-1"><a class="header-anchor" href="#add-vue-component-definition-and-template" aria-hidden="true">#</a> Add Vue component definition and template</h2><p>Notice how the Javascript <code>const</code> definition for the Vue component contains a Django template variable. We need to do this so the name of each created Vue component is unique.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> LikeCounter<span class="token punctuation">{</span><span class="token punctuation">{</span> post_id <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n  delimiters<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;[[&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;]]&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      counter<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> like_count <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n      liked<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> liked <span class="token operator">|</span> lower <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\nVue<span class="token punctuation">.</span><span class="token function">createApp</span><span class="token punctuation">(</span>LikeCounter<span class="token punctuation">{</span><span class="token punctuation">{</span> post_id <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">&quot;#counter-{{ post_id }}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="add-axios-via-cdn" tabindex="-1"><a class="header-anchor" href="#add-axios-via-cdn" aria-hidden="true">#</a> Add axios Via CDN</h2><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- Axios --&gt;</span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="configure-axios-cdn" tabindex="-1"><a class="header-anchor" href="#configure-axios-cdn" aria-hidden="true">#</a> Configure Axios CDN</h2><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- configure axios to use csrftoken --&gt;</span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">\n  axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>xsrfCookieName <span class="token operator">=</span> <span class="token string">&quot;csrftoken&quot;</span><span class="token punctuation">;</span>\n  axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>xsrfHeaderName <span class="token operator">=</span> <span class="token string">&quot;X-CSRFTOKEN&quot;</span><span class="token punctuation">;</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="add-a-method-to-the-postlike-component-that-will-make-an-api-call-using-axios" tabindex="-1"><a class="header-anchor" href="#add-a-method-to-the-postlike-component-that-will-make-an-api-call-using-axios" aria-hidden="true">#</a> Add a method to the PostLike component that will make an API call using axios</h2><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>    methods<span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token keyword">async</span> <span class="token function">toggleLike</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">try</span> <span class="token punctuation">{</span>\n                <span class="token keyword">const</span> resp <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/api/posts/{{ post_id }}/like&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n                <span class="token keyword">this</span><span class="token punctuation">.</span>counter <span class="token operator">=</span> resp<span class="token punctuation">.</span>data<span class="token punctuation">.</span>likes<span class="token punctuation">;</span>\n                <span class="token keyword">this</span><span class="token punctuation">.</span>liked <span class="token operator">=</span> resp<span class="token punctuation">.</span>data<span class="token punctuation">.</span>like<span class="token punctuation">;</span>\n            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>\n                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Please login or create an account to like posts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="setup-an-endpoint-that-will-handle-our-axios-call" tabindex="-1"><a class="header-anchor" href="#setup-an-endpoint-that-will-handle-our-axios-call" aria-hidden="true">#</a> Setup an endpoint that will handle our axios call</h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>    path<span class="token punctuation">(</span><span class="token string">&quot;api/posts/&lt;str:id&gt;/like&quot;</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>like_post<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&quot;like-post&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="setup-a-view-to-handle-the-like-post-endpoint-that-returns-a-jsonresponse" tabindex="-1"><a class="header-anchor" href="#setup-a-view-to-handle-the-like-post-endpoint-that-returns-a-jsonresponse" aria-hidden="true">#</a> Setup a view to handle the like-post endpoint that returns a JsonResponse</h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> login_required\n<span class="token keyword">from</span> django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span>http <span class="token keyword">import</span> require_POST\n\n\n<span class="token decorator annotation punctuation">@login_required</span>\n<span class="token decorator annotation punctuation">@require_POST</span>\n<span class="token keyword">def</span> <span class="token function">like_post</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n    <span class="token comment"># implement like post logic</span>\n    post <span class="token operator">=</span> get_object_or_404<span class="token punctuation">(</span>Post<span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token builtin">id</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">if</span> request<span class="token punctuation">.</span>user <span class="token keyword">not</span> <span class="token keyword">in</span> post<span class="token punctuation">.</span>likes<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        post_like_through_model <span class="token operator">=</span> PostLike<span class="token punctuation">(</span>post<span class="token operator">=</span>post<span class="token punctuation">,</span> liked_by<span class="token operator">=</span>request<span class="token punctuation">.</span>user<span class="token punctuation">)</span>\n        post_like_through_model<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        like <span class="token operator">=</span> <span class="token boolean">True</span>\n    <span class="token keyword">else</span><span class="token punctuation">:</span>\n        post<span class="token punctuation">.</span>likes<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>request<span class="token punctuation">.</span>user<span class="token punctuation">)</span>\n        like <span class="token operator">=</span> <span class="token boolean">False</span>\n\n    post_like_count <span class="token operator">=</span> post<span class="token punctuation">.</span>likes<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;likes&quot;</span><span class="token punctuation">:</span> post_like_count<span class="token punctuation">,</span> <span class="token string">&quot;like&quot;</span><span class="token punctuation">:</span> like<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="implement-through-model-for-manytomany-field-for-post-likes" tabindex="-1"><a class="header-anchor" href="#implement-through-model-for-manytomany-field-for-post-likes" aria-hidden="true">#</a> Implement through Model for ManyToMany field for Post likes</h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># apps/blog/models.py</span>\n<span class="token keyword">class</span> <span class="token class-name">PostLike</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    liked_by <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>User<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>\n    post <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>Post<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="add-through-model-to-django-admin" tabindex="-1"><a class="header-anchor" href="#add-through-model-to-django-admin" aria-hidden="true">#</a> Add through model to Django admin</h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>PostLike<span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="run-makemigrations-and-migrate-for-postlike" tabindex="-1"><a class="header-anchor" href="#run-makemigrations-and-migrate-for-postlike" aria-hidden="true">#</a> Run <code>makemigrations</code> and <code>migrate</code> for PostLike</h2><h2 id="add-prefetch-related-created-by-to-post-list-query-to-reduce-db-queries" tabindex="-1"><a class="header-anchor" href="#add-prefetch-related-created-by-to-post-list-query-to-reduce-db-queries" aria-hidden="true">#</a> Add <code>prefetch_related(&quot;created_by&quot;)</code> to post list query to reduce DB queries</h2><h2 id="add-a-favicon-in-static" tabindex="-1"><a class="header-anchor" href="#add-a-favicon-in-static" aria-hidden="true">#</a> Add a favicon in static</h2><p>Add <code>favicon.ico</code> to the <code>static</code> folder.</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>shortcut icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>image/png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{% static <span class="token punctuation">&#39;</span>favicon.ico<span class="token punctuation">&#39;</span> %}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="add-github-workflows-lint-yml-for-github-action-that-lints-python-code" tabindex="-1"><a class="header-anchor" href="#add-github-workflows-lint-yml-for-github-action-that-lints-python-code" aria-hidden="true">#</a> Add <code>.github/workflows/lint.yml</code> for GitHub Action that lints Python code</h2><p>Let&#39;s add a GitHub action following this example.</p>',30),vn={href:"https://docs.github.com/en/actions/quickstart",target:"_blank",rel:"noopener noreferrer"},yn=(0,e.Uk)("https://docs.github.com/en/actions/quickstart"),fn=(0,e.uE)('<div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> lint<span class="token punctuation">-</span>and<span class="token punctuation">-</span>test<span class="token punctuation">-</span>python\n\n<span class="token comment"># Run this workflow every time a new commit pushed to your repository</span>\n<span class="token key atrule">on</span><span class="token punctuation">:</span>\n  <span class="token key atrule">push</span><span class="token punctuation">:</span>\n    <span class="token key atrule">branches</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> main\n\n<span class="token key atrule">jobs</span><span class="token punctuation">:</span>\n  <span class="token comment"># Set the job key. The key is displayed as the job name</span>\n  <span class="token comment"># when a job name is not provided</span>\n  <span class="token key atrule">lint-and-test-python</span><span class="token punctuation">:</span>\n    <span class="token comment"># Name the Job</span>\n    <span class="token key atrule">name</span><span class="token punctuation">:</span> Lint and test python code\n    <span class="token comment"># Set the type of machine to run on</span>\n    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest\n\n    <span class="token comment"># Service containers to run with `container-job`</span>\n    <span class="token key atrule">services</span><span class="token punctuation">:</span>\n      <span class="token comment"># Label used to access the service container</span>\n      <span class="token key atrule">postgres</span><span class="token punctuation">:</span>\n        <span class="token comment"># Docker Hub image</span>\n        <span class="token key atrule">image</span><span class="token punctuation">:</span> postgres\n        <span class="token comment"># Provide the password for postgres</span>\n        <span class="token key atrule">env</span><span class="token punctuation">:</span>\n          <span class="token key atrule">POSTGRES_PASSWORD</span><span class="token punctuation">:</span> postgres\n        <span class="token comment"># Set health checks to wait until postgres has started</span>\n        <span class="token key atrule">options</span><span class="token punctuation">:</span> <span class="token punctuation">&gt;</span><span class="token punctuation">-</span>\n          <span class="token punctuation">-</span><span class="token punctuation">-</span>health<span class="token punctuation">-</span>cmd pg_isready\n          <span class="token punctuation">-</span><span class="token punctuation">-</span>health<span class="token punctuation">-</span>interval 10s\n          <span class="token punctuation">-</span><span class="token punctuation">-</span>health<span class="token punctuation">-</span>timeout 5s\n          <span class="token punctuation">-</span><span class="token punctuation">-</span>health<span class="token punctuation">-</span>retries 5\n\n        <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n          <span class="token comment"># Maps tcp port 5432 on service container to the host</span>\n          <span class="token punctuation">-</span> 5432<span class="token punctuation">:</span><span class="token number">5432</span>\n\n    <span class="token key atrule">strategy</span><span class="token punctuation">:</span>\n      <span class="token key atrule">matrix</span><span class="token punctuation">:</span>\n        <span class="token key atrule">python-version</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">3.8</span><span class="token punctuation">]</span>\n\n    <span class="token key atrule">steps</span><span class="token punctuation">:</span>\n      <span class="token comment"># Setup python version</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Set up Python $<span class="token punctuation">{</span><span class="token punctuation">{</span> matrix.python<span class="token punctuation">-</span>version <span class="token punctuation">}</span><span class="token punctuation">}</span>\n        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>python@v2\n        <span class="token key atrule">with</span><span class="token punctuation">:</span>\n          <span class="token key atrule">python-version</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> matrix.python<span class="token punctuation">-</span>version <span class="token punctuation">}</span><span class="token punctuation">}</span>\n      <span class="token comment"># Checks out a copy of your repository on the ubuntu-latest machine</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout code\n        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3\n\n      <span class="token comment"># install pip dependencies</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> pip install\n        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">\n          python -m pip install --upgrade pip\n          pip install -r backend/requirements/base.txt\n          pip install -r backend/requirements/dev.txt\n          pip install -r backend/requirements/test.txt</span>\n\n      <span class="token comment"># lint python code using flake8</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Lint code\n        <span class="token key atrule">run</span><span class="token punctuation">:</span> flake8 backend\n\n      <span class="token comment"># run pytest tests</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Run pytest tests\n        <span class="token key atrule">run</span><span class="token punctuation">:</span> pytest backend\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div></div><h2 id="add-bitbucket-pipelines-yml-for-bitbucket-pipelines" tabindex="-1"><a class="header-anchor" href="#add-bitbucket-pipelines-yml-for-bitbucket-pipelines" aria-hidden="true">#</a> Add <code>bitbucket-pipelines.yml</code> for BitBucket pipelines</h2><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">image</span><span class="token punctuation">:</span> python<span class="token punctuation">:</span><span class="token number">3.8</span>\n\n<span class="token key atrule">pipelines</span><span class="token punctuation">:</span>\n  <span class="token key atrule">default</span><span class="token punctuation">:</span>\n    <span class="token punctuation">-</span> <span class="token key atrule">step</span><span class="token punctuation">:</span>\n        <span class="token key atrule">name</span><span class="token punctuation">:</span> lint and test python code\n        <span class="token key atrule">caches</span><span class="token punctuation">:</span>\n          <span class="token punctuation">-</span> pip\n        <span class="token key atrule">script</span><span class="token punctuation">:</span>\n          <span class="token punctuation">-</span> pip install <span class="token punctuation">-</span>r backend/requirements_dev.txt\n          <span class="token punctuation">-</span> flake8 backend\n          <span class="token punctuation">-</span> black <span class="token punctuation">-</span>l 79 backend\n          <span class="token punctuation">-</span> pytest backend\n        <span class="token key atrule">services</span><span class="token punctuation">:</span>\n          <span class="token punctuation">-</span> postgres\n\n<span class="token key atrule">definitions</span><span class="token punctuation">:</span>\n  <span class="token key atrule">services</span><span class="token punctuation">:</span>\n    <span class="token key atrule">postgres</span><span class="token punctuation">:</span>\n      <span class="token key atrule">image</span><span class="token punctuation">:</span> postgres\n      <span class="token key atrule">variables</span><span class="token punctuation">:</span>\n        <span class="token key atrule">POSTGRES_DB</span><span class="token punctuation">:</span> <span class="token string">&quot;postgres&quot;</span>\n        <span class="token key atrule">POSTGRES_USER</span><span class="token punctuation">:</span> <span class="token string">&quot;postgres&quot;</span>\n        <span class="token key atrule">POSTGRES_PASSWORD</span><span class="token punctuation">:</span> <span class="token string">&quot;postgres&quot;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="generic-class-based-views" tabindex="-1"><a class="header-anchor" href="#generic-class-based-views" aria-hidden="true">#</a> Generic Class Based Views</h2><p>We can reimplement our application logic with generic class-based views (GCBVs). There&#39;s nothing wrong without function-based views (FBVs). The code is straightforward and relatively easy to understand. GCBVs will let us achieve the same functionality with fewer lines of code. You can use only CBVs, only GBVs or a mix of the two together. However you decide to write your view, GCBVs are in import part of Django that you should know about.</p><p>This project demonstrates implementations of FBVs and GCBVs, as well as other ways of expressing our views using the Django REST Framework, which also has a similar concept of FBVs and GCBVs.</p><h2 id="create-a-file-in-the-blog-app-called-class-based-views-py" tabindex="-1"><a class="header-anchor" href="#create-a-file-in-the-blog-app-called-class-based-views-py" aria-hidden="true">#</a> Create a file in the <code>blog</code> app called <code>class_based_views.py</code></h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>touch backend/apps/blog/class_based_views.py\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="add-a-generic-listview-to-the-class-based-views-file" tabindex="-1"><a class="header-anchor" href="#add-a-generic-listview-to-the-class-based-views-file" aria-hidden="true">#</a> Add a generic <code>ListView</code> to the <code>class_based_views</code> file</h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># class_based_views.py</span>\n<span class="token keyword">from</span> django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>generic <span class="token keyword">import</span> ListView\n<span class="token keyword">from</span> apps<span class="token punctuation">.</span>blog<span class="token punctuation">.</span>models <span class="token keyword">import</span> Post\n\n\n<span class="token keyword">class</span> <span class="token class-name">PostList</span><span class="token punctuation">(</span>ListView<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    model <span class="token operator">=</span> Post\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>Note</strong>: the name of the file <code>cbv_urls.py</code> doesn&#39;t matter.</p><h2 id="setup-a-new-urls-file" tabindex="-1"><a class="header-anchor" href="#setup-a-new-urls-file" aria-hidden="true">#</a> Setup a new URLs file</h2><p>Let&#39;s add a new URLs file to the <code>blog</code> app that will contain urls for our GCBVs.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>touch backend/apps/blog/cbv_urls.py\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="add-a-urlpatterns-with-a-path-that-uses-the-postlist-cbv" tabindex="-1"><a class="header-anchor" href="#add-a-urlpatterns-with-a-path-that-uses-the-postlist-cbv" aria-hidden="true">#</a> Add a <code>urlpatterns</code> with a path that uses the <code>PostList</code> CBV</h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># URLs for GCBVs</span>\n\n<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path\n<span class="token keyword">from</span> apps<span class="token punctuation">.</span>blog<span class="token punctuation">.</span>class_based_views <span class="token keyword">import</span> PostList\n\nurlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>\n    path<span class="token punctuation">(</span><span class="token string">&quot;posts&quot;</span><span class="token punctuation">,</span> PostList<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="include-cbv-urls-py-in-backend-urls-py" tabindex="-1"><a class="header-anchor" href="#include-cbv-urls-py-in-backend-urls-py" aria-hidden="true">#</a> Include <code>cbv_urls.py</code> in <code>backend/urls.py</code></h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>    path<span class="token punctuation">(</span><span class="token string">&quot;cbv/&quot;</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">&quot;apps.blog.cbv_urls&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Now visit <code>http://127.0.0.1:8000/cbv/posts</code> and we will see the following error:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>django.template.exceptions.TemplateDoesNotExist\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="fix-the-template-for-the-postlist-cbv" tabindex="-1"><a class="header-anchor" href="#fix-the-template-for-the-postlist-cbv" aria-hidden="true">#</a> Fix the template for the PostList CBV</h2><p>Class based-views expect to find a template at <code>blog/post_list.html</code> in our app&#39;s <code>templates</code> directory. We can put a template there, or we can override the location by adding <code>template_name</code> to <code>PostList</code>:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">PostList</span><span class="token punctuation">(</span>ListView<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    model <span class="token operator">=</span> Post\n    template_name <span class="token operator">=</span> <span class="token string">&quot;blog/posts.html&quot;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="add-cbv-detailview-for-viewing-a-single-post" tabindex="-1"><a class="header-anchor" href="#add-cbv-detailview-for-viewing-a-single-post" aria-hidden="true">#</a> Add CBV DetailView for viewing a single post</h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">PostDetailView</span><span class="token punctuation">(</span>DetailView<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    model <span class="token operator">=</span> Post\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="add-url-path-for-detailview" tabindex="-1"><a class="header-anchor" href="#add-url-path-for-detailview" aria-hidden="true">#</a> Add URL path for DetailView</h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>    path<span class="token punctuation">(</span><span class="token string">&quot;posts/&lt;int:pk&gt;&quot;</span><span class="token punctuation">,</span> PostDetailView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="add-a-template-for-the-postdetailview-in-blog-post-detail-in-the-blog-app-templates-directory" tabindex="-1"><a class="header-anchor" href="#add-a-template-for-the-postdetailview-in-blog-post-detail-in-the-blog-app-templates-directory" aria-hidden="true">#</a> Add a template for the PostDetailView in <code>blog/post_detail</code> in the <code>blog</code> app <code>templates</code> directory</h2><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="add-a-postcreateview-for-creating-posts-using-cbv" tabindex="-1"><a class="header-anchor" href="#add-a-postcreateview-for-creating-posts-using-cbv" aria-hidden="true">#</a> Add a PostCreateView for creating posts using CBV</h2><h2 id="add-a-postupdateview-for-editing-posts" tabindex="-1"><a class="header-anchor" href="#add-a-postupdateview-for-editing-posts" aria-hidden="true">#</a> Add a PostUpdateView for editing posts</h2><ul><li>template</li><li>URL pattern</li><li>CBV</li><li>tests</li></ul><h2 id="add-a-deletepostview-for-deleting-posts" tabindex="-1"><a class="header-anchor" href="#add-a-deletepostview-for-deleting-posts" aria-hidden="true">#</a> Add a DeletePostView for deleting posts</h2><h2 id="add-tests-for-cbvs" tabindex="-1"><a class="header-anchor" href="#add-tests-for-cbvs" aria-hidden="true">#</a> Add tests for CBVs</h2><h2 id="account-management" tabindex="-1"><a class="header-anchor" href="#account-management" aria-hidden="true">#</a> Account Management</h2><h2 id="add-profile-view" tabindex="-1"><a class="header-anchor" href="#add-profile-view" aria-hidden="true">#</a> Add profile view</h2><ul><li>All posts</li><li>Likes</li><li>Post likes</li><li>tests</li></ul><h2 id="add-account-settings-view" tabindex="-1"><a class="header-anchor" href="#add-account-settings-view" aria-hidden="true">#</a> Add account settings view</h2><ul><li>Delete account</li><li>Change password</li></ul><h2 id="refactor-queryset-and-manager-for-post-model" tabindex="-1"><a class="header-anchor" href="#refactor-queryset-and-manager-for-post-model" aria-hidden="true">#</a> Refactor QuerySet and Manager for Post model</h2><h2 id="account-settings" tabindex="-1"><a class="header-anchor" href="#account-settings" aria-hidden="true">#</a> Account settings</h2><h2 id="django-rest-framework" tabindex="-1"><a class="header-anchor" href="#django-rest-framework" aria-hidden="true">#</a> Django REST Framework</h2><h2 id="add-django-rest-framework-to-base-txt-dependencies" tabindex="-1"><a class="header-anchor" href="#add-django-rest-framework-to-base-txt-dependencies" aria-hidden="true">#</a> Add Django REST Framework to <code>base.txt</code> dependencies</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>djangorestframework==3.12.4\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="add-restframework-to-installed-apps-in-base-settings-module" tabindex="-1"><a class="header-anchor" href="#add-restframework-to-installed-apps-in-base-settings-module" aria-hidden="true">#</a> Add <code>restframework</code> to <code>INSTALLED_APPS</code> in base settings module</h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>    <span class="token string">&quot;rest_framework&quot;</span><span class="token punctuation">,</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="add-rest-framework-urls-under-the-if-settings-debug-block-in-backend-urls-py" tabindex="-1"><a class="header-anchor" href="#add-rest-framework-urls-under-the-if-settings-debug-block-in-backend-urls-py" aria-hidden="true">#</a> Add REST Framework URLs under the <code>if settings.DEBUG</code> block in <code>backend/urls.py</code></h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>    urlpatterns <span class="token operator">+=</span> <span class="token punctuation">[</span>path<span class="token punctuation">(</span><span class="token string">&quot;api-auth/&quot;</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">&quot;rest_framework.urls&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="add-openapi-swaggerui-url-path-in-backend-urls-py" tabindex="-1"><a class="header-anchor" href="#add-openapi-swaggerui-url-path-in-backend-urls-py" aria-hidden="true">#</a> Add OpenAPI/SwaggerUI URL path in <code>backend/urls.py</code></h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>generic <span class="token keyword">import</span> TemplateView\n\nurlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>\n    path<span class="token punctuation">(</span>\n        <span class="token string">&quot;api/swagger-ui/&quot;</span><span class="token punctuation">,</span>\n        TemplateView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span>\n            template_name<span class="token operator">=</span><span class="token string">&quot;swagger-ui.html&quot;</span><span class="token punctuation">,</span> extra_context<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;schema_url&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token punctuation">)</span><span class="token punctuation">,</span>\n        name<span class="token operator">=</span><span class="token string">&quot;swagger-ui&quot;</span><span class="token punctuation">,</span>\n    <span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="add-the-following-file-to-the-top-level-templates-directory" tabindex="-1"><a class="header-anchor" href="#add-the-following-file-to-the-top-level-templates-directory" aria-hidden="true">#</a> Add the following file to the top-level templates directory</h2><p><strong>templates/swagger-ui.html</strong></p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code>{% load static %}\n<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Swagger<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span>\n      <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span>\n      <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/css<span class="token punctuation">&quot;</span></span>\n      <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>//unpkg.com/swagger-ui-dist@3/swagger-ui.css<span class="token punctuation">&quot;</span></span>\n    <span class="token punctuation">/&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>swagger-ui<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>//unpkg.com/swagger-ui-dist@3/swagger-ui-bundle.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">\n      <span class="token keyword">const</span> ui <span class="token operator">=</span> <span class="token function">SwaggerUIBundle</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n        url<span class="token operator">:</span> <span class="token string">&quot;{% static &#39;openapi/schema.yml&#39; %}&quot;</span><span class="token punctuation">,</span>\n        dom_id<span class="token operator">:</span> <span class="token string">&quot;#swagger-ui&quot;</span><span class="token punctuation">,</span>\n        presets<span class="token operator">:</span> <span class="token punctuation">[</span>\n          SwaggerUIBundle<span class="token punctuation">.</span>presets<span class="token punctuation">.</span>apis<span class="token punctuation">,</span>\n          SwaggerUIBundle<span class="token punctuation">.</span>SwaggerUIStandalonePreset<span class="token punctuation">,</span>\n        <span class="token punctuation">]</span><span class="token punctuation">,</span>\n        layout<span class="token operator">:</span> <span class="token string">&quot;BaseLayout&quot;</span><span class="token punctuation">,</span>\n        <span class="token function-variable function">requestInterceptor</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n          request<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">&quot;X-CSRFToken&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;{{ csrf_token }}&quot;</span><span class="token punctuation">;</span>\n          <span class="token keyword">return</span> request<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h2 id="add-dependencies-for-openapi-to-base-txt" tabindex="-1"><a class="header-anchor" href="#add-dependencies-for-openapi-to-base-txt" aria-hidden="true">#</a> Add dependencies for OpenAPI to base.txt</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># for OpenAPI\nuritemplate==3.0.1\ncoreapi==2.3.3\npyyaml==5.4.1\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="create-a-directory-for-the-openapi-schema" tabindex="-1"><a class="header-anchor" href="#create-a-directory-for-the-openapi-schema" aria-hidden="true">#</a> Create a directory for the OpenAPI Schema</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir backend/static/openapi\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="generate-the-openapi-schema" tabindex="-1"><a class="header-anchor" href="#generate-the-openapi-schema" aria-hidden="true">#</a> Generate the OpenAPI schema</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>python3 backend/manage.py generateschema &gt; backend/static/openapi/schema.yml\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Add a <code>make</code> command for this:</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">openapi</span><span class="token punctuation">:</span> python3 backend/manage.py generateschema <span class="token punctuation">&gt;</span> backend/static/openapi/schema.yml\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Visit <code>localhost:8000/api/swagger-ui/</code> and we should see an empty OpenAPI/Swagger UI page. As we build an API for our microblog application, this page will be populated.</p><h2 id="add-postserializer-in-serializers-py" tabindex="-1"><a class="header-anchor" href="#add-postserializer-in-serializers-py" aria-hidden="true">#</a> Add <code>PostSerializer</code> in <code>serializers.py</code></h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>touch backend/apps/blog/serializers.py\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers\n\n<span class="token keyword">from</span> apps<span class="token punctuation">.</span>blog<span class="token punctuation">.</span>models <span class="token keyword">import</span> Post\n\n<span class="token keyword">from</span> apps<span class="token punctuation">.</span>accounts<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> CustomUserSerializer\n\n\n<span class="token keyword">class</span> <span class="token class-name">PostSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    liked <span class="token operator">=</span> serializers<span class="token punctuation">.</span>BooleanField<span class="token punctuation">(</span>read_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n    like_count <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>read_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n    created_by <span class="token operator">=</span> CustomUserSerializer<span class="token punctuation">(</span>read_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>\n        model <span class="token operator">=</span> Post\n        fields <span class="token operator">=</span> <span class="token punctuation">(</span>\n            <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span>\n            <span class="token string">&quot;body&quot;</span><span class="token punctuation">,</span>\n            <span class="token string">&quot;created_by&quot;</span><span class="token punctuation">,</span>\n            <span class="token string">&quot;modified_on&quot;</span><span class="token punctuation">,</span>\n            <span class="token string">&quot;liked&quot;</span><span class="token punctuation">,</span>\n            <span class="token string">&quot;like_count&quot;</span><span class="token punctuation">,</span>\n        <span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="add-crud-drf-fbvs-for-blog-app" tabindex="-1"><a class="header-anchor" href="#add-crud-drf-fbvs-for-blog-app" aria-hidden="true">#</a> Add CRUD DRF FBVs for <code>blog</code> app</h2><ul><li>[x] Read (detail)</li><li>[x] Read (list)</li><li>[x] Create</li><li>[x] Update</li><li>[x] Delete</li><li>[x] Tests</li></ul><h2 id="add-crud-drf-cbvs-for-blog-app" tabindex="-1"><a class="header-anchor" href="#add-crud-drf-cbvs-for-blog-app" aria-hidden="true">#</a> Add CRUD DRF CBVs for <code>blog</code> app</h2><ul><li>[x] Use <code>viewsets.ModelViewSet</code></li></ul><h2 id="add-crud-gcbvs-for-blog-app" tabindex="-1"><a class="header-anchor" href="#add-crud-gcbvs-for-blog-app" aria-hidden="true">#</a> Add CRUD GCBVs for <code>blog</code> app??</h2><h2 id="graphql-setup-tasks" tabindex="-1"><a class="header-anchor" href="#graphql-setup-tasks" aria-hidden="true">#</a> GraphQL Setup Tasks</h2><ul><li>Resources</li><li>Install packages</li><li>Configure settings</li><li>JWT Token Auth setup</li><li>PostType</li><li>PostLikeType</li><li>UserType</li><li>AccountType</li><li>PostMutation for creating, updating and deleting</li><li>Query post by ID</li><li>PostLikeMutation for liking a post</li><li>Handle permissions correctly for all mutations</li><li>Pagination</li><li>Filtering</li><li>Sorting</li><li>Relay</li><li>Insomnia Client</li><li>Testing Authentication</li><li>Testing Post queries and mutations (permissions!)</li><li>Pytest and Class Based tests</li><li>Add links in nav UI for GraphiQL</li></ul><h2 id="todo-replace-exceptions-with-graphqlexceptions" tabindex="-1"><a class="header-anchor" href="#todo-replace-exceptions-with-graphqlexceptions" aria-hidden="true">#</a> TODO: replace Exceptions with GraphqlExceptions</h2><h2 id="graphql-resources" tabindex="-1"><a class="header-anchor" href="#graphql-resources" aria-hidden="true">#</a> GraphQL Resources</h2>',74),wn={href:"https://graphene-python.org/",target:"_blank",rel:"noopener noreferrer"},xn=(0,e.Uk)("https://graphene-python.org/"),_n={href:"https://www.howtographql.com/graphql-python/1-getting-started/",target:"_blank",rel:"noopener noreferrer"},qn=(0,e.Uk)("https://www.howtographql.com/graphql-python/1-getting-started/"),An=(0,e.Wm)("h2",{id:"add-graphql-dependencies",tabindex:"-1"},[(0,e.Wm)("a",{class:"header-anchor",href:"#add-graphql-dependencies","aria-hidden":"true"},"#"),(0,e.Uk)(" Add GraphQL dependencies")],-1),jn=(0,e.Wm)("p",null,"GraphQL is another way to access data in our application. One of the main advantages of GraphQL is that it is easier to request the data that you need from the frontend.",-1),Sn=(0,e.Wm)("p",null,"Here's a helpful guide that we can use as a reference:",-1),En={href:"https://www.howtographql.com/graphql-python/1-getting-started/",target:"_blank",rel:"noopener noreferrer"},Tn=(0,e.Uk)("https://www.howtographql.com/graphql-python/1-getting-started/"),Dn=(0,e.uE)('<div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># base.txt\n\n# graphql\ngraphene-django==2.15.0\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="add-graphene-django-to-installed-apps" tabindex="-1"><a class="header-anchor" href="#add-graphene-django-to-installed-apps" aria-hidden="true">#</a> Add <code>graphene_django</code> to <code>INSTALLED_APPS</code></h2><h2 id="add-graphene-settings-to-base-py" tabindex="-1"><a class="header-anchor" href="#add-graphene-settings-to-base-py" aria-hidden="true">#</a> Add <code>GRAPHENE</code> settings to <code>base.py</code></h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>GRAPHENE <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">&quot;SCHEMA&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;backend.schema.schema&quot;</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="add-schema-py-in-the-blog-app-directory" tabindex="-1"><a class="header-anchor" href="#add-schema-py-in-the-blog-app-directory" aria-hidden="true">#</a> Add <code>schema.py</code> in the <code>blog</code> app directory</h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> graphene\n<span class="token keyword">from</span> graphene_django <span class="token keyword">import</span> DjangoObjectType\n\n<span class="token keyword">from</span> apps<span class="token punctuation">.</span>blog<span class="token punctuation">.</span>models <span class="token keyword">import</span> Post\n\n\n<span class="token keyword">class</span> <span class="token class-name">PostType</span><span class="token punctuation">(</span>DjangoObjectType<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>\n        model <span class="token operator">=</span> Post\n\n\n<span class="token keyword">class</span> <span class="token class-name">Query</span><span class="token punctuation">(</span>graphene<span class="token punctuation">.</span>ObjectType<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    posts <span class="token operator">=</span> graphene<span class="token punctuation">.</span>List<span class="token punctuation">(</span>PostType<span class="token punctuation">)</span>\n\n    <span class="token keyword">def</span> <span class="token function">resolve_posts</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> info<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> Post<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="add-a-schema-py-to-the-backend-backend-directory" tabindex="-1"><a class="header-anchor" href="#add-a-schema-py-to-the-backend-backend-directory" aria-hidden="true">#</a> Add a <code>schema.py</code> to the <code>backend/backend</code> directory</h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> graphene\n\n<span class="token keyword">import</span> apps<span class="token punctuation">.</span>blog<span class="token punctuation">.</span>schema\n\n\n<span class="token keyword">class</span> <span class="token class-name">Query</span><span class="token punctuation">(</span>apps<span class="token punctuation">.</span>blog<span class="token punctuation">.</span>schema<span class="token punctuation">.</span>Query<span class="token punctuation">,</span> graphene<span class="token punctuation">.</span>ObjectType<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">pass</span>\n\n\nschema <span class="token operator">=</span> graphene<span class="token punctuation">.</span>Schema<span class="token punctuation">(</span>query<span class="token operator">=</span>Query<span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="add-a-graphql-endpoint-to-backend-urls-py" tabindex="-1"><a class="header-anchor" href="#add-a-graphql-endpoint-to-backend-urls-py" aria-hidden="true">#</a> Add a GraphQL endpoint to <code>backend/urls.py</code></h2><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span>csrf <span class="token keyword">import</span> csrf_exempt\n<span class="token keyword">from</span> graphene_django<span class="token punctuation">.</span>views <span class="token keyword">import</span> GraphQLView\n\nurlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n    path<span class="token punctuation">(</span><span class="token string">&#39;graphql/&#39;</span><span class="token punctuation">,</span> csrf_exempt<span class="token punctuation">(</span>GraphQLView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span>graphiql<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="add-cypress-dependencies" tabindex="-1"><a class="header-anchor" href="#add-cypress-dependencies" aria-hidden="true">#</a> Add Cypress Dependencies</h2>',11),Rn=(0,e.Uk)("Following along with "),Cn={href:"https://docs.cypress.io/guides/getting-started/installing-cypress#System-requirements",target:"_blank",rel:"noopener noreferrer"},Un=(0,e.Uk)("https://docs.cypress.io/guides/getting-started/installing-cypress#System-requirements"),Pn=(0,e.Uk)(":"),In=(0,e.uE)('<div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sudo apt-get install libgtk2.0-0 libgtk-3-0 libgbm-dev libnotify-dev libgconf-2-4 libnss3 libxss1 libasound2 libxtst6 xauth xvfb\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Install cypress with:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>npm install cypress --save-dev\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="start-cypress" tabindex="-1"><a class="header-anchor" href="#start-cypress" aria-hidden="true">#</a> Start Cypress</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$(npm bin)/cypress open\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="use-npm-to-open-cypress" tabindex="-1"><a class="header-anchor" href="#use-npm-to-open-cypress" aria-hidden="true">#</a> Use npm to open Cypress</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>npx cypress open\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="using-on-wsl-2" tabindex="-1"><a class="header-anchor" href="#using-on-wsl-2" aria-hidden="true">#</a> Using on WSL 2</h2><p>Cypress is not supported on WSL 2 without some workarounds. You can run the following command to run Cypress in headless mode:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>node_modules/.bin/cypress run\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="frontend-clients" tabindex="-1"><a class="header-anchor" href="#frontend-clients" aria-hidden="true">#</a> Frontend clients</h2><h2 id="add-vue-as-standalone-spa-show-how-api-calls-will-not-work-without-cors" tabindex="-1"><a class="header-anchor" href="#add-vue-as-standalone-spa-show-how-api-calls-will-not-work-without-cors" aria-hidden="true">#</a> Add Vue as standalone SPA (show how API calls will not work without CORS)</h2><h2 id="add-cors" tabindex="-1"><a class="header-anchor" href="#add-cors" aria-hidden="true">#</a> Add CORS</h2><h2 id="add-nginx-and-remove-cors" tabindex="-1"><a class="header-anchor" href="#add-nginx-and-remove-cors" aria-hidden="true">#</a> Add NGINX and remove CORS</h2><h2 id="add-nginx-dockerfile-for-local-development" tabindex="-1"><a class="header-anchor" href="#add-nginx-dockerfile-for-local-development" aria-hidden="true">#</a> Add NGINX Dockerfile for local development</h2><h2 id="setup-django-channels-settings-routers-consumers-async-tests" tabindex="-1"><a class="header-anchor" href="#setup-django-channels-settings-routers-consumers-async-tests" aria-hidden="true">#</a> Setup Django Channels (settings, routers, consumers, async tests)</h2><h2 id="setup-git-hooks-in-docker-compose" tabindex="-1"><a class="header-anchor" href="#setup-git-hooks-in-docker-compose" aria-hidden="true">#</a> Setup git hooks in docker-compose</h2><h2 id="setup-vue-in-nginx-web-sockets-for-hot-reloading-index-html-etc" tabindex="-1"><a class="header-anchor" href="#setup-vue-in-nginx-web-sockets-for-hot-reloading-index-html-etc" aria-hidden="true">#</a> Setup Vue in NGINX (web-sockets for hot reloading, index.html, etc)</h2><h2 id="add-session-authentication-for-vue-spa" tabindex="-1"><a class="header-anchor" href="#add-session-authentication-for-vue-spa" aria-hidden="true">#</a> Add Session Authentication for Vue SPA</h2><h2 id="show-how-to-setup-e2e-tests-with-cypress" tabindex="-1"><a class="header-anchor" href="#show-how-to-setup-e2e-tests-with-cypress" aria-hidden="true">#</a> Show how to setup e2e tests with Cypress</h2><h2 id="draw-a-project-diagram-using-diagrams-net" tabindex="-1"><a class="header-anchor" href="#draw-a-project-diagram-using-diagrams-net" aria-hidden="true">#</a> Draw a project diagram using diagrams.net</h2><h2 id="generate-model-visualizations-with-graphviz" tabindex="-1"><a class="header-anchor" href="#generate-model-visualizations-with-graphviz" aria-hidden="true">#</a> Generate model visualizations with graphviz</h2><h2 id="vscode-remote-container" tabindex="-1"><a class="header-anchor" href="#vscode-remote-container" aria-hidden="true">#</a> VSCode remote container</h2><h2 id="add-a-privacy-policy" tabindex="-1"><a class="header-anchor" href="#add-a-privacy-policy" aria-hidden="true">#</a> Add a privacy policy</h2><h2 id="cookie-consent-form" tabindex="-1"><a class="header-anchor" href="#cookie-consent-form" aria-hidden="true">#</a> Cookie consent form</h2><h2 id="add-a-constants-file" tabindex="-1"><a class="header-anchor" href="#add-a-constants-file" aria-hidden="true">#</a> Add a constants file</h2><p>In general it is not idea to have strings with the same value used in multiple parts of your application&#39;s code. One place where we have used the same string values is in multiple places is Bootstrap class names in Django forms.</p><p>We can use a file in our core app called <code>constants.py</code> and import this like:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>from apps.core import constants as c\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Then we can add values to this such as:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>BOOTSTRAP_ALERT_SUCCESS = &quot;alert alert-success&quot;\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>This will make it easier for us to keep track of things. If we need to change our CSS Framework from Bootstrap to something else, this will be easy to when we are using constants instead of duplicate strings.</p><p>Create a <code>constants.py</code> file:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>touch backend/apps/core/constants.py\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="install-poetry" tabindex="-1"><a class="header-anchor" href="#install-poetry" aria-hidden="true">#</a> Install poetry</h2>',35),Ln={href:"https://github.com/python-poetry/poetry#installation",target:"_blank",rel:"noopener noreferrer"},On=(0,e.Uk)("https://github.com/python-poetry/poetry#installation"),Wn=(0,e.uE)('<div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/install-poetry.py | python -\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Check the version:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>poetry --version\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="run-poetry-init-to-setup-pyproject-toml" tabindex="-1"><a class="header-anchor" href="#run-poetry-init-to-setup-pyproject-toml" aria-hidden="true">#</a> Run <code>poetry init</code> to setup <code>pyproject.toml</code></h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd backend &amp;&amp; poetry init\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ cd backend &amp;&amp; poetry init\n\nThis command will guide you through creating your pyproject.toml config.\n\nPackage name [backend]:\nVersion [0.1.0]:\nDescription []:\nAuthor [Brian Caffey &lt;briancaffey2010@gmail.com&gt;, n to skip]:  n\nLicense []:\nCompatible Python versions [^3.8]:\n\nWould you like to define your main dependencies interactively? (yes/no) [yes]\nYou can specify a package in the following forms:\n  - A single name (requests)\n  - A name and a constraint (requests@^2.23.0)\n  - A git url (git+https://github.com/python-poetry/poetry.git)\n  - A git url with a revision (git+https://github.com/python-poetry/poetry.git#develop)\n  - A file path (../my-package/my-package.whl)\n  - A directory (../my-package/)\n  - A url (https://example.com/packages/my-package-0.1.0.tar.gz)\n\nSearch for package to add (or leave blank to continue):\n\nWould you like to define your development dependencies interactively? (yes/no) [yes]\nSearch for package to add (or leave blank to continue):\n\nGenerated file\n\n[tool.poetry]\nname = &quot;backend&quot;\nversion = &quot;0.1.0&quot;\ndescription = &quot;&quot;\nauthors = [&quot;Your Name &lt;you@example.com&gt;&quot;]\n\n[tool.poetry.dependencies]\npython = &quot;^3.8&quot;\n\n[tool.poetry.dev-dependencies]\n\n[build-system]\nrequires = [&quot;poetry-core&gt;=1.0.0&quot;]\nbuild-backend = &quot;poetry.core.masonry.api&quot;\n\n\nDo you confirm generation? (yes/no) [yes]\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h2 id="add-project-dependencies-using-semver-notation" tabindex="-1"><a class="header-anchor" href="#add-project-dependencies-using-semver-notation" aria-hidden="true">#</a> Add project dependencies using SemVer notation</h2><h2 id="add-make-command-to-export-requirements-txt-and-requirements-dev-txt-from-poetry" tabindex="-1"><a class="header-anchor" href="#add-make-command-to-export-requirements-txt-and-requirements-dev-txt-from-poetry" aria-hidden="true">#</a> Add <code>make</code> command to export <code>requirements.txt</code> and <code>requirements_dev.txt</code> from poetry</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>poetry-export:\n\tcd backend &amp;&amp; poetry export --without-hashes -f requirements.txt -o requirements.txt &amp;&amp; poetry export --without-hashes -f requirements.txt -o requirements_dev.txt --dev\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="add-new-python-dependencies-with-poetry-add" tabindex="-1"><a class="header-anchor" href="#add-new-python-dependencies-with-poetry-add" aria-hidden="true">#</a> Add new python dependencies with <code>poetry add</code></h2><p>For example:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>poetry add requests\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="configure-vscode-to-use-poetry-environment" tabindex="-1"><a class="header-anchor" href="#configure-vscode-to-use-poetry-environment" aria-hidden="true">#</a> Configure VSCode to use Poetry environment</h2>',13),Nn={href:"https://stackoverflow.com/questions/59882884/vscode-doesnt-show-poetry-virtualenvs-in-select-interpreter-option",target:"_blank",rel:"noopener noreferrer"},Mn=(0,e.Uk)("StackOverflow Question"),Fn=(0,e.uE)('<p>Answer:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># run these commands from the backend/ directory</span>\n<span class="token builtin class-name">cd</span> backend\n\npoetry <span class="token function">env</span> list <span class="token comment"># copy env name</span>\npoetry <span class="token function">env</span> remove <span class="token operator">&lt;</span>env name<span class="token operator">&gt;</span>\npoetry <span class="token function">install</span>\n\npoetry config virtualenvs.in-project <span class="token boolean">true</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>You can also remove the poetry environment with:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>poetry <span class="token function">env</span> list <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $1}&#39;</span> <span class="token operator">|</span> <span class="token function">xargs</span> poetry <span class="token function">env</span> remove\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="microk8s-setup" tabindex="-1"><a class="header-anchor" href="#microk8s-setup" aria-hidden="true">#</a> microk8s setup</h2><h2 id="install-cdk8s-cli" tabindex="-1"><a class="header-anchor" href="#install-cdk8s-cli" aria-hidden="true">#</a> Install <code>cdk8s-cli</code></h2><p>Install the cdk8s npm package globally:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>npm i -g cdk8s-cli\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="start-a-cdk8s-project-in-the-k8s-directory" tabindex="-1"><a class="header-anchor" href="#start-a-cdk8s-project-in-the-k8s-directory" aria-hidden="true">#</a> Start a cdk8s project in the k8s directory</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir -p k8s/cdk8s &amp;&amp; cd k8s/cdk8s\ncdk8s init typescript-app\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Synthesize the application:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cdk8s synth --app=&#39;./k8s/cdk8s&#39;\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>/bin/sh: 1: ./k8s/cdk8s: Permission denied\nError: command &quot;./k8s/cdk8s &quot; at /home/brian/gitlab/django-step-by-step returned a non-zero exit code 126\n    at ChildProcess.&lt;anonymous&gt; (/home/brian/.nvm/versions/node/v15.3.0/lib/node_modules/cdk8s-cli/lib/util.js:24:27)\n    at Object.onceWrapper (node:events:483:26)\n    at ChildProcess.emit (node:events:376:20)\n    at Process.ChildProcess._handle.onexit (node:internal/child_process:277:12)\nmake: *** [Makefile:163: cdk8s_synth] Error 1\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>To fix the permissions issues, run the following:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sudo chmod -R +x ./k8s/cdk8s\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="wsl" tabindex="-1"><a class="header-anchor" href="#wsl" aria-hidden="true">#</a> WSL</h2><h2 id="update-kubectl" tabindex="-1"><a class="header-anchor" href="#update-kubectl" aria-hidden="true">#</a> Update kubectl</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>##  Step1: Run the below command to download the latest version of kubectl\ncurl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl\n\n##  Step2: Make kubectl executable\nchmod +x kubectl\n\n##  Step3: Move it to the directory where kubectl is already installed\nsudo mv kubectl $(which kubectl)\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div>',18),Gn={href:"https://gist.github.com/QaiserAli/18926b5bd9ca7a0551195d449bf31eb6",target:"_blank",rel:"noopener noreferrer"},Vn=(0,e.Uk)("https://gist.github.com/QaiserAli/18926b5bd9ca7a0551195d449bf31eb6"),Bn=(0,e.Wm)("h2",{id:"doctl",tabindex:"-1"},[(0,e.Wm)("a",{class:"header-anchor",href:"#doctl","aria-hidden":"true"},"#"),(0,e.Uk)(" doctl")],-1),Kn={href:"https://github.com/digitalocean/doctl#downloading-a-release-from-github",target:"_blank",rel:"noopener noreferrer"},Yn=(0,e.Uk)("https://github.com/digitalocean/doctl#downloading-a-release-from-github"),zn=(0,e.uE)('<div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd ~\nwget https://github.com/digitalocean/doctl/releases/download/v&lt;version&gt;/doctl-&lt;version&gt;-linux-amd64.tar.gz\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="cdk" tabindex="-1"><a class="header-anchor" href="#cdk" aria-hidden="true">#</a> CDK</h2><h3 id="about-cdk" tabindex="-1"><a class="header-anchor" href="#about-cdk" aria-hidden="true">#</a> About CDK</h3>',3),Hn=(0,e.Uk)("CDK allows you to define AWS infrastructure using high-level programming languages such as TypeScript, Python, Java, etc. You define each part of your application such as VPC, databases, servers, DNS records, IAM roles, etc. These can all be defined using constructs that CDK provides. You can also create your own high-level constructs that use other CDK constructs. This example will use a third-party library that provides a high-level CDK construct for deploying Django applications using Elastic Container Service (ECS). The library is called "),Jn={href:"https://www.npmjs.com/package/django-cdk",target:"_blank",rel:"noopener noreferrer"},Qn=(0,e.Uk)("django-cdk"),$n=(0,e.Uk)("."),Xn=(0,e.uE)('<h3 id="install-cdk" tabindex="-1"><a class="header-anchor" href="#install-cdk" aria-hidden="true">#</a> Install CDK</h3><p>This section will show how to deploy the application on AWS using Elastic Container Service (ECS) and CDK (Cloud Development Kit). First you will need to install the CDK CLI globally with npm:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>npm i -g aws-cdk\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Check the version of CDK:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cdk --version\n1.109.0 (build c647e38)\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="start-the-cdk-project" tabindex="-1"><a class="header-anchor" href="#start-the-cdk-project" aria-hidden="true">#</a> Start the CDK project</h3><p>To start, create a directory called <code>cdk</code> in the root directory and <code>cd</code> into that directory and then initialize a new CDK typescript project. From the root directory of the project, run:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir cdk &amp;&amp; cd cdk &amp;&amp; cdk init app --language typescript\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>You should see the following output:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Applying project template app for typescript\n# Welcome to your CDK TypeScript project!\n\nThis is a blank project for TypeScript development with CDK.\n\nThe `cdk.json` file tells the CDK Toolkit how to execute your app.\n\n## Useful commands\n\n * `npm run build`   compile typescript to js\n * `npm run watch`   watch for changes and compile\n * `npm run test`    perform the jest unit tests\n * `cdk deploy`      deploy this stack to your default AWS account/region\n * `cdk diff`        compare deployed stack with current state\n * `cdk synth`       emits the synthesized CloudFormation template\n\nExecuting npm install...\nnpm WARN deprecated urix@0.1.0: Please see https://github.com/lydell/urix#deprecated\nnpm WARN deprecated resolve-url@0.2.1: https://github.com/lydell/resolve-url#deprecated\nâœ… All done!\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="install-django-cdk" tabindex="-1"><a class="header-anchor" href="#install-django-cdk" aria-hidden="true">#</a> Install <code>django-cdk</code></h3>',11),Zn=(0,e.Uk)("Now that the CDK project has been initialized, we can install the "),ns={href:"https://www.npmjs.com/package/django-cdk",target:"_blank",rel:"noopener noreferrer"},ss=(0,e.Wm)("code",null,"django-cdk",-1),as=(0,e.Uk)(" package. Add the following to the "),es=(0,e.Wm)("code",null,"dependencies",-1),ts=(0,e.Uk)(" section of "),ps=(0,e.Wm)("code",null,"cdk/package.json",-1),os=(0,e.Uk)(":"),ls=(0,e.uE)('<div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">&quot;@aws-cdk/core&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.109.0&quot;</span><span class="token punctuation">,</span>\n    <span class="token property">&quot;source-map-support&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.5.16&quot;</span><span class="token punctuation">,</span>\n    <span class="token property">&quot;django-cdk&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.0.16&quot;</span> <span class="token comment">// add this line</span>\n  <span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Now do <code>npm install</code> in the <code>cdk</code> directory:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>npm install\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>You might need to run <code>npm install --force</code>.</p><p>Next we can import the <code>DjangoEcs</code> construct in our project. In <code>cdk/lib/cdk-stack.ts</code> add the following import:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> DjangoEcs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;django-cdk&#39;</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>and then make a new instance of <code>DjangoEcs</code>. <code>cdk-stack.ts</code> should look like this:</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> cdk <span class="token keyword">from</span> <span class="token string">&#39;@aws-cdk/core&#39;</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> DjangoEcs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;django-cdk&#39;</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CdkStack</span> <span class="token keyword">extends</span> <span class="token class-name">cdk</span><span class="token punctuation">.</span>Stack <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span>scope<span class="token operator">:</span> cdk<span class="token punctuation">.</span>Construct<span class="token punctuation">,</span> id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> props<span class="token operator">?</span><span class="token operator">:</span> cdk<span class="token punctuation">.</span>StackProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">super</span><span class="token punctuation">(</span>scope<span class="token punctuation">,</span> id<span class="token punctuation">,</span> props<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">new</span> <span class="token class-name">DjangoEcs</span><span class="token punctuation">(</span>scope<span class="token punctuation">,</span> <span class="token string">&#39;DjangoEcs&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      imageDirectory<span class="token operator">:</span> <span class="token string">&#39;./backend&#39;</span><span class="token punctuation">,</span>\n      webCommand<span class="token operator">:</span> <span class="token punctuation">[</span>\n        <span class="token string">&#39;./scripts/start_prod.sh&#39;</span><span class="token punctuation">,</span>\n      <span class="token punctuation">]</span><span class="token punctuation">,</span>\n      useCeleryBeat<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n      domainName<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DOMAIN_NAME</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="npm-run-watch" tabindex="-1"><a class="header-anchor" href="#npm-run-watch" aria-hidden="true">#</a> npm run watch</h3><p>Let&#39;s start the local Typescript server to watch for changes in our CDK app code:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>npm run watch\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="synthesize-the-stack" tabindex="-1"><a class="header-anchor" href="#synthesize-the-stack" aria-hidden="true">#</a> Synthesize the stack</h3><p>CDK is used to generate CloudFormation templates. These are YAML files that are essentially the &quot;bytecode of AWS&quot;. We can see the CloudFormation templates that our CDK app will generate by running:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="add-image-to-blog-post" tabindex="-1"><a class="header-anchor" href="#add-image-to-blog-post" aria-hidden="true">#</a> Add image to blog post</h2><h3 id="install-dependencies" tabindex="-1"><a class="header-anchor" href="#install-dependencies" aria-hidden="true">#</a> Install dependencies</h3><p>This section will describe changes needed to make in order to add an image to the blog post model.</p><p>Add <code>Pillow</code>:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>poetry add Pillow\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>If you are using docker, run <code>make poetry-export</code> and restart docker-compose with:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker-compose down --remove-orphans\ndocker-compose up --build\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="add-image-field-to-post-model" tabindex="-1"><a class="header-anchor" href="#add-image-field-to-post-model" aria-hidden="true">#</a> Add <code>image</code> field to Post model</h3><p>Add the following field to <code>blog/models.py</code>:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>    image <span class="token operator">=</span> models<span class="token punctuation">.</span>ImageField<span class="token punctuation">(</span>upload_to<span class="token operator">=</span><span class="token string">&#39;images&#39;</span><span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="make-and-run-migrations" tabindex="-1"><a class="header-anchor" href="#make-and-run-migrations" aria-hidden="true">#</a> Make and run migrations</h3><p>Once you add this code, run the following management commands:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>python3 manage.py makemigrations\npython3 manage.py migrate\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Add the following to the base settings:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>MEDIA_URL <span class="token operator">=</span> <span class="token string">&quot;/media/&quot;</span>\nMEDIA_ROOT <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>BASE_DIR<span class="token punctuation">,</span> <span class="token string">&quot;media&quot;</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="create-backend-media-directory" tabindex="-1"><a class="header-anchor" href="#create-backend-media-directory" aria-hidden="true">#</a> Create backend media directory</h3><p>Next, create the following directory:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir backend/media\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="add-gitignore-to-media-directory" tabindex="-1"><a class="header-anchor" href="#add-gitignore-to-media-directory" aria-hidden="true">#</a> Add .gitignore to media directory</h3><p>Add a file to the <code>media</code> directory called <code>.gitignore</code>:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>*\n!.gitignore\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>In the main <code>.gitignore</code> file in the backend directory, we need to make one small change. Comment out the line that contains:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>media\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>This directory is needed for local development, so we will ignore everything inside of this directory, except for the .gitignore file.</p><h3 id="add-url-patterns-for-serving-media-locally" tabindex="-1"><a class="header-anchor" href="#add-url-patterns-for-serving-media-locally" aria-hidden="true">#</a> Add URL patterns for serving media locally</h3><p>In order to view the media files in our application locally, we need to add the following to <code>backend/urls.py</code>:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>if settings.DEBUG:  # pragma: no cover\n\n    # add this part\n    urlpatterns += static(\n        settings.MEDIA_URL, document_root=settings.MEDIA_ROOT\n    )\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>This will allow Django to serve the media files so we can view them in the templates where blog posts are defined.</p><p>Go to the Django admin and add some blog posts with images. You can then click the image link that the Django admin displays to make sure that your application is correctly configured to save and store images.</p><h3 id="add-image-to-django-template" tabindex="-1"><a class="header-anchor" href="#add-image-to-django-template" aria-hidden="true">#</a> Add image to Django template</h3><p>Now that there is an image field on the post model and there is a post with a media file attached, this image should be displayed in both list and detail views.</p><p>Add the following to <code>posts.html</code> and <code>post.html</code>:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>      {% if post.image %}\n      &lt;img src={{ post.image.url }} alt=&quot;{{ post.body }}&quot; class=&quot;post-image&quot; /&gt;\n      {% endif %}\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="add-styling-to-the-image" tabindex="-1"><a class="header-anchor" href="#add-styling-to-the-image" aria-hidden="true">#</a> Add styling to the image</h3><p>In <code>main.css</code>, add the following:</p><div class="language-css ext-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">.post-image</span> <span class="token punctuation">{</span>\n    <span class="token property">max-width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>\n    <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>\n    <span class="token property">padding</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="add-image-upload-button-for-html-form" tabindex="-1"><a class="header-anchor" href="#add-image-upload-button-for-html-form" aria-hidden="true">#</a> Add image upload button for HTML form</h3><p>First, the <code>&lt;form&gt;</code> element in <code>new_post.html</code> needs to be updated to:</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/posts/new<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>multipart/form-data<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="update-postform" tabindex="-1"><a class="header-anchor" href="#update-postform" aria-hidden="true">#</a> Update PostForm</h3><p>Add an <code>image</code> field to the <code>PostForm</code>:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>forms <span class="token keyword">import</span> <span class="token punctuation">(</span>\n    ModelForm<span class="token punctuation">,</span>\n    CharField<span class="token punctuation">,</span>\n    Textarea<span class="token punctuation">,</span>\n    ImageField<span class="token punctuation">,</span> <span class="token comment"># add this line</span>\n    FileInput<span class="token punctuation">,</span> <span class="token comment"># add this line</span>\n<span class="token punctuation">)</span>\n\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n\n<span class="token keyword">class</span> <span class="token class-name">PostForm</span><span class="token punctuation">(</span>ModelForm<span class="token punctuation">)</span><span class="token punctuation">:</span>\n\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n\n    <span class="token comment"># add this field</span>\n    image <span class="token operator">=</span> ImageField<span class="token punctuation">(</span>\n        required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>\n        widget<span class="token operator">=</span>FileInput<span class="token punctuation">(</span>\n            attrs<span class="token operator">=</span><span class="token punctuation">{</span>\n                <span class="token comment"># add the bootstrap class in the form</span>\n                <span class="token string">&quot;class&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;form-control&quot;</span><span class="token punctuation">,</span>\n            <span class="token punctuation">}</span>\n        <span class="token punctuation">)</span>\n    <span class="token punctuation">)</span>\n\n    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>\n        model <span class="token operator">=</span> Post\n        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;body&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;image&quot;</span><span class="token punctuation">]</span> <span class="token comment"># add &quot;image&quot;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="add-image-url-to-postserializer" tabindex="-1"><a class="header-anchor" href="#add-image-url-to-postserializer" aria-hidden="true">#</a> Add image URL to PostSerializer</h3><p>Add <code>&quot;image&quot;,</code> to the end of the <code>fields</code> list under <code>Class Meta:</code>.</p><h3 id="add-images-for-test" tabindex="-1"><a class="header-anchor" href="#add-images-for-test" aria-hidden="true">#</a> Add images for test</h3><p>Add a few images that can be used in local tests</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ls backend/assets/\npostgres.png redis.png\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="add-a-field-to-the-post-model-factory" tabindex="-1"><a class="header-anchor" href="#add-a-field-to-the-post-model-factory" aria-hidden="true">#</a> Add a field to the Post Model Factory</h3><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>    image <span class="token operator">=</span> factory<span class="token punctuation">.</span>django<span class="token punctuation">.</span>FileField<span class="token punctuation">(</span>\n        from_path<span class="token operator">=</span>Path<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">.</span>parent<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>parent <span class="token operator">/</span> <span class="token string">&#39;assets/postgres.png&#39;</span>\n    <span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="add-cypress-file-upload" tabindex="-1"><a class="header-anchor" href="#add-cypress-file-upload" aria-hidden="true">#</a> Add <code>cypress-file-upload</code></h3><ul><li>Add <code>import &#39;cypress-file-upload&#39;;</code> to <code>cypress/cypress/support/commands.js</code></li><li>Add <code>data-cy</code> to file input</li></ul>',65),rs=(0,e.Uk)("Follow these steps: "),cs={href:"https://www.npmjs.com/package/cypress-file-upload",target:"_blank",rel:"noopener noreferrer"},is=(0,e.Uk)("https://www.npmjs.com/package/cypress-file-upload"),us=(0,e.uE)('<h3 id="install-graphene-extension-for-image-support-in-graphql" tabindex="-1"><a class="header-anchor" href="#install-graphene-extension-for-image-support-in-graphql" aria-hidden="true">#</a> Install Graphene extension for image support in GraphQL</h3><p>https://github.com/lmcgartland/graphene-file-upload https://pypi.org/project/graphene-file-upload/1.3.0/</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd backend &amp;&amp; poetry add graphene-file-upload\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="add-images-to-test-case-logic" tabindex="-1"><a class="header-anchor" href="#add-images-to-test-case-logic" aria-hidden="true">#</a> Add images to test case logic</h3><p>Optional/Extra steps</p><h2 id="graphql-together-with-or-replacing-drf-rest" tabindex="-1"><a class="header-anchor" href="#graphql-together-with-or-replacing-drf-rest" aria-hidden="true">#</a> GraphQL (together with or replacing DRF/REST)</h2><h2 id="spatial-and-geographic-databases-postgis" tabindex="-1"><a class="header-anchor" href="#spatial-and-geographic-databases-postgis" aria-hidden="true">#</a> Spatial and Geographic Databases (PostGIS)</h2><h2 id="portainer-ui-for-viewing-containers-and-logs" tabindex="-1"><a class="header-anchor" href="#portainer-ui-for-viewing-containers-and-logs" aria-hidden="true">#</a> Portainer UI for viewing containers and logs</h2><h2 id="wagtail-for-managing-blog-content" tabindex="-1"><a class="header-anchor" href="#wagtail-for-managing-blog-content" aria-hidden="true">#</a> Wagtail for managing blog content</h2>',9),ds={render:function(n,s){const a=(0,e.up)("OutboundLink");return(0,e.wg)(),(0,e.j4)(e.HY,null,[t,(0,e.Wm)("p",null,[p,(0,e.Wm)("a",o,[l,(0,e.Wm)(a)]),r]),c,(0,e.Wm)("p",null,[(0,e.Wm)("a",i,[u,(0,e.Wm)(a)])]),d,(0,e.Wm)("p",null,[b,(0,e.Wm)("a",m,[k,(0,e.Wm)(a)]),h,g,v,y,f]),w,(0,e.Wm)("p",null,[(0,e.Wm)("a",x,[_,(0,e.Wm)(a)])]),q,(0,e.Wm)("p",null,[A,(0,e.Wm)("a",j,[S,(0,e.Wm)(a)])]),E,(0,e.Wm)("p",null,[(0,e.Wm)("a",T,[D,(0,e.Wm)(a)]),R]),C,(0,e.Wm)("p",null,[U,(0,e.Wm)("a",P,[I,(0,e.Wm)(a)])]),L,(0,e.Wm)("p",null,[O,(0,e.Wm)("a",W,[N,(0,e.Wm)(a)])]),M,(0,e.Wm)("p",null,[(0,e.Wm)("a",F,[G,(0,e.Wm)(a)])]),(0,e.Wm)("p",null,[(0,e.Wm)("a",V,[B,(0,e.Wm)(a)])]),K,(0,e.Wm)("p",null,[Y,(0,e.Wm)("a",z,[H,(0,e.Wm)(a)])]),(0,e.Wm)("p",null,[J,(0,e.Wm)("a",Q,[$,(0,e.Wm)(a)])]),X,(0,e.Wm)("p",null,[Z,(0,e.Wm)("a",nn,[sn,(0,e.Wm)(a)]),an]),en,(0,e.Wm)("p",null,[(0,e.Wm)("a",tn,[pn,(0,e.Wm)(a)])]),on,(0,e.Wm)("p",null,[(0,e.Wm)("a",ln,[rn,(0,e.Wm)(a)])]),cn,(0,e.Wm)("p",null,[un,(0,e.Wm)("a",dn,[bn,(0,e.Wm)(a)])]),mn,(0,e.Wm)("p",null,[(0,e.Wm)("a",kn,[hn,(0,e.Wm)(a)])]),gn,(0,e.Wm)("p",null,[(0,e.Wm)("a",vn,[yn,(0,e.Wm)(a)])]),fn,(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[(0,e.Wm)("a",wn,[xn,(0,e.Wm)(a)])]),(0,e.Wm)("li",null,[(0,e.Wm)("a",_n,[qn,(0,e.Wm)(a)])])]),An,jn,Sn,(0,e.Wm)("p",null,[(0,e.Wm)("a",En,[Tn,(0,e.Wm)(a)])]),Dn,(0,e.Wm)("p",null,[Rn,(0,e.Wm)("a",Cn,[Un,(0,e.Wm)(a)]),Pn]),In,(0,e.Wm)("p",null,[(0,e.Wm)("a",Ln,[On,(0,e.Wm)(a)])]),Wn,(0,e.Wm)("p",null,[(0,e.Wm)("a",Nn,[Mn,(0,e.Wm)(a)])]),Fn,(0,e.Wm)("p",null,[(0,e.Wm)("a",Gn,[Vn,(0,e.Wm)(a)])]),Bn,(0,e.Wm)("p",null,[(0,e.Wm)("a",Kn,[Yn,(0,e.Wm)(a)])]),zn,(0,e.Wm)("p",null,[Hn,(0,e.Wm)("a",Jn,[Qn,(0,e.Wm)(a)]),$n]),Xn,(0,e.Wm)("p",null,[Zn,(0,e.Wm)("a",ns,[ss,(0,e.Wm)(a)]),as,es,ts,ps,os]),ls,(0,e.Wm)("p",null,[rs,(0,e.Wm)("a",cs,[is,(0,e.Wm)(a)])]),us],64)}}}}]);