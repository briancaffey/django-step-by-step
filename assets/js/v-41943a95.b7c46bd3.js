"use strict";(self.webpackChunkvuepress_docs=self.webpackChunkvuepress_docs||[]).push([[719],{2360:(e,o,t)=>{t.r(o),t.d(o,{data:()=>a});const a={key:"v-41943a95",path:"/deploy/aws/overview/",title:"How to deploy μblog on AWS",lang:"en-US",frontmatter:{prev:"/deploy/digital-ocean"},excerpt:"",headers:[{level:2,title:"About django-cdk",slug:"about-django-cdk",children:[]},{level:2,title:"django-cdk constructs",slug:"django-cdk-constructs",children:[]},{level:2,title:"About CDK constructs",slug:"about-cdk-constructs",children:[]},{level:2,title:"Features of the DjangoVue, DjangoEcs and StaticSite constructs",slug:"features-of-the-djangovue-djangoecs-and-staticsite-constructs",children:[{level:3,title:"DjangoVue resources",slug:"djangovue-resources",children:[]},{level:3,title:"Configuring Django and Vue to use the same domain and subdomain",slug:"configuring-django-and-vue-to-use-the-same-domain-and-subdomain",children:[]},{level:3,title:"Automatic commands",slug:"automatic-commands",children:[]},{level:3,title:"ECS Exec",slug:"ecs-exec",children:[]}]},{level:2,title:"django-cdk documentation",slug:"django-cdk-documentation",children:[{level:3,title:"ECS",slug:"ecs",children:[]}]},{level:2,title:"projen",slug:"projen",children:[]},{level:2,title:"Development",slug:"development",children:[]},{level:2,title:"Current Development Efforts",slug:"current-development-efforts",children:[]},{level:2,title:"GitHub Discussions",slug:"github-discussions",children:[]}],filePathRelative:"deploy/aws/overview/README.md",git:{updatedTime:1667187701e3,contributors:[]}}},530:(e,o,t)=>{t.r(o),t.d(o,{default:()=>We});var a=t(6252);const n=(0,a.Wm)("h1",{id:"how-to-deploy-μblog-on-aws",tabindex:"-1"},[(0,a.Wm)("a",{class:"header-anchor",href:"#how-to-deploy-μblog-on-aws","aria-hidden":"true"},"#"),(0,a.Uk)(" How to deploy μblog on AWS")],-1),r=(0,a.Wm)("p",null,"This page will describe how to deploy μblog on AWS using an Infrastructure as Code (IAC) tool called AWS CloudDevelopment Kit (CDK).",-1),i={class:"table-of-contents"},s=(0,a.Uk)("About django-cdk"),l=(0,a.Uk)("django-cdk constructs"),c=(0,a.Uk)("About CDK constructs"),d=(0,a.Uk)("Features of the DjangoVue, DjangoEcs and StaticSite constructs"),u=(0,a.Uk)("DjangoVue resources"),h=(0,a.Uk)("Configuring Django and Vue to use the same domain and subdomain"),m=(0,a.Uk)("Automatic commands"),p=(0,a.Uk)("ECS Exec"),g=(0,a.Uk)("django-cdk documentation"),f=(0,a.Uk)("ECS"),k=(0,a.Uk)("projen"),b=(0,a.Uk)("Development"),j=(0,a.Uk)("Current Development Efforts"),W=(0,a.Uk)("GitHub Discussions"),w={id:"about-django-cdk",tabindex:"-1"},v=(0,a.Wm)("a",{class:"header-anchor",href:"#about-django-cdk","aria-hidden":"true"},"#",-1),y=(0,a.Uk)(" About "),D={href:"https://github.com/briancaffey/django-cdk",target:"_blank",rel:"noopener noreferrer"},C=(0,a.Wm)("code",null,"django-cdk",-1),S=(0,a.Wm)("p",null,[(0,a.Wm)("code",null,"django-cdk"),(0,a.Uk)(" is a library for that includes constructs for deploying Django applications on AWS, focusing on containerization and serverless. "),(0,a.Wm)("code",null,"django-cdk"),(0,a.Uk)(" code lives on GitHub, and the package can be used with CDK in both Python and JavaScript/TypeScript CDK applications. Here are links for "),(0,a.Wm)("code",null,"django-cdk"),(0,a.Uk)(":")],-1),U={href:"https://github.com/briancaffey/django-cdk",target:"_blank",rel:"noopener noreferrer"},A=(0,a.Uk)("https://github.com/briancaffey/django-cdk"),E=(0,a.Uk)(" - GitHub"),x={href:"https://www.npmjs.com/package/django-cdk",target:"_blank",rel:"noopener noreferrer"},_=(0,a.Uk)("https://www.npmjs.com/package/django-cdk"),T=(0,a.Uk)(" - NPM"),K={href:"https://pypi.org/project/django-cdk/",target:"_blank",rel:"noopener noreferrer"},V=(0,a.Uk)("https://pypi.org/project/django-cdk/"),F=(0,a.Uk)(" - PyPI"),P=(0,a.uE)('<h2 id="django-cdk-constructs" tabindex="-1"><a class="header-anchor" href="#django-cdk-constructs" aria-hidden="true">#</a> <code>django-cdk</code> constructs</h2><ul><li>ad-hoc-base</li><li>ad-hoc-app</li><li>prod-base</li><li>prod-app</li></ul><h2 id="about-cdk-constructs" tabindex="-1"><a class="header-anchor" href="#about-cdk-constructs" aria-hidden="true">#</a> About CDK constructs</h2><p>Here are some important points that will give some important context around CDK and IaC on AWS:</p><ul><li>CDK is an AWS tool that allows you to write Infrastructure as Code</li><li>CDK generates CloudFormation (JSON/YAML that defines AWS resources at a low level)</li><li>CDK contains different levels of constructs that can be used to generate CloudFormation: <ul><li>L1 (Level 1) CDK constructs are a 1:1 mapping from CDK to CloudFormation resources. They are prefixed with <code>Cfn</code> (e.g. <code>s3.CfnBucket</code>)</li><li>L2 CDK constructs are abstractions that generate several related CloudFormation resources that help support a single AWS resource or a group of related resource. For example, the L2 CDK construct for creating a VPC generates CloudFormation for a VPC, a subnet, and a NAT Gateway, routing tables and other related resources.</li><li>L3 CDK constructs generate groups of resources. For example, the L3 CDK construct for creating a load-balanced web services generates CloudFormation for an ECS service, a load balancer and related target groups.</li></ul></li></ul><p>The resources in <code>django-cdk</code> can be thought of as <code>L4</code> constructs. A single construct will contain all of the resources needed to create an application that has a number of different resources.</p><h2 id="features-of-the-djangovue-djangoecs-and-staticsite-constructs" tabindex="-1"><a class="header-anchor" href="#features-of-the-djangovue-djangoecs-and-staticsite-constructs" aria-hidden="true">#</a> Features of the <code>DjangoVue</code>, <code>DjangoEcs</code> and <code>StaticSite</code> constructs</h2><p><code>DjangoVue</code> is the highest-level construct in the library. It combines two other constructs in the library: <code>DjangoEcs</code> and <code>StaticSite</code>.</p><h3 id="djangovue-resources" tabindex="-1"><a class="header-anchor" href="#djangovue-resources" aria-hidden="true">#</a> <code>DjangoVue</code> resources</h3><p><code>DjangoVue</code> deploys the following resources:</p><ul><li>VPC (Subnets, Security Groups, AZs, NAT Gateway)</li><li>Application Load Balancer</li><li>ECS cluster, services and tasks for the Django API server and celery workers</li><li>Postgres databases</li><li>Static site for a Single Page Application deployed with CloudFront and S3</li><li>Route 53 DNS records</li><li>Certificate Manager certificates</li><li>IAM roles and policies</li><li>Outputs that provide commands for allowing an AWS admin to access an interactive shell running in a serverless container</li><li>Optional automatic commands (useful if you want to run Django migrations or collect static on each deploy)</li></ul><h3 id="configuring-django-and-vue-to-use-the-same-domain-and-subdomain" tabindex="-1"><a class="header-anchor" href="#configuring-django-and-vue-to-use-the-same-domain-and-subdomain" aria-hidden="true">#</a> Configuring Django and Vue to use the same domain and subdomain</h3><p>The <code>DjangoVue</code> construct deploys a CloudFront distribution that includes three different origins:</p><ul><li>Static Site Bucket (serves Vue SPA assets)</li><li>Application Load Balancer DNS Name</li><li>Django assets S3 Bucket (static and media files for the Django application)</li></ul><p>This allows for Django and Vue to use the same domain and subdomain. Assuming that you have a Route 53 domain called <code>domain.com</code>, CloudFront will route requests as follows:</p><ul><li><code>app.domain.com/{api,admin,graphql}/</code> requests will be routed to the load balancer</li><li><code>app.domain.com/{static,media}/</code> requests will be routed to the assets bucket</li><li>all other requests to <code>app.domain.com</code> will be routed to the static site bucket (Vue SPA)</li></ul><p>One important implication of this relates to authentication: we can set an <code>HttpOnly</code> cookie on the Vue client that comes from a request to the Django API. <strong>This would not be possible if the Vue client is served on <code>app.domain.com</code> and the Django API is served on <code>api.domain.com</code>.</strong></p><h3 id="automatic-commands" tabindex="-1"><a class="header-anchor" href="#automatic-commands" aria-hidden="true">#</a> Automatic commands</h3><p>The CDK allows you to define Custom Resources that can either:</p><ul><li>run an AWS JavaScript SDK command</li><li>run a Lambda function that does something</li></ul><p>The <code>DjangoEcs</code> construct optionally defines custom resources that can run ECS tasks for running Django management commands that you might want run on each deployment such as:</p><ul><li><code>python manage.py migrate --no-input</code></li><li><code>python manage.py collectstatic --no-input</code></li></ul><h3 id="ecs-exec" tabindex="-1"><a class="header-anchor" href="#ecs-exec" aria-hidden="true">#</a> ECS Exec</h3><p>ECS Exec is a new feature of ECS that allows you to open a shell in a container running on ECS Fargate.</p><p>Here are some helpful links for more information about ECS Exec:</p>',25),H={href:"https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs-exec.html",target:"_blank",rel:"noopener noreferrer"},I=(0,a.Uk)("AWS Developer Guide"),L={href:"https://github.com/pahud/ecs-exec-cdk-demo",target:"_blank",rel:"noopener noreferrer"},q=(0,a.Uk)("ecs-exec-cdk-demo repo from pahud"),G=(0,a.Wm)("h2",{id:"django-cdk-documentation",tabindex:"-1"},[(0,a.Wm)("a",{class:"header-anchor",href:"#django-cdk-documentation","aria-hidden":"true"},"#"),(0,a.Uk)(),(0,a.Wm)("code",null,"django-cdk"),(0,a.Uk)(" documentation")],-1),M=(0,a.Uk)("Documentation for "),B=(0,a.Wm)("code",null,"django-cdk",-1),N=(0,a.Uk)(" is generated automatically from the source code. The most up-to-date documentation for using "),O=(0,a.Wm)("code",null,"django-cdk",-1),R=(0,a.Uk)(" constructs can be found here: "),z={href:"https://github.com/briancaffey/django-cdk/blob/main/API.md",target:"_blank",rel:"noopener noreferrer"},J=(0,a.Uk)("https://github.com/briancaffey/django-cdk/blob/main/API.md"),Y=(0,a.uE)('<p>To use one of the constructs you need to provide:</p><ul><li>A path to the root of your Django project</li><li>The location of the <code>Dockerfile</code> used to build your application&#39;s image relative to your Django project&#39;s root directory</li><li>The commands used to start the process that run your application: <ul><li>web server process (required)</li><li>celery (optional)</li><li>celery beat (optional)</li></ul></li><li>Options for how to run the application and which additional services your application requires</li></ul><p>If you are hosting your application outside of AWS, there is also a construct that can be used for provisioning a new S3 bucket along with an IAM user with the necessary permissions to access it. This can be used for hosting static files as well as media files.</p><h3 id="ecs" tabindex="-1"><a class="header-anchor" href="#ecs" aria-hidden="true">#</a> ECS</h3>',4),Z=(0,a.Wm)("p",null,[(0,a.Uk)("The ECS construct uses the "),(0,a.Wm)("code",null,"ApplicationLoadBalancedFargateService"),(0,a.Uk)(" construct from "),(0,a.Wm)("code",null,"@aws-cdk/aws-ecs-patterns"),(0,a.Uk)(". This is a powerful abstraction that handles a lot of the networking requirements for the construct.")],-1),$=(0,a.Wm)("h2",{id:"projen",tabindex:"-1"},[(0,a.Wm)("a",{class:"header-anchor",href:"#projen","aria-hidden":"true"},"#"),(0,a.Uk)(" projen")],-1),Q=(0,a.Uk)("This project uses "),X={href:"https://github.com/projen/projen",target:"_blank",rel:"noopener noreferrer"},ee=(0,a.Uk)("projen"),oe=(0,a.Uk)("."),te=(0,a.uE)('<blockquote><p>projen synthesizes project configuration files such as package.json, tsconfig.json, .gitignore, GitHub Workflows, eslint, jest, etc from a well-typed definition written in JavaScript.</p></blockquote><h2 id="development" tabindex="-1"><a class="header-anchor" href="#development" aria-hidden="true">#</a> Development</h2><p>For development of this library, a sample Django application is included as a git submodule in <code>test/django-step-by-step</code>. This Django project is used when deploying the application, and can be replaced with your own project for testing purposes. See the <code>Makefile</code> in the <code>django-cdk</code> repository for some commonly used</p><h2 id="current-development-efforts" tabindex="-1"><a class="header-anchor" href="#current-development-efforts" aria-hidden="true">#</a> Current Development Efforts</h2><p>This project is under active development. Here are some issues that need to be addressed:</p>',5),ae=(0,a.Wm)("li",null,"Media file uploads are currently broken, this needs to be fixed",-1),ne=(0,a.Uk)("Go over this Kubernetes checklist: "),re={href:"https://www.weave.works/blog/production-ready-checklist-kubernetes",target:"_blank",rel:"noopener noreferrer"},ie=(0,a.Uk)("https://www.weave.works/blog/production-ready-checklist-kubernetes"),se=(0,a.Wm)("li",null,"Add snapshot tests and refactor the application",-1),le=(0,a.Wm)("li",null,"Add unit tests",-1),ce=(0,a.Wm)("li",null,[(0,a.Uk)("Add autoscaling rules to "),(0,a.Wm)("code",null,"DjangoEcs"),(0,a.Uk)(" for horizontal scaling and do load-testing")],-1),de=(0,a.Wm)("h2",{id:"github-discussions",tabindex:"-1"},[(0,a.Wm)("a",{class:"header-anchor",href:"#github-discussions","aria-hidden":"true"},"#"),(0,a.Uk)(" GitHub Discussions")],-1),ue=(0,a.Uk)("If you have any questions about the "),he=(0,a.Wm)("code",null,"django-cdk",-1),me=(0,a.Uk)(" construct library, please start a Discussion on the GitHub repo: "),pe={href:"https://github.com/briancaffey/django-cdk/discussions",target:"_blank",rel:"noopener noreferrer"},ge=(0,a.Uk)("https://github.com/briancaffey/django-cdk/discussions"),fe=(0,a.Uk)("."),ke=(0,a.Uk)("You can also open an issue: "),be={href:"https://github.com/briancaffey/django-cdk/issues/new",target:"_blank",rel:"noopener noreferrer"},je=(0,a.Uk)("https://github.com/briancaffey/django-cdk/issues/new"),We={render:function(e,o){const t=(0,a.up)("RouterLink"),We=(0,a.up)("OutboundLink");return(0,a.wg)(),(0,a.j4)(a.HY,null,[n,r,(0,a.Wm)("nav",i,[(0,a.Wm)("ul",null,[(0,a.Wm)("li",null,[(0,a.Wm)(t,{to:"#about-django-cdk"},{default:(0,a.w5)((()=>[s])),_:1})]),(0,a.Wm)("li",null,[(0,a.Wm)(t,{to:"#django-cdk-constructs"},{default:(0,a.w5)((()=>[l])),_:1})]),(0,a.Wm)("li",null,[(0,a.Wm)(t,{to:"#about-cdk-constructs"},{default:(0,a.w5)((()=>[c])),_:1})]),(0,a.Wm)("li",null,[(0,a.Wm)(t,{to:"#features-of-the-djangovue-djangoecs-and-staticsite-constructs"},{default:(0,a.w5)((()=>[d])),_:1}),(0,a.Wm)("ul",null,[(0,a.Wm)("li",null,[(0,a.Wm)(t,{to:"#djangovue-resources"},{default:(0,a.w5)((()=>[u])),_:1})]),(0,a.Wm)("li",null,[(0,a.Wm)(t,{to:"#configuring-django-and-vue-to-use-the-same-domain-and-subdomain"},{default:(0,a.w5)((()=>[h])),_:1})]),(0,a.Wm)("li",null,[(0,a.Wm)(t,{to:"#automatic-commands"},{default:(0,a.w5)((()=>[m])),_:1})]),(0,a.Wm)("li",null,[(0,a.Wm)(t,{to:"#ecs-exec"},{default:(0,a.w5)((()=>[p])),_:1})])])]),(0,a.Wm)("li",null,[(0,a.Wm)(t,{to:"#django-cdk-documentation"},{default:(0,a.w5)((()=>[g])),_:1}),(0,a.Wm)("ul",null,[(0,a.Wm)("li",null,[(0,a.Wm)(t,{to:"#ecs"},{default:(0,a.w5)((()=>[f])),_:1})])])]),(0,a.Wm)("li",null,[(0,a.Wm)(t,{to:"#projen"},{default:(0,a.w5)((()=>[k])),_:1})]),(0,a.Wm)("li",null,[(0,a.Wm)(t,{to:"#development"},{default:(0,a.w5)((()=>[b])),_:1})]),(0,a.Wm)("li",null,[(0,a.Wm)(t,{to:"#current-development-efforts"},{default:(0,a.w5)((()=>[j])),_:1})]),(0,a.Wm)("li",null,[(0,a.Wm)(t,{to:"#github-discussions"},{default:(0,a.w5)((()=>[W])),_:1})])])]),(0,a.Wm)("h2",w,[v,y,(0,a.Wm)("a",D,[C,(0,a.Wm)(We)])]),S,(0,a.Wm)("ul",null,[(0,a.Wm)("li",null,[(0,a.Wm)("a",U,[A,(0,a.Wm)(We)]),E]),(0,a.Wm)("li",null,[(0,a.Wm)("a",x,[_,(0,a.Wm)(We)]),T]),(0,a.Wm)("li",null,[(0,a.Wm)("a",K,[V,(0,a.Wm)(We)]),F])]),P,(0,a.Wm)("ul",null,[(0,a.Wm)("li",null,[(0,a.Wm)("a",H,[I,(0,a.Wm)(We)])]),(0,a.Wm)("li",null,[(0,a.Wm)("a",L,[q,(0,a.Wm)(We)])])]),G,(0,a.Wm)("p",null,[M,B,N,O,R,(0,a.Wm)("a",z,[J,(0,a.Wm)(We)])]),Y,(0,a.Wm)("img",{src:e.$withBase("/diagrams/django-ecs.png"),alt:"docker-compose"},null,8,["src"]),Z,$,(0,a.Wm)("p",null,[Q,(0,a.Wm)("a",X,[ee,(0,a.Wm)(We)]),oe]),te,(0,a.Wm)("ul",null,[ae,(0,a.Wm)("li",null,[ne,(0,a.Wm)("a",re,[ie,(0,a.Wm)(We)])]),se,le,ce]),de,(0,a.Wm)("p",null,[ue,he,me,(0,a.Wm)("a",pe,[ge,(0,a.Wm)(We)]),fe]),(0,a.Wm)("p",null,[ke,(0,a.Wm)("a",be,[je,(0,a.Wm)(We)])])],64)}}}}]);